import{APIError as gt}from"better-call";import{z as Le}from"zod";import{createEndpointCreator as Bt,createMiddleware as $o,createMiddlewareCreator as Ft}from"better-call";var Zo=$o(async()=>({})),N=Ft({use:[Zo,$o(async()=>({}))]}),u=Bt({use:[Zo]});import{APIError as W}from"better-call";import{z as q}from"zod";var ae=class extends Error{constructor(o,t){super(o),this.name="BetterAuthError",this.message=o,this.cause=t,this.stack=""}};var L=(e,o="ms")=>new Date(Date.now()+(o==="sec"?e*1e3:e));var to=Object.create(null),Ve=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?to:globalThis),fe=new Proxy(to,{get(e,o){return Ve()[o]??to[o]},has(e,o){let t=Ve();return o in t||o in to},set(e,o,t){let i=Ve(!0);return i[o]=t,!0},deleteProperty(e,o){if(!o)return!1;let t=Ve(!0);return delete t[o],!0},ownKeys(){let e=Ve(!0);return Object.keys(e)}});function Mt(e){return e?e!=="false":!1}var bo=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var ro=bo==="dev"||bo==="development",Vt=bo==="test"||Mt(fe.TEST);import{base64Url as qt}from"@better-auth/utils/base64";import{createHMAC as Ht}from"@better-auth/utils/hmac";function Oe(e){let o=new Map;return e.split(", ").forEach(i=>{let r=i.split(";").map(p=>p.trim()),[n,...s]=r,[a,...d]=n.split("="),A=d.join("=");if(!a||A===void 0)return;let c={value:A};s.forEach(p=>{let[l,...K]=p.split("="),y=K.join("="),h=l.trim().toLowerCase();switch(h){case"max-age":c["max-age"]=y?parseInt(y.trim(),10):void 0;break;case"expires":c.expires=y?new Date(y.trim()):void 0;break;case"domain":c.domain=y?y.trim():void 0;break;case"path":c.path=y?y.trim():void 0;break;case"secure":c.secure=!0;break;case"httponly":c.httponly=!0;break;case"samesite":c.samesite=y?y.trim().toLowerCase():void 0;break;default:c[h]=y?y.trim():!0;break}}),o.set(a,c)}),o}async function Oo(e,o){if(e.context.options.session?.cookieCache?.enabled){let i=qt.encode(JSON.stringify({session:o,expiresAt:L(e.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),signature:await Ht("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify(o))}),{padding:!1});if(i.length>4093)throw new ae("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");e.setCookie(e.context.authCookies.sessionData.name,i,e.context.authCookies.sessionData.options)}}async function b(e,o,t,i){let r=e.context.authCookies.sessionToken.options,n=t?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,o.session.token,e.context.secret,{...r,maxAge:n,...i}),t&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await Oo(e,o),e.context.setNewSession(o),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(o.session.token,JSON.stringify({user:o.user,session:o.session}),Math.floor((new Date(o.session.expiresAt).getTime()-Date.now())/1e3))}function G(e){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}function qe(e){let o=e.split("; "),t=new Map;return o.forEach(i=>{let[r,n]=i.split("=");t.set(r,n)}),t}var $t=Object.defineProperty,Zt=Object.defineProperties,Gt=Object.getOwnPropertyDescriptors,Go=Object.getOwnPropertySymbols,Qt=Object.prototype.hasOwnProperty,Wt=Object.prototype.propertyIsEnumerable,Qo=(e,o,t)=>o in e?$t(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,Ee=(e,o)=>{for(var t in o||(o={}))Qt.call(o,t)&&Qo(e,t,o[t]);if(Go)for(var t of Go(o))Wt.call(o,t)&&Qo(e,t,o[t]);return e},Re=(e,o)=>Zt(e,Gt(o)),Jt=class extends Error{constructor(e,o,t){super(o||e.toString(),{cause:t}),this.status=e,this.statusText=o,this.error=t}},Xt=async(e,o)=>{var t,i,r,n,s,a;let d=o||{},A={onRequest:[o?.onRequest],onResponse:[o?.onResponse],onSuccess:[o?.onSuccess],onError:[o?.onError],onRetry:[o?.onRetry]};if(!o||!o?.plugins)return{url:e,options:d,hooks:A};for(let c of o?.plugins||[]){if(c.init){let p=await((t=c.init)==null?void 0:t.call(c,e.toString(),o));d=p.options||d,e=p.url}A.onRequest.push((i=c.hooks)==null?void 0:i.onRequest),A.onResponse.push((r=c.hooks)==null?void 0:r.onResponse),A.onSuccess.push((n=c.hooks)==null?void 0:n.onSuccess),A.onError.push((s=c.hooks)==null?void 0:s.onError),A.onRetry.push((a=c.hooks)==null?void 0:a.onRetry)}return{url:e,options:d,hooks:A}},Wo=class{constructor(e){this.options=e}shouldAttemptRetry(e,o){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(o)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},Yt=class{constructor(e){this.options=e}shouldAttemptRetry(e,o){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(o)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function er(e){if(typeof e=="number")return new Wo({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new Wo(e);case"exponential":return new Yt(e);default:throw new Error("Invalid retry strategy")}}var or=e=>{let o={},t=i=>typeof i=="function"?i():i;if(e?.auth){if(e.auth.type==="Bearer"){let i=t(e.auth.token);if(!i)return o;o.authorization=`Bearer ${i}`}else if(e.auth.type==="Basic"){let i=t(e.auth.username),r=t(e.auth.password);if(!i||!r)return o;o.authorization=`Basic ${btoa(`${i}:${r}`)}`}else if(e.auth.type==="Custom"){let i=t(e.auth.value);if(!i)return o;o.authorization=`${t(e.auth.prefix)} ${i}`}}return o},Yo=["get","post","put","patch","delete"];var ir=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function tr(e){let o=e.headers.get("content-type"),t=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!o)return"json";let i=o.split(";").shift()||"";return ir.test(i)?"json":t.has(i)||i.startsWith("text/")?"text":"blob"}function rr(e){try{return JSON.parse(e),!0}catch{return!1}}function ei(e){if(e===void 0)return!1;let o=typeof e;return o==="string"||o==="number"||o==="boolean"||o===null?!0:o!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Jo(e){try{return JSON.parse(e)}catch{return e}}function Xo(e){return typeof e=="function"}function nr(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&Xo(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&Xo(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}function sr(e){let o=new Headers(e?.headers),t=or(e);for(let[i,r]of Object.entries(t||{}))o.set(i,r);if(!o.has("content-type")){let i=ar(e?.body);i&&o.set("content-type",i)}return o}function ar(e){return ei(e)?"application/json":null}function dr(e){if(!e?.body)return null;let o=new Headers(e?.headers);return ei(e.body)&&!o.has("content-type")?JSON.stringify(e.body):e.body}function Ar(e,o){var t;if(o?.method)return o.method.toUpperCase();if(e.startsWith("@")){let i=(t=e.split("@")[1])==null?void 0:t.split("/")[0];return Yo.includes(i)?i.toUpperCase():o?.body?"POST":"GET"}return o?.body?"POST":"GET"}function cr(e,o){let t;return!e?.signal&&e?.timeout&&(t=setTimeout(()=>o?.abort(),e?.timeout)),{abortTimeout:t,clearTimeout:()=>{t&&clearTimeout(t)}}}function ur(e,o){let{baseURL:t,params:i,query:r}=o||{query:{},params:{},baseURL:""},n=e.startsWith("http")?e.split("/").slice(0,3).join("/"):t;if(!n)throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);if(e.startsWith("@")){let p=e.toString().split("@")[1].split("/")[0];Yo.includes(p)&&(e=e.replace(`@${p}/`,"/"))}n.endsWith("/")||(n+="/");let[s,a]=e.replace(n,"").split("?"),d=new URLSearchParams(a);for(let[p,l]of Object.entries(r||{}))d.set(p,String(l));if(i)if(Array.isArray(i)){let p=s.split("/").filter(l=>l.startsWith(":"));for(let[l,K]of p.entries()){let y=i[l];s=s.replace(K,y)}}else for(let[p,l]of Object.entries(i))s=s.replace(`:${p}`,String(l));s=s.split("/").map(encodeURIComponent).join("/"),s.startsWith("/")&&(s=s.slice(1));let A=d.size>0?`?${d}`.replace(/\+/g,"%20"):"";return new URL(`${s}${A}`,n)}var R=async(e,o)=>{var t,i,r,n,s,a,d,A;let{hooks:c,url:p,options:l}=await Xt(e,o),K=nr(l),y=new AbortController,h=(t=l.signal)!=null?t:y.signal,x=ur(p,l),j=dr(l),z=sr(l),g=Ar(p,l),w=Re(Ee({},l),{url:x,headers:z,body:j,method:g,signal:h});for(let P of c.onRequest)if(P){let Z=await P(w);Z instanceof Object&&(w=Z)}("pipeTo"in w&&typeof w.pipeTo=="function"||typeof((i=o?.body)==null?void 0:i.pipe)=="function")&&("duplex"in w||(w.duplex="half"));let{clearTimeout:S}=cr(l,y),C=await K(w.url,w);S();let Te={response:C,request:w};for(let P of c.onResponse)if(P){let Z=await P(Re(Ee({},Te),{response:(r=o?.hookOptions)!=null&&r.cloneResponse?C.clone():C}));Z instanceof Response?C=Z:Z instanceof Object&&(C=Z.response)}if(C.ok){if(!(w.method!=="HEAD"))return{data:"",error:null};let Z=tr(C),te={data:"",response:C,request:w};if(Z==="json"||Z==="text"){let se=await C.text(),zt=await((n=w.jsonParser)!=null?n:Jo)(se);te.data=zt}else te.data=await C[Z]();w?.output&&w.output&&!w.disableValidation&&(te.data=w.output.parse(te.data));for(let se of c.onSuccess)se&&await se(Re(Ee({},te),{response:(s=o?.hookOptions)!=null&&s.cloneResponse?C.clone():C}));return o?.throw?te.data:{data:te.data,error:null}}let wo=(a=o?.jsonParser)!=null?a:Jo,io=await C.text(),Me=rr(io)?await wo(io):{},Co={response:C,request:w,error:Re(Ee({},Me),{status:C.status,statusText:C.statusText})};for(let P of c.onError)P&&await P(Re(Ee({},Co),{response:(d=o?.hookOptions)!=null&&d.cloneResponse?C.clone():C}));if(o?.retry){let P=er(o.retry),Z=(A=o.retryAttempt)!=null?A:0;if(await P.shouldAttemptRetry(Z,C)){for(let se of c.onRetry)se&&await se(Te);let te=P.getDelay(Z);return await new Promise(se=>setTimeout(se,te)),await R(e,Re(Ee({},o),{retryAttempt:Z+1}))}}if(o?.throw)throw new Jt(C.status,C.statusText,Me);return{data:null,error:Re(Ee({},Me),{status:C.status,statusText:C.statusText})}};import{APIError as wr}from"better-call";import{decodeJwt as Cr,decodeProtectedHeader as br,importJWK as Or,jwtVerify as Tr}from"jose";import{createHash as lr}from"@better-auth/utils/hash";import{base64Url as pr}from"@better-auth/utils/base64";async function oi(e){let o=await lr("SHA-256").digest(e);return pr.encode(new Uint8Array(o),{padding:!1})}function no(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?L(e.expires_in,"sec"):void 0,scopes:e?.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token}}async function D({id:e,options:o,authorizationEndpoint:t,state:i,codeVerifier:r,scopes:n,claims:s,redirectURI:a,duration:d}){let A=new URL(t);if(A.searchParams.set("response_type","code"),A.searchParams.set("client_id",o.clientId),A.searchParams.set("state",i),A.searchParams.set("scope",n.join(" ")),A.searchParams.set("redirect_uri",o.redirectURI||a),r){let c=await oi(r);A.searchParams.set("code_challenge_method","S256"),A.searchParams.set("code_challenge",c)}if(s){let c=s.reduce((p,l)=>(p[l]=null,p),{});A.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...c}}))}return d&&A.searchParams.set("duration",d),A}import{jwtVerify as fs}from"jose";async function U({code:e,codeVerifier:o,redirectURI:t,options:i,tokenEndpoint:r,authentication:n}){let s=new URLSearchParams,a={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth"};if(s.set("grant_type","authorization_code"),s.set("code",e),o&&s.set("code_verifier",o),s.set("redirect_uri",t),n==="basic"){let p=btoa(`${i.clientId}:${i.clientSecret}`);a.authorization=`Basic ${p}`}else s.set("client_id",i.clientId),s.set("client_secret",i.clientSecret);let{data:d,error:A}=await R(r,{method:"POST",body:s,headers:a});if(A)throw A;return no(d)}import{z as ye}from"zod";import{APIError as ai}from"better-call";function Ue(e){try{return new URL(e).origin}catch{return null}}function ii(e){return e.includes("://")?new URL(e).host:e}import{createHash as ri}from"@better-auth/utils/hash";import{xchacha20poly1305 as ni}from"@noble/ciphers/chacha";import{bytesToHex as fr,hexToBytes as hr,utf8ToBytes as yr}from"@noble/ciphers/utils";import{managedNonce as si}from"@noble/ciphers/webcrypto";import{createHash as Es}from"@better-auth/utils/hash";import{SignJWT as mr}from"jose";async function ti(e,o,t=3600){return await new mr(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+t).sign(new TextEncoder().encode(o))}import{scryptAsync as Ss}from"@noble/hashes/scrypt";import{getRandomValues as Ps}from"uncrypto";import{hex as Ns}from"@better-auth/utils/hex";import{createRandomStringGenerator as gr}from"@better-auth/utils/random";var _=gr("a-z","0-9","A-Z","-_");var le=async({key:e,data:o})=>{let t=await ri("SHA-256").digest(e),i=yr(o),r=si(ni)(new Uint8Array(t));return fr(r.encrypt(i))},he=async({key:e,data:o})=>{let t=await ri("SHA-256").digest(e),i=hr(o),r=si(ni)(new Uint8Array(t));return new TextDecoder().decode(r.decrypt(i))};async function Se(e,o){let t=e.body?.callbackURL||(e.query?.currentURL?Ue(e.query?.currentURL):"")||e.context.options.baseURL;if(!t)throw new ai("BAD_REQUEST",{message:"callbackURL is required"});let i=_(128),r=_(32),n=JSON.stringify({callbackURL:t,codeVerifier:i,errorURL:e.body?.errorCallbackURL||e.query?.currentURL,newUserURL:e.body?.newUserCallbackURL,link:o,expiresAt:Date.now()+10*60*1e3}),s=new Date;s.setMinutes(s.getMinutes()+10);let a=await e.context.internalAdapter.createVerificationValue({value:n,identifier:r,expiresAt:s});if(!a)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new ai("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:a.identifier,codeVerifier:i}}async function so(e){let o=e.query.state||e.body.state,t=await e.context.internalAdapter.findVerificationValue(o);if(!t)throw e.context.logger.error("State Mismatch. Verification not found",{state:o}),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);let i=ye.object({callbackURL:ye.string(),codeVerifier:ye.string(),errorURL:ye.string().optional(),newUserURL:ye.string().optional(),expiresAt:ye.number(),link:ye.object({email:ye.string(),userId:ye.string()}).optional()}).parse(JSON.parse(t.value));if(i.errorURL||(i.errorURL=`${e.context.baseURL}/error`),i.expiresAt<Date.now())throw await e.context.internalAdapter.deleteVerificationValue(t.id),e.context.logger.error("State expired.",{state:o}),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);return await e.context.internalAdapter.deleteVerificationValue(t.id),i}var di=e=>{let o="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",createAuthorizationURL({state:t,scopes:i,redirectURI:r}){let n=i||["email","name"];return e.scope&&n.push(...e.scope),new URL(`https://appleid.apple.com/auth/authorize?client_id=${e.clientId}&response_type=code&redirect_uri=${e.redirectURI||r}&scope=${n.join(" ")}&state=${t}&response_mode=form_post`)},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r})=>U({code:t,codeVerifier:i,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:o}),async verifyIdToken(t,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,i);let r=br(t),{kid:n,alg:s}=r;if(!n||!s)return!1;let a=await Er(n),{payload:d}=await Tr(t,a,{algorithms:[s],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(A=>{d[A]!==void 0&&(d[A]=!!d[A])}),i&&d.nonce!==i?!1:!!d},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let i=Cr(t.idToken);if(!i)return null;let r=i.user?`${i.user.name.firstName} ${i.user.name.lastName}`:i.email,n=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:r,emailVerified:!1,email:i.email,...n},data:i}}}},Er=async e=>{let o="https://appleid.apple.com",t="/auth/keys",{data:i}=await R(`${o}${t}`);if(!i?.keys)throw new wr("BAD_REQUEST",{message:"Keys not found"});let r=i.keys.find(n=>n.kid===e);if(!r)throw new Error(`JWK with kid ${e} not found`);return await Or(r,r.alg)};var Ai=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:o,scopes:t,redirectURI:i}){let r=t||["identify","email"];return e.scope&&r.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${r.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||i)}&state=${o}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:o,redirectURI:t})=>U({code:o,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);let{data:t,error:i}=await R("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${o.accessToken}`}});if(i)return null;if(t.avatar===null){let n=t.discriminator==="0"?Number(BigInt(t.id)>>BigInt(22))%6:parseInt(t.discriminator)%5;t.image_url=`https://cdn.discordapp.com/embed/avatars/${n}.png`}else{let n=t.avatar.startsWith("a_")?"gif":"png";t.image_url=`https://cdn.discordapp.com/avatars/${t.id}/${t.avatar}.${n}`}let r=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.display_name||t.username||"",email:t.email,emailVerified:t.verified,image:t.image_url,...r},data:t}}});var ci=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:o,scopes:t,redirectURI:i}){let r=t||["email","public_profile"];return e.scope&&r.push(...e.scope),await D({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:r,state:o,redirectURI:i})},validateAuthorizationCode:async({code:o,redirectURI:t})=>U({code:o,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);let{data:t,error:i}=await R("https://graph.facebook.com/me?fields=id,name,email,picture",{auth:{type:"Bearer",token:o.accessToken}});if(i)return null;let r=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.name,email:t.email,image:t.picture.data.url,emailVerified:t.email_verified,...r},data:t}}});var ui=e=>{let o="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:t,scopes:i,codeVerifier:r,redirectURI:n}){let s=i||["user:email"];return e.scope&&s.push(...e.scope),D({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:s,state:t,redirectURI:n})},validateAuthorizationCode:async({code:t,redirectURI:i})=>U({code:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:o}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:r}=await R("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${t.accessToken}`}});if(r)return null;let n=!1,{data:s}=await R("https://api.github.com/user/emails",{headers:{authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});s&&(i.email=(s.find(d=>d.primary)??s[0])?.email,n=s.find(d=>d.email===i.email)?.verified??!1);let a=await e.mapProfileToUser?.(i);return{user:{id:i.id.toString(),name:i.name||i.login,email:i.email,image:i.avatar_url,emailVerified:n,...a},data:i}}}};var To=["info","success","warn","error","debug"];function Rr(e,o){return To.indexOf(o)<=To.indexOf(e)}var pe={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},Ir={info:pe.fg.blue,success:pe.fg.green,warn:pe.fg.yellow,error:pe.fg.red,debug:pe.fg.magenta},_r=(e,o)=>{let t=new Date().toISOString();return`${pe.dim}${t}${pe.reset} ${Ir[e]}${e.toUpperCase()}${pe.reset} ${pe.bright}[Better Auth]:${pe.reset} ${o}`},li=e=>{let o=e?.disabled!==!0,t=e?.level??"error",i=(r,n,s=[])=>{if(!o||!Rr(t,r))return;let a=_r(r,n);if(!e||typeof e.log!="function"){r==="error"?console.error(a,...s):r==="warn"?console.warn(a,...s):console.log(a,...s);return}e.log(r==="success"?"info":r,a,...s)};return Object.fromEntries(To.map(r=>[r,(...[n,...s])=>i(r,n,s)]))},re=li();import{decodeJwt as vr}from"jose";var pi=e=>({id:"google",name:"Google",async createAuthorizationURL({state:o,scopes:t,codeVerifier:i,redirectURI:r}){if(!e.clientId||!e.clientSecret)throw re.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new ae("CLIENT_ID_AND_SECRET_REQUIRED");if(!i)throw new ae("codeVerifier is required for Google");let n=t||["email","profile","openid"];e.scope&&n.push(...e.scope);let s=await D({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:n,state:o,codeVerifier:i,redirectURI:r});return e.accessType&&s.searchParams.set("access_type",e.accessType),e.prompt&&s.searchParams.set("prompt",e.prompt),s},validateAuthorizationCode:async({code:o,codeVerifier:t,redirectURI:i})=>U({code:o,codeVerifier:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),async verifyIdToken(o,t){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(o,t);let i=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${o}`,{data:r}=await R(i);return r?r.aud===e.clientId&&r.iss==="https://accounts.google.com":!1},async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);if(!o.idToken)return null;let t=vr(o.idToken),i=await e.mapProfileToUser?.(t);return{user:{id:t.sub,name:t.name,email:t.email,image:t.picture,emailVerified:t.email_verified,...i},data:t}}});import{decodeJwt as Ur}from"jose";var Ki=e=>{let o=e.tenantId||"common",t=`https://login.microsoftonline.com/${o}/oauth2/v2.0/authorize`,i=`https://login.microsoftonline.com/${o}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(r){let n=r.scopes||["openid","profile","email","User.Read"];return e.scope&&n.push(...e.scope),D({id:"microsoft",options:e,authorizationEndpoint:t,state:r.state,codeVerifier:r.codeVerifier,scopes:n,redirectURI:r.redirectURI})},validateAuthorizationCode({code:r,codeVerifier:n,redirectURI:s}){return U({code:r,codeVerifier:n,redirectURI:e.redirectURI||s,options:e,tokenEndpoint:i})},async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;let n=Ur(r.idToken),s=e.profilePhotoSize||48;await R(`https://graph.microsoft.com/v1.0/me/photos/${s}x${s}/$value`,{headers:{Authorization:`Bearer ${r.accessToken}`},async onResponse(d){if(!(e.disableProfilePhoto||!d.response.ok))try{let c=await d.response.clone().arrayBuffer(),p=Buffer.from(c).toString("base64");n.picture=`data:image/jpeg;base64, ${p}`}catch(A){re.error(A&&typeof A=="object"&&"name"in A?A.name:"",A)}}});let a=await e.mapProfileToUser?.(n);return{user:{id:n.sub,name:n.name,email:n.email,image:n.picture,emailVerified:!0,...a},data:n}}}};var mi=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:o,scopes:t,codeVerifier:i,redirectURI:r}){let n=t||["user-read-email"];return e.scope&&n.push(...e.scope),D({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:n,state:o,codeVerifier:i,redirectURI:r})},validateAuthorizationCode:async({code:o,codeVerifier:t,redirectURI:i})=>U({code:o,codeVerifier:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);let{data:t,error:i}=await R("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${o.accessToken}`}});if(i)return null;let r=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.display_name,email:t.email,image:t.images[0]?.url,emailVerified:!1,...r},data:t}}});var ke={isAction:!1};import{createRandomStringGenerator as Sr}from"@better-auth/utils/random";var ee=e=>Sr("a-z","A-Z","0-9")(e||32);import{decodeJwt as kr}from"jose";var gi=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:o,scopes:t,redirectURI:i}){let r=t||["user:read:email","openid"];return e.scope&&r.push(...e.scope),D({id:"twitch",redirectURI:i,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:r,state:o,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:o,redirectURI:t})=>U({code:o,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);let t=o.idToken;if(!t)return re.error("No idToken found in token"),null;let i=kr(t),r=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.preferred_username,email:i.email,image:i.picture,emailVerified:!1,...r},data:i}}});var fi=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(o){let t=o.scopes||["users.read","tweet.read","offline.access"];return e.scope&&t.push(...e.scope),D({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:t,state:o.state,codeVerifier:o.codeVerifier,redirectURI:o.redirectURI})},validateAuthorizationCode:async({code:o,codeVerifier:t,redirectURI:i})=>U({code:o,codeVerifier:t,authentication:"basic",redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);let{data:t,error:i}=await R("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${o.accessToken}`}});if(i)return null;let r=await e.mapProfileToUser?.(t);return{user:{id:t.data.id,name:t.data.name,email:t.data.username||null,image:t.data.profile_image_url,emailVerified:t.data.verified||!1,...r},data:t}}});var hi=e=>{let o="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:t,scopes:i,codeVerifier:r,redirectURI:n})=>{let s=i||["account_info.read"];return e.scope&&s.push(...e.scope),await D({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:s,state:t,redirectURI:n,codeVerifier:r})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:r})=>await U({code:t,codeVerifier:i,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:o}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:r}=await R("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`}});if(r)return null;let n=await e.mapProfileToUser?.(i);return{user:{id:i.account_id,name:i.name?.display_name,email:i.email,emailVerified:i.email_verified||!1,image:i.profile_photo_url,...n},data:i}}}};var yi=e=>{let o="https://www.linkedin.com/oauth/v2/authorization",t="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:i,scopes:r,redirectURI:n})=>{let s=r||["profile","email","openid"];return e.scope&&s.push(...e.scope),await D({id:"linkedin",options:e,authorizationEndpoint:o,scopes:s,state:i,redirectURI:n})},validateAuthorizationCode:async({code:i,redirectURI:r})=>await U({code:i,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:t}),async getUserInfo(i){let{data:r,error:n}=await R("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${i.accessToken}`}});if(n)return null;let s=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,emailVerified:r.email_verified||!1,image:r.picture,...s},data:r}}}};var Eo=(e="")=>e.split("://").map(o=>o.replace(/\/{2,}/g,"/")).join("://"),Pr=e=>{let o=e||"https://gitlab.com";return{authorizationEndpoint:Eo(`${o}/oauth/authorize`),tokenEndpoint:Eo(`${o}/oauth/token`),userinfoEndpoint:Eo(`${o}/api/v4/user`)}},wi=e=>{let{authorizationEndpoint:o,tokenEndpoint:t,userinfoEndpoint:i}=Pr(e.issuer),r="gitlab";return{id:r,name:"Gitlab",createAuthorizationURL:async({state:s,scopes:a,codeVerifier:d,redirectURI:A})=>{let c=a||["read_user"];return e.scope&&c.push(...e.scope),await D({id:r,options:e,authorizationEndpoint:o,scopes:c,state:s,redirectURI:A,codeVerifier:d})},validateAuthorizationCode:async({code:s,redirectURI:a,codeVerifier:d})=>U({code:s,redirectURI:e.redirectURI||a,options:e,codeVerifier:d,tokenEndpoint:t}),async getUserInfo(s){if(e.getUserInfo)return e.getUserInfo(s);let{data:a,error:d}=await R(i,{headers:{authorization:`Bearer ${s.accessToken}`}});if(d||a.state!=="active"||a.locked)return null;let A=await e.mapProfileToUser?.(a);return{user:{id:a.id.toString(),name:a.name??a.username,email:a.email,image:a.avatar_url,emailVerified:!0,...A},data:a}}}};var Ci=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:o,scopes:t,redirectURI:i}){let r=t||["identity"];return e.scope&&r.push(...e.scope),D({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:r,state:o,redirectURI:i,duration:e.duration})},validateAuthorizationCode:async({code:o,redirectURI:t})=>{let i=new URLSearchParams({grant_type:"authorization_code",code:o,redirect_uri:e.redirectURI||t}),r={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${Buffer.from(`${e.clientId}:${e.clientSecret}`).toString("base64")}`},{data:n,error:s}=await R("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:r,body:i.toString()});if(s)throw s;return no(n)},async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);let{data:t,error:i}=await R("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${o.accessToken}`,"User-Agent":"better-auth"}});if(i)return null;let r=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.name,email:t.oauth_client_id,emailVerified:t.has_verified_email,image:t.icon_img?.split("?")[0],...r},data:t}}});var bi=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:o,scopes:t,redirectURI:i}){let r=t||["openid","profile"];return e.scope&&r.push(...e.scope),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${r.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||i)}&state=${o}&prompt=${e.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:o,redirectURI:t})=>U({code:o,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);let{data:t,error:i}=await R("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${o.accessToken}`}});return i?null:{user:{id:t.sub,name:t.nickname||t.preferred_username||"",image:t.picture,email:"",emailVerified:!0},data:{...t}}}});import{z as Dr}from"zod";var Nr={apple:di,discord:Ai,facebook:ci,github:ui,microsoft:Ki,google:pi,spotify:mi,twitch:gi,twitter:fi,dropbox:hi,linkedin:yi,gitlab:wi,reddit:Ci,roblox:bi},Ro=Object.keys(Nr),Oi=Dr.enum(Ro,{description:"OAuth2 provider to use"});import{z as de}from"zod";import{APIError as He}from"better-call";import{APIError as we}from"better-call";import{z as Ie}from"zod";function Io(e){try{return JSON.parse(e)}catch{return null}}var f={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action."};import{createHMAC as Lr}from"@better-auth/utils/hmac";import{base64 as xr}from"@better-auth/utils/base64";import{binary as jr}from"@better-auth/utils/binary";var _o=()=>u("/get-session",{method:"GET",query:Ie.optional(Ie.object({disableCookieCache:Ie.boolean({description:"Disable cookie cache and fetch session from database"}).or(Ie.string().transform(e=>e==="true")).optional(),disableRefresh:Ie.boolean({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{type:"object",properties:{token:{type:"string"},userId:{type:"string"},expiresAt:{type:"string"}}},user:{type:"object",$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{try{let o=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!o)return e.json(null);let t=e.getCookie(e.context.authCookies.sessionData.name),i=t?Io(jr.decode(xr.decode(t))):null;if(i&&!await Lr("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify(i.session),i.signature))return G(e),e.json(null);let r=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(i?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){let c=i.session;if(i.expiresAt<Date.now()||c.session.expiresAt<new Date){let l=e.context.authCookies.sessionData.name;e.setCookie(l,"",{maxAge:0})}else return e.json(c)}let n=await e.context.internalAdapter.findSession(o);if(e.context.session=n,!n||n.session.expiresAt<new Date)return G(e),n&&await e.context.internalAdapter.deleteSession(n.session.token),e.json(null);if(r||e.query?.disableRefresh)return e.json(n);let s=e.context.sessionConfig.expiresIn,a=e.context.sessionConfig.updateAge;if(n.session.expiresAt.valueOf()-s*1e3+a*1e3<=Date.now()){let c=await e.context.internalAdapter.updateSession(n.session.token,{expiresAt:L(e.context.sessionConfig.expiresIn,"sec")});if(!c)return G(e),e.json(null,{status:401});let p=(c.expiresAt.valueOf()-Date.now())/1e3;return await b(e,{session:c,user:n.user},!1,{maxAge:p}),e.json({session:c,user:n.user})}return await Oo(e,n),e.json(n)}catch(o){throw e.context.logger.error("INTERNAL_SERVER_ERROR",o),new we("INTERNAL_SERVER_ERROR",{message:f.FAILED_TO_GET_SESSION})}}),v=async(e,o)=>{if(e.context.session)return e.context.session;let t=await _o()({...e,_flag:"json",headers:e.headers,query:o}).catch(i=>null);return e.context.session=t,t},I=N(async e=>{let o=await v(e);if(!o?.session)throw new we("UNAUTHORIZED");return{session:o}}),tA=N(async e=>{let o=await v(e);if(!o?.session)throw new we("UNAUTHORIZED");if(e.context.sessionConfig.freshAge===0)return{session:o};let t=e.context.sessionConfig.freshAge,i=o.session.updatedAt?.valueOf()||o.session.createdAt.valueOf();if(!(Date.now()-i<t*1e3))throw new we("FORBIDDEN",{message:"Session is not fresh"});return{session:o}}),Ti=()=>u("/list-sessions",{method:"GET",use:[I],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{token:{type:"string"},userId:{type:"string"},expiresAt:{type:"string"}}}}}}}}}}},async e=>{let t=(await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter(i=>i.expiresAt>new Date);return e.json(t)}),Ei=u("/revoke-session",{method:"POST",body:Ie.object({token:Ie.string({description:"The token to revoke"})}),use:[I],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}},required:["token"]}}}}}}},async e=>{let o=e.body.token,t=await e.context.internalAdapter.findSession(o);if(!t)throw new we("BAD_REQUEST",{message:"Session not found"});if(t.session.userId!==e.context.session.user.id)throw new we("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(o)}catch(i){throw e.context.logger.error(i&&typeof i=="object"&&"name"in i?i.name:"",i),new we("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),Ri=u("/revoke-sessions",{method:"POST",use:[I],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(o){throw e.context.logger.error(o&&typeof o=="object"&&"name"in o?o.name:"",o),new we("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),Ii=u("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[I],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let o=e.context.session;if(!o.user)throw new we("UNAUTHORIZED");let r=(await e.context.internalAdapter.listSessions(o.user.id)).filter(n=>n.expiresAt>new Date).filter(n=>n.token!==e.context.session.session.token);return await Promise.all(r.map(n=>e.context.internalAdapter.deleteSession(n.token))),e.json({status:!0})});import{jwtVerify as zr}from"jose";async function Ke(e,o,t){return await ti({email:o.toLowerCase(),updateTo:t},e)}async function vo(e,o){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new He("BAD_REQUEST",{message:"Verification email isn't enabled"});let t=await Ke(e.context.secret,o.email),i=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${e.body.callbackURL||e.query?.currentURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:o,url:i,token:t},e.request)}var _i=u("/send-verification-email",{method:"POST",query:de.object({currentURL:de.string({description:"The URL to use for email verification callback"}).optional()}).optional(),body:de.object({email:de.string({description:"The email to send the verification email to"}).email(),callbackURL:de.string({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to"},callbackURL:{type:"string",description:"The URL to use for email verification callback"}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new He("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:o}=e.body,t=await e.context.internalAdapter.findUserByEmail(o);if(!t)throw new He("BAD_REQUEST",{message:f.USER_NOT_FOUND});return await vo(e,t.user),e.json({status:!0})}),vi=u("/verify-email",{method:"GET",query:de.object({token:de.string({description:"The token to verify the email"}),callbackURL:de.string({description:"The URL to redirect to after email verification"}).optional()}),metadata:{openapi:{description:"Verify the email of the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object"},status:{type:"boolean"}},required:["user","status"]}}}}}}}},async e=>{function o(a){throw e.query.callbackURL?e.query.callbackURL.includes("?")?e.redirect(`${e.query.callbackURL}&error=${a}`):e.redirect(`${e.query.callbackURL}?error=${a}`):new He("UNAUTHORIZED",{message:a})}let{token:t}=e.query,i;try{i=await zr(t,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(a){return e.context.logger.error("Failed to verify email",a),o("invalid_token")}let n=de.object({email:de.string().email(),updateTo:de.string().optional()}).parse(i.payload),s=await e.context.internalAdapter.findUserByEmail(n.email);if(!s)return o("user_not_found");if(n.updateTo){let a=await v(e);if(!a){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return o("unauthorized")}if(a.user.email!==n.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return o("unauthorized")}let d=await e.context.internalAdapter.updateUserByEmail(n.email,{email:n.updateTo,emailVerified:!1}),A=await Ke(e.context.secret,n.updateTo);if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${e.context.baseURL}/verify-email?token=${A}`,token:A},e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0})}if(await e.context.internalAdapter.updateUserByEmail(n.email,{emailVerified:!0}),e.context.options.emailVerification?.autoSignInAfterVerification){let a=await v(e);if(!a||a.user.email!==n.email){let d=await e.context.internalAdapter.createSession(s.user.id,e.request);if(!d)throw new He("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await b(e,{session:d,user:s.user})}}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0})});import{APIError as De,createRouter as YA,getCookie as Qr,getSignedCookie as Wr,setCookie as Jr,setSignedCookie as Xr}from"better-call";import{APIError as Mr}from"better-call";function Uo(e){return e==="-"||e==="^"||e==="$"||e==="+"||e==="."||e==="("||e===")"||e==="|"||e==="["||e==="]"||e==="{"||e==="}"||e==="*"||e==="?"||e==="\\"?`\\${e}`:e}function Br(e){let o="";for(let t=0;t<e.length;t++)o+=Uo(e[t]);return o}function Ui(e,o=!0){if(Array.isArray(e))return`(?:${e.map(c=>`^${Ui(c,o)}$`).join("|")})`;let t="",i="",r=".";o===!0?(t="/",i="[/\\\\]",r="[^/\\\\]"):o&&(t=o,i=Br(t),i.length>1?(i=`(?:${i})`,r=`((?!${i}).)`):r=`[^${i}]`);let n=o?`${i}+?`:"",s=o?`${i}*?`:"",a=o?e.split(t):[e],d="";for(let A=0;A<a.length;A++){let c=a[A],p=a[A+1],l="";if(!(!c&&A>0)){if(o&&(A===a.length-1?l=s:p!=="**"?l=n:l=""),o&&c==="**"){l&&(d+=A===0?"":l,d+=`(?:${r}*?${l})*?`);continue}for(let K=0;K<c.length;K++){let y=c[K];y==="\\"?K<c.length-1&&(d+=Uo(c[K+1]),K++):y==="?"?d+=r:y==="*"?d+=`${r}*?`:d+=Uo(y)}d+=l}}return d}function Fr(e,o){if(typeof o!="string")throw new TypeError(`Sample must be a string, but ${typeof o} given`);return e.test(o)}function So(e,o){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if((typeof o=="string"||typeof o=="boolean")&&(o={separator:o}),arguments.length===2&&!(typeof o>"u"||typeof o=="object"&&o!==null&&!Array.isArray(o)))throw new TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof o} given`);if(o=o||{},o.separator==="\\")throw new Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let t=Ui(e,o.separator),i=new RegExp(`^${t}$`,o.flags),r=Fr.bind(null,i);return r.options=o,r.pattern=e,r.regexp=i,r}var Vr=N(async e=>{if(e.request?.method!=="POST")return;let{body:o,query:t,context:i}=e,r=e.headers?.get("origin")||e.headers?.get("referer")||"",n=o?.callbackURL||t?.callbackURL,s=o?.redirectTo,a=t?.currentURL,d=o?.errorCallbackURL,A=o?.newUserCallbackURL,c=i.trustedOrigins,p=e.headers?.has("cookie"),l=(y,h)=>y.startsWith("/")?!1:h.includes("*")?So(h)(ii(y)):y.startsWith(h),K=(y,h)=>{if(!y)return;if(!c.some(j=>l(y,j)||y?.startsWith("/")&&h!=="origin"&&!y.includes(":")))throw e.context.logger.error(`Invalid ${h}: ${y}`),e.context.logger.info(`If it's a valid URL, please add ${y} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${c}`),new Mr("FORBIDDEN",{message:`Invalid ${h}`})};p&&!e.context.options.advanced?.disableCSRFCheck&&K(r,"origin"),n&&K(n,"callbackURL"),s&&K(s,"redirectURL"),a&&K(a,"currentURL"),d&&K(d,"errorCallbackURL"),A&&K(s,"newUserCallbackURL")});var Si=u("/ok",{method:"GET",metadata:{...ke,openapi:{description:"Check if the API is working",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean"}}}}}}}}}},async e=>e.json({ok:!0}));import{z as Pe}from"zod";import{APIError as Ce}from"better-call";import{z as E}from"zod";import{APIError as qr}from"better-call";var EA=E.object({id:E.string(),providerId:E.string(),accountId:E.string(),name:E.string().nullish(),userId:E.string(),accessToken:E.string().nullish(),refreshToken:E.string().nullish(),idToken:E.string().nullish(),accessTokenExpiresAt:E.date().nullish(),refreshTokenExpiresAt:E.date().nullish(),scope:E.string().nullish(),password:E.string().nullish(),image:E.string().nullish(),createdAt:E.date().default(()=>new Date),updatedAt:E.date().default(()=>new Date)}),RA=E.object({id:E.string(),email:E.string().transform(e=>e.toLowerCase()),emailVerified:E.boolean().default(!1),name:E.string(),image:E.string().nullish(),createdAt:E.date().default(()=>new Date),updatedAt:E.date().default(()=>new Date)}),IA=E.object({id:E.string(),userId:E.string(),expiresAt:E.date(),createdAt:E.date().default(()=>new Date),updatedAt:E.date().default(()=>new Date),token:E.string(),ipAddress:E.string().nullish(),userAgent:E.string().nullish()}),_A=E.object({id:E.string(),value:E.string(),createdAt:E.date().default(()=>new Date),updatedAt:E.date().default(()=>new Date),expiresAt:E.date(),identifier:E.string()});function Hr(e,o){let t={...o==="user"?e.user?.additionalFields:{},...o==="session"?e.session?.additionalFields:{}};for(let i of e.plugins||[])i.schema&&i.schema[o]&&(t={...t,...i.schema[o].fields});return t}function $r(e,o){let t=o.action||"create",i=o.fields,r={};for(let n in i){if(n in e){if(i[n].input===!1){if(i[n].defaultValue){r[n]=i[n].defaultValue;continue}continue}if(i[n].validator?.input&&e[n]!==void 0){r[n]=i[n].validator.input.parse(e[n]);continue}if(i[n].transform?.input&&e[n]!==void 0){r[n]=i[n].transform?.input(e[n]);continue}r[n]=e[n];continue}if(i[n].defaultValue&&t==="create"){r[n]=i[n].defaultValue;continue}if(i[n].required&&t==="create")throw new qr("BAD_REQUEST",{message:`${n} is required`})}return r}function ao(e,o,t){let i=Hr(e,"user");return $r(o||{},{fields:i,action:t})}function me(e,o){if(!o)return e;for(let t in o){let i=o[t]?.modelName;i&&(e[t].modelName=i);for(let r in e[t].fields){let n=o[t]?.fields?.[r];n&&(e[t].fields[r].fieldName=n)}}return e}var ki=()=>u("/sign-up/email",{method:"POST",query:Pe.object({currentURL:Pe.string().optional()}).optional(),body:Pe.record(Pe.string(),Pe.any()),metadata:{openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"}},required:["name","email","password"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string",description:"The id of the user"},email:{type:"string",description:"The email of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"},emailVerified:{type:"boolean",description:"If the email is verified"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.enabled)throw new Ce("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let o=e.body,{name:t,email:i,password:r,image:n,callbackURL:s,...a}=o;if(!Pe.string().email().safeParse(i).success)throw new Ce("BAD_REQUEST",{message:f.INVALID_EMAIL});let A=e.context.password.config.minPasswordLength;if(r.length<A)throw e.context.logger.error("Password is too short"),new Ce("BAD_REQUEST",{message:f.PASSWORD_TOO_SHORT});let c=e.context.password.config.maxPasswordLength;if(r.length>c)throw e.context.logger.error("Password is too long"),new Ce("BAD_REQUEST",{message:f.PASSWORD_TOO_LONG});if((await e.context.internalAdapter.findUserByEmail(i))?.user)throw e.context.logger.info(`Sign-up attempt for existing email: ${i}`),new Ce("UNPROCESSABLE_ENTITY",{message:f.USER_ALREADY_EXISTS});let l=ao(e.context.options,a),K;try{if(K=await e.context.internalAdapter.createUser({email:i.toLowerCase(),name:t,image:n,...l,emailVerified:!1}),!K)throw new Ce("BAD_REQUEST",{message:f.FAILED_TO_CREATE_USER})}catch(x){throw ro&&e.context.logger.error("Failed to create user",x),new Ce("UNPROCESSABLE_ENTITY",{message:f.FAILED_TO_CREATE_USER,details:x})}if(!K)throw new Ce("UNPROCESSABLE_ENTITY",{message:f.FAILED_TO_CREATE_USER});let y=await e.context.password.hash(r);if(await e.context.internalAdapter.linkAccount({userId:K.id,providerId:"credential",accountId:K.id,password:y}),e.context.options.emailVerification?.sendOnSignUp||e.context.options.emailAndPassword.requireEmailVerification){let x=await Ke(e.context.secret,K.email),j=`${e.context.baseURL}/verify-email?token=${x}&callbackURL=${o.callbackURL||e.query?.currentURL||"/"}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:K,url:j,token:x},e.request)}if(!e.context.options.emailAndPassword.autoSignIn||e.context.options.emailAndPassword.requireEmailVerification)return e.json({token:null});let h=await e.context.internalAdapter.createSession(K.id,e.request);if(!h)throw new Ce("BAD_REQUEST",{message:f.FAILED_TO_CREATE_SESSION});return await b(e,{session:h,user:K}),e.json({token:h.token})});var Zr=(e="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${e}</span></div>
    </div>
</body>
</html>`,Pi=u("/error",{method:"GET",metadata:{...ke,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string"}}}}}}}},async e=>{let o=new URL(e.request?.url||"").searchParams.get("error")||"Unknown";return new Response(Zr(o),{headers:{"Content-Type":"text/html"}})});import"defu";import{APIError as m}from"better-call";function ko(e,o){let t=o.plugins?.reduce((a,d)=>({...a,...d.endpoints}),{}),i=o.plugins?.map(a=>a.middlewares?.map(d=>{let A=async c=>d.middleware({...c,context:{...e,...c.context}});return A.path=d.path,A.options=d.middleware.options,A.headers=d.middleware.headers,{path:d.path,middleware:A}})).filter(a=>a!==void 0).flat()||[],n={...{signInSocial:Di,callbackOAuth:Li,getSession:_o(),signOut:xi,signUpEmail:ki(),signInEmail:Ni,forgetPassword:ji,resetPassword:Bi,verifyEmail:vi,sendVerificationEmail:_i,changeEmail:Hi,changePassword:Mi,setPassword:Vi,updateUser:Fi(),deleteUser:qi,forgetPasswordCallback:zi,listSessions:Ti(),revokeSession:Ei,revokeSessions:Ri,revokeOtherSessions:Ii,linkSocialAccount:Zi,listUserAccounts:$i,deleteUserCallback:Po},...t,ok:Si,error:Pi},s={};for(let[a,d]of Object.entries(n))s[a]=async(A={})=>{d.headers=new Headers;let c={setHeader(g,w){d.headers.set(g,w)},setCookie(g,w,S){Jr(d.headers,g,w,S)},getCookie(g,w){let C=A.headers?.get("cookie");return Qr(C||"",g,w)},getSignedCookie(g,w,S){let C=A.headers;return C?Wr(C,w,g,S):null},async setSignedCookie(g,w,S,C){await Xr(d.headers,g,w,S,C)},redirect(g){return d.headers.set("Location",g),new De("FOUND")},responseHeader:d.headers},p=await e,l=null,K={...c,...A,path:d.path,context:{...p,...A.context,session:null,setNewSession:function(g){this.newSession=g,l=g}}},y=o.plugins||[],h=y.map(g=>{if(g.hooks?.before)return g.hooks.before}).filter(g=>g!==void 0).flat(),x=y.map(g=>{if(g.hooks?.after)return g.hooks.after}).filter(g=>g!==void 0).flat();o.hooks?.before&&h.push({matcher:()=>!0,handler:o.hooks.before}),o.hooks?.after&&x.push({matcher:()=>!0,handler:o.hooks.after});for(let g of h){if(!g.matcher(K))continue;let w=await g.handler(K);if(w&&"context"in w){K={...K,...w.context};continue}if(w)return w}let j;try{j=await d(K),l&&(K.context.newSession=l)}catch(g){if(l&&(K.context.newSession=l),g instanceof De){if(!x?.length)throw g.headers=d.headers,g;K.context.returned=g,K.context.returned.headers=d.headers;for(let w of x||[])if(w.matcher(K))try{let C=await w.handler(K);C&&"response"in C&&(K.context.returned=C.response)}catch(C){if(C instanceof De){K.context.returned=C;continue}throw C}if(K.context.returned instanceof De)throw K.context.returned.headers=d.headers,K.context.returned;return K.context.returned}throw g}K.context.returned=j,K.responseHeader=d.headers;for(let g of x)if(g.matcher(K))try{let S=await g.handler(K);if(S)if("responseHeader"in S){let C=S.responseHeader;K.responseHeader=C}else K.context.returned=S}catch(S){if(S instanceof De){K.context.returned=S;continue}throw S}let z=K.context.returned;if(z instanceof Response&&d.headers.forEach((g,w)=>{w==="set-cookie"?z.headers.append(w,g):z.headers.set(w,g)}),z instanceof De)throw z.headers=d.headers,z;return z},s[a].path=d.path,s[a].method=d.method,s[a].options=d.options,s[a].headers=d.headers;return{api:s,middlewares:i}}async function Ne(e,{userInfo:o,account:t,callbackURL:i}){let r=await e.context.internalAdapter.findOAuthUser(o.email.toLowerCase(),t.accountId,t.providerId).catch(d=>{throw re.error(`Better auth was unable to query your database.
Error: `,d),e.redirect(`${e.context.baseURL}/error?error=internal_server_error`)}),n=r?.user,s=!n;if(r){let d=r.accounts.find(A=>A.providerId===t.providerId);if(d){let A=Object.fromEntries(Object.entries({accessToken:t.accessToken,idToken:t.idToken,refreshToken:t.refreshToken,accessTokenExpiresAt:t.accessTokenExpiresAt,refreshTokenExpiresAt:t.refreshTokenExpiresAt}).filter(([c,p])=>p!==void 0));Object.keys(A).length>0&&await e.context.internalAdapter.updateAccount(d.id,A)}else{if(!e.context.options.account?.accountLinking?.trustedProviders?.includes(t.providerId)&&!o.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return ro&&re.warn(`User already exist but account isn't linked to ${t.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:t.providerId,accountId:o.id.toString(),userId:r.user.id,accessToken:t.accessToken,idToken:t.idToken,refreshToken:t.refreshToken,accessTokenExpiresAt:t.accessTokenExpiresAt,refreshTokenExpiresAt:t.refreshTokenExpiresAt,scope:t.scope})}catch(p){return re.error("Unable to link account",p),{error:"unable to link account",data:null}}}}else try{if(n=await e.context.internalAdapter.createOAuthUser({...o,email:o.email.toLowerCase(),id:void 0},{accessToken:t.accessToken,idToken:t.idToken,refreshToken:t.refreshToken,accessTokenExpiresAt:t.accessTokenExpiresAt,refreshTokenExpiresAt:t.refreshTokenExpiresAt,scope:t.scope,providerId:t.providerId,accountId:o.id.toString()}).then(d=>d?.user),!o.emailVerified&&n&&e.context.options.emailVerification?.sendOnSignUp){let d=await Ke(e.context.secret,n.email),A=`${e.context.baseURL}/verify-email?token=${d}&callbackURL=${i}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:n,url:A,token:d},e.request)}}catch(d){return d instanceof m?{error:d.message,data:null,isRegister:!1}:{error:"unable to create user",data:null,isRegister:!1}}if(!n)return{error:"unable to create user",data:null,isRegister:!1};let a=await e.context.internalAdapter.createSession(n.id,e.request);return a?{data:{session:a,user:n},error:null,isRegister:s}:{error:"unable to create session",data:null,isRegister:!1}}var Di=u("/sign-in/social",{method:"POST",query:q.object({currentURL:q.string().optional()}).optional(),body:q.object({callbackURL:q.string({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:q.string().optional(),errorCallbackURL:q.string({description:"Callback URL to redirect to if an error happens"}).optional(),provider:Oi,disableRedirect:q.boolean({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:q.optional(q.object({token:q.string({description:"ID token from the provider"}),nonce:q.string({description:"Nonce used to generate the token"}).optional(),accessToken:q.string({description:"Access token from the provider"}).optional(),refreshToken:q.string({description:"Refresh token from the provider"}).optional(),expiresAt:q.number({description:"Expiry date of the token"}).optional()}),{description:"ID token from the provider to sign in the user with id token"})}),metadata:{openapi:{description:"Sign in with a social provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{type:"string"},user:{type:"object"},url:{type:"string"},redirect:{type:"boolean"}},required:["session","user","url","redirect"]}}}}}}}},async e=>{let o=e.context.socialProviders.find(n=>n.id===e.body.provider);if(!o)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new W("NOT_FOUND",{message:f.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!o.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new W("NOT_FOUND",{message:f.ID_TOKEN_NOT_SUPPORTED});let{token:n,nonce:s}=e.body.idToken;if(!await o.verifyIdToken(n,s))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new W("UNAUTHORIZED",{message:f.INVALID_TOKEN});let d=await o.getUserInfo({idToken:n,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!d||!d?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new W("UNAUTHORIZED",{message:f.FAILED_TO_GET_USER_INFO});if(!d.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new W("UNAUTHORIZED",{message:f.USER_EMAIL_NOT_FOUND});let A=await Ne(e,{userInfo:{email:d.user.email,id:d.user.id,name:d.user.name||"",image:d.user.image,emailVerified:d.user.emailVerified||!1},account:{providerId:o.id,accountId:d.user.id,accessToken:e.body.idToken.accessToken}});if(A.error)throw new W("UNAUTHORIZED",{message:A.error});return await b(e,A.data),e.json({token:A.data.session.token,url:void 0,redirect:!1})}let{codeVerifier:t,state:i}=await Se(e),r=await o.createAuthorizationURL({state:i,codeVerifier:t,redirectURI:`${e.context.baseURL}/callback/${o.id}`});return e.json({url:r.toString(),redirect:!e.body.disableRedirect})}),Ni=u("/sign-in/email",{method:"POST",body:q.object({email:q.string({description:"Email of the user"}),password:q.string({description:"Password of the user"}),callbackURL:q.string({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:q.boolean({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object"},url:{type:"string"},redirect:{type:"boolean"}},required:["session","user","url","redirect"]}}}}}}}},async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new W("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:o,password:t}=e.body;if(!q.string().email().safeParse(o).success)throw new W("BAD_REQUEST",{message:f.INVALID_EMAIL});let r=await e.context.internalAdapter.findUserByEmail(o,{includeAccounts:!0});if(!r)throw await e.context.password.hash(t),e.context.logger.error("User not found",{email:o}),new W("UNAUTHORIZED",{message:f.INVALID_EMAIL_OR_PASSWORD});let n=r.accounts.find(A=>A.providerId==="credential");if(!n)throw e.context.logger.error("Credential account not found",{email:o}),new W("UNAUTHORIZED",{message:f.INVALID_EMAIL_OR_PASSWORD});let s=n?.password;if(!s)throw e.context.logger.error("Password not found",{email:o}),new W("UNAUTHORIZED",{message:f.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:s,password:t}))throw e.context.logger.error("Invalid password"),new W("UNAUTHORIZED",{message:f.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!r.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new W("UNAUTHORIZED",{message:f.EMAIL_NOT_VERIFIED});let A=await Ke(e.context.secret,r.user.email),c=`${e.context.baseURL}/verify-email?token=${A}&callbackURL=${e.body.callbackURL||"/"}`;throw await e.context.options.emailVerification.sendVerificationEmail({user:r.user,url:c,token:A},e.request),new W("FORBIDDEN",{message:f.EMAIL_NOT_VERIFIED})}let d=await e.context.internalAdapter.createSession(r.user.id,e.headers,e.body.rememberMe===!1);if(!d)throw e.context.logger.error("Failed to create session"),new W("UNAUTHORIZED",{message:f.FAILED_TO_CREATE_SESSION});return await b(e,{session:d,user:r.user},e.body.rememberMe===!1),e.json({user:{id:r.user.id,email:r.user.email,name:r.user.name,image:r.user.image,emailVerified:r.user.emailVerified,createdAt:r.user.createdAt,updatedAt:r.user.updatedAt},token:d.token,redirect:!!e.body.callbackURL,url:e.body.callbackURL})});import{z as $e}from"zod";var Ao=$e.object({code:$e.string().optional(),error:$e.string().optional(),error_description:$e.string().optional(),state:$e.string().optional()}),Li=u("/callback/:id",{method:["GET","POST"],body:Ao.optional(),query:Ao.optional(),metadata:ke},async e=>{let o;try{if(e.method==="GET")o=Ao.parse(e.query);else if(e.method==="POST")o=Ao.parse(e.body);else throw new Error("Unsupported method")}catch(g){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",g),e.redirect(`${e.context.baseURL}/error?error=invalid_callback_request`)}let{code:t,error:i,state:r,error_description:n}=o;if(!r)throw e.context.logger.error("State not found",i),e.redirect(`${e.context.baseURL}/error?error=state_not_found`);if(!t)throw e.context.logger.error("Code not found"),e.redirect(`${e.context.baseURL}/error?error=${i||"no_code"}&error_description=${n}`);let s=e.context.socialProviders.find(g=>g.id===e.params.id);if(!s)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),e.redirect(`${e.context.baseURL}/error?error=oauth_provider_not_found`);let{codeVerifier:a,callbackURL:d,link:A,errorURL:c,newUserURL:p}=await so(e),l;try{l=await s.validateAuthorizationCode({code:t,codeVerifier:a,redirectURI:`${e.context.baseURL}/callback/${s.id}`})}catch(g){throw e.context.logger.error("",g),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`)}let K=await s.getUserInfo(l).then(g=>g?.user);function y(g){let w=c||d||`${e.context.baseURL}/error`;throw w.includes("?")?w=`${w}&error=${g}`:w=`${w}?error=${g}`,e.redirect(w)}if(!K)return e.context.logger.error("Unable to get user info"),y("unable_to_get_user_info");if(!K.email&&s.id!=="roblox")return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),y("email_not_found");if(!d)throw e.context.logger.error("No callback URL found"),e.redirect(`${e.context.baseURL}/error?error=please_restart_the_process`);if(A){if(A.email!==K?.email?.toLowerCase()&&s.id!=="roblox")return y("email_doesn't_match");if(!await e.context.internalAdapter.createAccount({userId:A.userId,providerId:s.id,accountId:K.id,name:K.name||K.email||"",accessToken:l.accessToken,refreshToken:l.refreshToken,accessTokenExpiresAt:l.accessTokenExpiresAt,scope:l.scopes?.join(","),image:K.image}))return y("unable_to_link_account");let w;try{w=d.toString()}catch{w=d}throw e.redirect(w)}let h=await Ne(e,{userInfo:{...K,email:K.email||"",name:K.name||K.email||""},account:{providerId:s.id,accountId:K.id,...l,image:K.image,scope:l.scopes?.join(",")},callbackURL:d});if(h.error)return e.context.logger.error(h.error.split(" ").join("_")),y(h.error.split(" ").join("_"));let{session:x,user:j}=h.data;await b(e,{session:x,user:j});let z;try{z=(h.isRegister&&p||d).toString()}catch{z=h.isRegister&&p||d}throw e.redirect(z)});import"zod";import{APIError as Yr}from"better-call";var xi=u("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let o=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!o)throw G(e),new Yr("BAD_REQUEST",{message:f.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(o),G(e),e.json({success:!0})});import{z as ne}from"zod";import{APIError as Ze}from"better-call";function Gi(e,o,t){let i=o?new URL(o,e.baseURL):new URL(`${e.baseURL}/error`);return t&&Object.entries(t).forEach(([r,n])=>i.searchParams.set(r,n)),i.href}function en(e,o,t){let i=new URL(o,e.baseURL);return t&&Object.entries(t).forEach(([r,n])=>i.searchParams.set(r,n)),i.href}var ji=u("/forget-password",{method:"POST",body:ne.object({email:ne.string({description:"The email address of the user to send a password reset email to"}).email(),redirectTo:ne.string({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPasswordToken function in your auth config!"),new Ze("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:o,redirectTo:t}=e.body,i=await e.context.internalAdapter.findUserByEmail(o,{includeAccounts:!0});if(!i)return e.context.logger.error("Reset Password: User not found",{email:o}),e.json({status:!1},{body:{status:!0}});let r=60*60*1,n=L(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||r,"sec"),s=ee(24);await e.context.internalAdapter.createVerificationValue({value:i.user.id.toString(),identifier:`reset-password:${s}`,expiresAt:n});let a=`${e.context.baseURL}/reset-password/${s}?callbackURL=${t}`;return await e.context.options.emailAndPassword.sendResetPassword({user:i.user,url:a,token:s},e.request),e.json({status:!0})}),zi=u("/reset-password/:token",{method:"GET",query:ne.object({callbackURL:ne.string({description:"The URL to redirect the user to reset their password"})}),metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{let{token:o}=e.params,{callbackURL:t}=e.query;if(!o||!t)throw e.redirect(Gi(e.context,t,{error:"INVALID_TOKEN"}));let i=await e.context.internalAdapter.findVerificationValue(`reset-password:${o}`);throw!i||i.expiresAt<new Date?e.redirect(Gi(e.context,t,{error:"INVALID_TOKEN"})):e.redirect(en(e.context,t,{token:o}))}),Bi=u("/reset-password",{query:ne.optional(ne.object({token:ne.string().optional(),currentURL:ne.string().optional()})),method:"POST",body:ne.object({newPassword:ne.string({description:"The new password to set"}),token:ne.string({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let o=e.body.token||e.query?.token||(e.query?.currentURL?new URL(e.query.currentURL).searchParams.get("token"):"");if(!o)throw new Ze("BAD_REQUEST",{message:f.INVALID_TOKEN});let{newPassword:t}=e.body,i=e.context.password?.config.minPasswordLength,r=e.context.password?.config.maxPasswordLength;if(t.length<i)throw new Ze("BAD_REQUEST",{message:f.PASSWORD_TOO_SHORT});if(t.length>r)throw new Ze("BAD_REQUEST",{message:f.PASSWORD_TOO_LONG});let n=`reset-password:${o}`,s=await e.context.internalAdapter.findVerificationValue(n);if(!s||s.expiresAt<new Date)throw new Ze("BAD_REQUEST",{message:f.INVALID_TOKEN});await e.context.internalAdapter.deleteVerificationValue(s.id);let a=s.value,d=await e.context.password.hash(t);return(await e.context.internalAdapter.findAccounts(a)).find(p=>p.providerId==="credential")?(await e.context.internalAdapter.updatePassword(a,d),e.json({status:!0})):(await e.context.internalAdapter.createAccount({userId:a,providerId:"credential",password:d,accountId:a}),e.json({status:!0}))});import{z as F}from"zod";import{APIError as M}from"better-call";var Fi=()=>u("/update-user",{method:"POST",body:F.record(F.string(),F.any()),use:[I],metadata:{openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object"}}}}}}}}}},async e=>{let o=e.body;if(o.email)throw new M("BAD_REQUEST",{message:f.EMAIL_CAN_NOT_BE_UPDATED});let{name:t,image:i,...r}=o,n=e.context.session;if(i===void 0&&t===void 0&&Object.keys(r).length===0)return e.json({status:!0});let s=ao(e.context.options,r,"update"),a=await e.context.internalAdapter.updateUserByEmail(n.user.email,{name:t,image:i,...s});return await b(e,{session:n.session,user:a}),e.json({status:!0})}),Mi=u("/change-password",{method:"POST",body:F.object({newPassword:F.string({description:"The new password to set"}),currentPassword:F.string({description:"The current password"}),revokeOtherSessions:F.boolean({description:"Revoke all other sessions"}).optional()}),use:[I],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{description:"The user object",$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{let{newPassword:o,currentPassword:t,revokeOtherSessions:i}=e.body,r=e.context.session,n=e.context.password.config.minPasswordLength;if(o.length<n)throw e.context.logger.error("Password is too short"),new M("BAD_REQUEST",{message:f.PASSWORD_TOO_SHORT});let s=e.context.password.config.maxPasswordLength;if(o.length>s)throw e.context.logger.error("Password is too long"),new M("BAD_REQUEST",{message:f.PASSWORD_TOO_LONG});let d=(await e.context.internalAdapter.findAccounts(r.user.id)).find(l=>l.providerId==="credential"&&l.password);if(!d||!d.password)throw new M("BAD_REQUEST",{message:f.CREDENTIAL_ACCOUNT_NOT_FOUND});let A=await e.context.password.hash(o);if(!await e.context.password.verify({hash:d.password,password:t}))throw new M("BAD_REQUEST",{message:f.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(d.id,{password:A});let p=null;if(i){await e.context.internalAdapter.deleteSessions(r.user.id);let l=await e.context.internalAdapter.createSession(r.user.id,e.headers);if(!l)throw new M("INTERNAL_SERVER_ERROR",{message:f.FAILED_TO_GET_SESSION});await b(e,{session:l,user:r.user}),p=l.token}return e.json({token:p})}),Vi=u("/set-password",{method:"POST",body:F.object({newPassword:F.string()}),metadata:{SERVER_ONLY:!0},use:[I]},async e=>{let{newPassword:o}=e.body,t=e.context.session,i=e.context.password.config.minPasswordLength;if(o.length<i)throw e.context.logger.error("Password is too short"),new M("BAD_REQUEST",{message:f.PASSWORD_TOO_SHORT});let r=e.context.password.config.maxPasswordLength;if(o.length>r)throw e.context.logger.error("Password is too long"),new M("BAD_REQUEST",{message:f.PASSWORD_TOO_LONG});let s=(await e.context.internalAdapter.findAccounts(t.user.id)).find(d=>d.providerId==="credential"&&d.password),a=await e.context.password.hash(o);if(!s)return await e.context.internalAdapter.linkAccount({userId:t.user.id,providerId:"credential",accountId:t.user.id,password:a}),e.json({status:!0});throw new M("BAD_REQUEST",{message:"user already has a password"})}),qi=u("/delete-user",{method:"POST",use:[I],body:F.object({callbackURL:F.string().optional(),password:F.string().optional(),token:F.string().optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object"}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options",{session:e.context.session}),new M("NOT_FOUND");let o=e.context.session;if(e.body.password){let n=(await e.context.internalAdapter.findAccounts(o.user.id)).find(a=>a.providerId==="credential"&&a.password);if(!n||!n.password)throw new M("BAD_REQUEST",{message:f.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:n.password,password:e.body.password}))throw new M("BAD_REQUEST",{message:f.INVALID_PASSWORD})}else if(e.context.options.session?.freshAge){let r=o.session.createdAt.getTime(),n=e.context.options.session.freshAge;if(Date.now()-r>n)throw new M("BAD_REQUEST",{message:f.SESSION_EXPIRED})}if(e.body.token)return await Po({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){let r=_(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:o.user.id,identifier:`delete-account-${r}`,expiresAt:new Date(Date.now()+1e3*60*60*24)});let n=`${e.context.baseURL}/delete-user/callback?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:o.user,url:n,token:r},e.request),e.json({success:!0,message:"Verification email sent"})}let t=e.context.options.user.deleteUser?.beforeDelete;t&&await t(o.user,e.request),await e.context.internalAdapter.deleteUser(o.user.id),await e.context.internalAdapter.deleteSessions(o.user.id),await e.context.internalAdapter.deleteAccounts(o.user.id),G(e);let i=e.context.options.user.deleteUser?.afterDelete;return i&&await i(o.user,e.request),e.json({success:!0,message:"User deleted"})}),Po=u("/delete-user/callback",{method:"GET",query:F.object({token:F.string(),callbackURL:F.string().optional()})},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new M("NOT_FOUND");let o=await v(e);if(!o)throw new M("NOT_FOUND",{message:f.FAILED_TO_GET_USER_INFO});let t=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!t||t.expiresAt<new Date)throw t&&await e.context.internalAdapter.deleteVerificationValue(t.id),new M("NOT_FOUND",{message:f.INVALID_TOKEN});if(t.value!==o.user.id)throw new M("NOT_FOUND",{message:f.INVALID_TOKEN});let i=e.context.options.user.deleteUser?.beforeDelete;i&&await i(o.user,e.request),await e.context.internalAdapter.deleteUser(o.user.id),await e.context.internalAdapter.deleteSessions(o.user.id),await e.context.internalAdapter.deleteAccounts(o.user.id),await e.context.internalAdapter.deleteVerificationValue(t.id),G(e);let r=e.context.options.user.deleteUser?.afterDelete;if(r&&await r(o.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})}),Hi=u("/change-email",{method:"POST",query:F.object({currentURL:F.string().optional()}).optional(),body:F.object({newEmail:F.string({description:"The new email to set"}).email(),callbackURL:F.string({description:"The URL to redirect to after email verification"}).optional()}),use:[I],metadata:{openapi:{responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object"},status:{type:"boolean"}}}}}}}}}},async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new M("BAD_REQUEST",{message:"Change email is disabled"});if(e.body.newEmail===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new M("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(e.body.newEmail))throw e.context.logger.error("Email already exists"),new M("BAD_REQUEST",{message:"Couldn't update your email"});if(e.context.session.user.emailVerified!==!0){let r=await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:e.body.newEmail});return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new M("BAD_REQUEST",{message:"Verification email isn't enabled"});let t=await Ke(e.context.secret,e.context.session.user.email,e.body.newEmail),i=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${e.body.callbackURL||e.query?.currentURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:e.body.newEmail,url:i,token:t},e.request),e.json({status:!0})});import{z as Ge}from"zod";import{APIError as Qi}from"better-call";var $i=u("/list-accounts",{method:"GET",use:[I],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"}}}}}}}}}}},async e=>{let o=e.context.session,t=await e.context.internalAdapter.findAccounts(o.user.id);return e.json(t.map(i=>({id:i.id,accountId:i.accountId,provider:i.providerId})))}),Zi=u("/link-social",{method:"POST",requireHeaders:!0,query:Ge.object({currentURL:Ge.string().optional()}).optional(),body:Ge.object({callbackURL:Ge.string({description:"The URL to redirect to after the user has signed in"}).optional(),provider:Ge.enum(Ro,{description:"The OAuth2 provider to use"})}),use:[I],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string"},redirect:{type:"boolean"}},required:["url","redirect"]}}}}}}}},async e=>{let o=e.context.session;if((await e.context.internalAdapter.findAccounts(o.user.id)).find(a=>a.providerId===e.body.provider))throw new Qi("BAD_REQUEST",{message:f.SOCIAL_ACCOUNT_ALREADY_LINKED});let r=e.context.socialProviders.find(a=>a.id===e.body.provider);if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new Qi("NOT_FOUND",{message:f.PROVIDER_NOT_FOUND});let n=await Se(e,{userId:o.user.id,email:o.user.email}),s=await r.createAuthorizationURL({state:n.state,codeVerifier:n.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`});return e.json({url:s.toString(),redirect:!0})});var Wi=(e,o)=>{let t={};for(let[i,r]of Object.entries(e))t[i]=n=>r({...n,context:{...o,...n.context}}),t[i].path=r.path,t[i].method=r.method,t[i].options=r.options,t[i].headers=r.headers;return t};function co(e){let o=e;return{newRole(t){return on(t)}}}function on(e){return{statements:e,authorize(o,t){for(let[i,r]of Object.entries(o)){let n=e[i];return n?(t==="OR"?r.some(a=>n.includes(a)):r.every(a=>n.includes(a)))?{success:!0}:{success:!1,error:`Unauthorized to access resource "${i}"`}:{success:!1,error:`You are not allowed to access resource: ${i}`}}return{success:!1,error:"Not authorized"}}}}var tn={organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]},Do=co(tn),rn=Do.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"]}),nn=Do.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"]}),sn=Do.newRole({organization:[],member:[],invitation:[]}),Ji={admin:rn,owner:nn,member:sn};var an={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},dn=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,Xi={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},An=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function cn(e){return e instanceof Date&&!isNaN(e.getTime())}function un(e){let o=An.exec(e);if(!o)return null;let[,t,i,r,n,s,a,d,A,c,p]=o,l=new Date(Date.UTC(parseInt(t,10),parseInt(i,10)-1,parseInt(r,10),parseInt(n,10),parseInt(s,10),parseInt(a,10),d?parseInt(d.padEnd(3,"0"),10):0));if(A){let K=(parseInt(c,10)*60+parseInt(p,10))*(A==="+"?-1:1);l.setUTCMinutes(l.getUTCMinutes()+K)}return cn(l)?l:null}function ln(e,o={}){let{strict:t=!1,warnings:i=!1,reviver:r,parseDates:n=!0}=o;if(typeof e!="string")return e;let s=e.trim();if(s[0]==='"'&&s.endsWith('"')&&!s.slice(1,-1).includes('"'))return s.slice(1,-1);let a=s.toLowerCase();if(a.length<=9&&a in Xi)return Xi[a];if(!dn.test(s)){if(t)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(an).some(([A,c])=>{let p=c.test(s);return p&&i&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${A} pattern`),p})&&t)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(s,(c,p)=>{if(c==="__proto__"||c==="constructor"&&p&&typeof p=="object"&&"prototype"in p){i&&console.warn(`[better-json] Dropping "${c}" key to prevent prototype pollution`);return}if(n&&typeof p=="string"){let l=un(p);if(l)return l}return r?r(c,p):p})}catch(A){if(t)throw A;return e}}function pn(e,o={strict:!0}){return ln(e,o)}var Yi=pn;var H=(e,o)=>{let t=e.adapter;return{findOrganizationBySlug:async i=>await t.findOne({model:"organization",where:[{field:"slug",value:i}]}),createOrganization:async i=>{let r=await t.create({model:"organization",data:{...i.organization,metadata:i.organization.metadata?JSON.stringify(i.organization.metadata):void 0}}),n=await t.create({model:"member",data:{organizationId:r.id,userId:i.user.id,createdAt:new Date,role:o?.creatorRole||"owner"}});return{...r,metadata:r.metadata?JSON.parse(r.metadata):void 0,members:[{...n,user:{id:i.user.id,name:i.user.name,email:i.user.email,image:i.user.image}}]}},findMemberByEmail:async i=>{let r=await t.findOne({model:"user",where:[{field:"email",value:i.email}]});if(!r)return null;let n=await t.findOne({model:"member",where:[{field:"organizationId",value:i.organizationId},{field:"userId",value:r.id}]});return n?{...n,user:{id:r.id,name:r.name,email:r.email,image:r.image}}:null},findMemberByOrgId:async i=>{let[r,n]=await Promise.all([await t.findOne({model:"member",where:[{field:"userId",value:i.userId},{field:"organizationId",value:i.organizationId}]}),await t.findOne({model:"user",where:[{field:"id",value:i.userId}]})]);return!n||!r?null:{...r,user:{id:n.id,name:n.name,email:n.email,image:n.image}}},findMemberById:async i=>{let r=await t.findOne({model:"member",where:[{field:"id",value:i}]});if(!r)return null;let n=await t.findOne({model:"user",where:[{field:"id",value:r.userId}]});return n?{...r,user:{id:n.id,name:n.name,email:n.email,image:n.image}}:null},createMember:async i=>await t.create({model:"member",data:i}),updateMember:async(i,r)=>await t.update({model:"member",where:[{field:"id",value:i}],update:{role:r}}),deleteMember:async i=>await t.delete({model:"member",where:[{field:"id",value:i}]}),updateOrganization:async(i,r)=>{let n=await t.update({model:"organization",where:[{field:"id",value:i}],update:{...r,metadata:typeof r.metadata=="object"?JSON.stringify(r.metadata):r.metadata}});return n?{...n,metadata:n.metadata?Yi(n.metadata):void 0}:null},deleteOrganization:async i=>(await t.delete({model:"member",where:[{field:"organizationId",value:i}]}),await t.delete({model:"invitation",where:[{field:"organizationId",value:i}]}),await t.delete({model:"organization",where:[{field:"id",value:i}]}),i),setActiveOrganization:async(i,r)=>await e.internalAdapter.updateSession(i,{activeOrganizationId:r}),findOrganizationById:async i=>await t.findOne({model:"organization",where:[{field:"id",value:i}]}),findFullOrganization:async({organizationId:i,isSlug:r})=>{let n=await t.findOne({model:"organization",where:[{field:r?"slug":"id",value:i}]});if(!n)return null;let[s,a]=await Promise.all([t.findMany({model:"invitation",where:[{field:"organizationId",value:n.id}]}),t.findMany({model:"member",where:[{field:"organizationId",value:n.id}]})]);if(!n)return null;let d=a.map(l=>l.userId),A=await t.findMany({model:"user",where:[{field:"id",value:d,operator:"in"}]}),c=new Map(A.map(l=>[l.id,l])),p=a.map(l=>{let K=c.get(l.userId);if(!K)throw new ae("Unexpected error: User not found for member");return{...l,user:{id:K.id,name:K.name,email:K.email,image:K.image}}});return{...n,invitations:s,members:p}},listOrganizations:async i=>{let r=await t.findMany({model:"member",where:[{field:"userId",value:i}]});if(!r||r.length===0)return[];let n=r.map(a=>a.organizationId);return await t.findMany({model:"organization",where:[{field:"id",value:n,operator:"in"}]})},createInvitation:async({invitation:i,user:r})=>{let s=L(o?.invitationExpiresIn||1728e5);return await t.create({model:"invitation",data:{email:i.email,role:i.role,organizationId:i.organizationId,status:"pending",expiresAt:s,inviterId:r.id}})},findInvitationById:async i=>await t.findOne({model:"invitation",where:[{field:"id",value:i}]}),findPendingInvitation:async i=>(await t.findMany({model:"invitation",where:[{field:"email",value:i.email},{field:"organizationId",value:i.organizationId},{field:"status",value:"pending"}]})).filter(n=>new Date(n.expiresAt)>new Date),updateInvitation:async i=>await t.update({model:"invitation",where:[{field:"id",value:i.invitationId}],update:{status:i.status}})}};import"better-call";var Q=N(async e=>({})),J=N({use:[I]},async e=>({session:e.context.session}));import{z as oe}from"zod";import{z as B}from"zod";var et=B.string(),Kn=B.enum(["pending","accepted","rejected","canceled"]).default("pending"),Qu=B.object({id:B.string().default(ee),name:B.string(),slug:B.string(),logo:B.string().nullish(),metadata:B.record(B.string()).or(B.string().transform(e=>JSON.parse(e))).nullish(),createdAt:B.date()}),Wu=B.object({id:B.string().default(ee),organizationId:B.string(),userId:B.string(),role:et,createdAt:B.date()}),Ju=B.object({id:B.string().default(ee),organizationId:B.string(),email:B.string(),role:et,status:Kn,inviterId:B.string(),expiresAt:B.date()});import{APIError as $}from"better-call";var O={YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION:"You are not allowed to create a new organization",YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS:"You have reached the maximum number of organizations",ORGANIZATION_ALREADY_EXISTS:"Organization already exists",ORGANIZATION_NOT_FOUND:"Organization not found",USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION:"User is not a member of the organization",YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION:"You are not allowed to update this organization",YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION:"You are not allowed to delete this organization",NO_ACTIVE_ORGANIZATION:"No active organization",USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION:"User is already a member of this organization",MEMBER_NOT_FOUND:"Member not found",ROLE_NOT_FOUND:"Role not found",YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER:"You cannot leave the organization as the only owner",YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER:"You are not allowed to delete this member",YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION:"You are not allowed to invite users to this organization",USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION:"User is already invited to this organization",INVITATION_NOT_FOUND:"Invitation not found",YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION:"You are not the recipient of the invitation",YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION:"You are not allowed to cancel this invitation",INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION:"Inviter is no longer a member of the organization"};var ot=e=>u("/organization/invite-member",{method:"POST",use:[Q,J],body:oe.object({email:oe.string({description:"The email address of the user to invite"}),role:oe.string({description:"The role to assign to the user"}),organizationId:oe.string({description:"The organization ID to invite the user to"}).optional(),resend:oe.boolean({description:"Resend the invitation email, if the user is already invited"}).optional()}),metadata:{openapi:{description:"Invite a user to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string"},email:{type:"string"},role:{type:"string"},organizationId:{type:"string"},inviterId:{type:"string"},status:{type:"string"},expiresAt:{type:"string"}},required:["id","email","role","organizationId","inviterId","status","expiresAt"]}}}}}}}},async o=>{if(!o.context.orgOptions.sendInvitationEmail)throw o.context.logger.warn("Invitation email is not enabled. Pass `sendInvitationEmail` to the plugin options to enable it."),new $("BAD_REQUEST",{message:"Invitation email is not enabled"});let t=o.context.session,i=o.body.organizationId||t.session.activeOrganizationId;if(!i)throw new $("BAD_REQUEST",{message:O.ORGANIZATION_NOT_FOUND});let r=H(o.context,o.context.orgOptions),n=await r.findMemberByOrgId({userId:t.user.id,organizationId:i});if(!n)throw new $("BAD_REQUEST",{message:O.MEMBER_NOT_FOUND});let s=o.context.roles[n.role];if(!s)throw new $("BAD_REQUEST",{message:O.ROLE_NOT_FOUND});if(s.authorize({invitation:["create"]}).error)throw new $("FORBIDDEN",{message:O.YOU_ARE_NOT_ALLOWED_TO_INVITE_USERS_TO_THIS_ORGANIZATION});if(await r.findMemberByEmail({email:o.body.email,organizationId:i}))throw new $("BAD_REQUEST",{message:O.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION});if((await r.findPendingInvitation({email:o.body.email,organizationId:i})).length&&!o.body.resend)throw new $("BAD_REQUEST",{message:O.USER_IS_ALREADY_INVITED_TO_THIS_ORGANIZATION});let c=await r.createInvitation({invitation:{role:o.body.role,email:o.body.email,organizationId:i},user:t.user}),p=await r.findOrganizationById(i);if(!p)throw new $("BAD_REQUEST",{message:O.ORGANIZATION_NOT_FOUND});return await o.context.orgOptions.sendInvitationEmail?.({id:c.id,role:c.role,email:c.email,organization:p,inviter:{...n,user:t.user}},o.request),o.json(c)}),it=u("/organization/accept-invitation",{method:"POST",body:oe.object({invitationId:oe.string({description:"The ID of the invitation to accept"})}),use:[Q,J],metadata:{openapi:{description:"Accept an invitation to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{invitation:{type:"object"},member:{type:"object"}}}}}}}}}},async e=>{let o=e.context.session,t=H(e.context,e.context.orgOptions),i=await t.findInvitationById(e.body.invitationId);if(!i||i.expiresAt<new Date||i.status!=="pending")throw new $("BAD_REQUEST",{message:O.INVITATION_NOT_FOUND});if(i.email!==o.user.email)throw new $("FORBIDDEN",{message:O.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION});let r=await t.updateInvitation({invitationId:e.body.invitationId,status:"accepted"}),n=await t.createMember({organizationId:i.organizationId,userId:o.user.id,role:i.role,createdAt:new Date});return await t.setActiveOrganization(o.session.token,i.organizationId),r?e.json({invitation:r,member:n}):e.json(null,{status:400,body:{message:O.INVITATION_NOT_FOUND}})}),tt=u("/organization/reject-invitation",{method:"POST",body:oe.object({invitationId:oe.string({description:"The ID of the invitation to reject"})}),use:[Q,J],metadata:{openapi:{description:"Reject an invitation to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{invitation:{type:"object"},member:{type:"null"}}}}}}}}}},async e=>{let o=e.context.session,t=H(e.context,e.context.orgOptions),i=await t.findInvitationById(e.body.invitationId);if(!i||i.expiresAt<new Date||i.status!=="pending")throw new $("BAD_REQUEST",{message:"Invitation not found!"});if(i.email!==o.user.email)throw new $("FORBIDDEN",{message:O.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION});let r=await t.updateInvitation({invitationId:e.body.invitationId,status:"rejected"});return e.json({invitation:r,member:null})}),rt=u("/organization/cancel-invitation",{method:"POST",body:oe.object({invitationId:oe.string({description:"The ID of the invitation to cancel"})}),use:[Q,J],openapi:{description:"Cancel an invitation to an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{invitation:{type:"object"}}}}}}}}},async e=>{let o=e.context.session,t=H(e.context,e.context.orgOptions),i=await t.findInvitationById(e.body.invitationId);if(!i)throw new $("BAD_REQUEST",{message:O.INVITATION_NOT_FOUND});let r=await t.findMemberByOrgId({userId:o.user.id,organizationId:i.organizationId});if(!r)throw new $("BAD_REQUEST",{message:O.MEMBER_NOT_FOUND});if(e.context.roles[r.role].authorize({invitation:["cancel"]}).error)throw new $("FORBIDDEN",{message:O.YOU_ARE_NOT_ALLOWED_TO_CANCEL_THIS_INVITATION});let s=await t.updateInvitation({invitationId:e.body.invitationId,status:"canceled"});return e.json(s)}),nt=u("/organization/get-invitation",{method:"GET",use:[Q],requireHeaders:!0,query:oe.object({id:oe.string({description:"The ID of the invitation to get"})}),metadata:{openapi:{description:"Get an invitation by ID",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string"},email:{type:"string"},role:{type:"string"},organizationId:{type:"string"},inviterId:{type:"string"},status:{type:"string"},expiresAt:{type:"string"},organizationName:{type:"string"},organizationSlug:{type:"string"},inviterEmail:{type:"string"}},required:["id","email","role","organizationId","inviterId","status","expiresAt","organizationName","organizationSlug","inviterEmail"]}}}}}}}},async e=>{let o=await v(e);if(!o)throw new $("UNAUTHORIZED",{message:"Not authenticated"});let t=H(e.context,e.context.orgOptions),i=await t.findInvitationById(e.query.id);if(!i||i.status!=="pending"||i.expiresAt<new Date)throw new $("BAD_REQUEST",{message:"Invitation not found!"});if(i.email!==o.user.email)throw new $("FORBIDDEN",{message:O.YOU_ARE_NOT_THE_RECIPIENT_OF_THE_INVITATION});let r=await t.findOrganizationById(i.organizationId);if(!r)throw new $("BAD_REQUEST",{message:O.ORGANIZATION_NOT_FOUND});let n=await t.findMemberByOrgId({userId:i.inviterId,organizationId:i.organizationId});if(!n)throw new $("BAD_REQUEST",{message:O.INVITER_IS_NO_LONGER_A_MEMBER_OF_THE_ORGANIZATION});return e.json({...i,organizationName:r.name,organizationSlug:r.slug,inviterEmail:n.user.email})});import{z as Ae}from"zod";import{APIError as _e}from"better-call";var st=()=>u("/organization/add-member",{method:"POST",body:Ae.object({userId:Ae.string(),role:Ae.string(),organizationId:Ae.string().optional()}),use:[Q],metadata:{SERVER_ONLY:!0}},async e=>{let o=e.body.userId?await v(e).catch(a=>null):null,t=e.body.organizationId||o?.session.activeOrganizationId;if(!t)return e.json(null,{status:400,body:{message:O.NO_ACTIVE_ORGANIZATION}});let i=H(e.context,e.context.orgOptions),r=await e.context.internalAdapter.findUserById(e.body.userId);if(!r)throw new _e("BAD_REQUEST",{message:f.USER_NOT_FOUND});if(await i.findMemberByEmail({email:r.email,organizationId:t}))throw new _e("BAD_REQUEST",{message:O.USER_IS_ALREADY_A_MEMBER_OF_THIS_ORGANIZATION});let s=await i.createMember({id:ee(),organizationId:t,userId:r.id,role:e.body.role,createdAt:new Date});return e.json(s)}),at=u("/organization/remove-member",{method:"POST",body:Ae.object({memberIdOrEmail:Ae.string({description:"The ID or email of the member to remove"}),organizationId:Ae.string({description:"The ID of the organization to remove the member from. If not provided, the active organization will be used"}).optional()}),use:[Q,J],metadata:{openapi:{description:"Remove a member from an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{member:{type:"object",properties:{id:{type:"string"},userId:{type:"string"},organizationId:{type:"string"},role:{type:"string"}},required:["id","userId","organizationId","role"]}},required:["member"]}}}}}}}},async e=>{let o=e.context.session,t=e.body.organizationId||o.session.activeOrganizationId;if(!t)return e.json(null,{status:400,body:{message:O.NO_ACTIVE_ORGANIZATION}});let i=H(e.context,e.context.orgOptions),r=await i.findMemberByOrgId({userId:o.user.id,organizationId:t});if(!r)throw new _e("BAD_REQUEST",{message:O.MEMBER_NOT_FOUND});let n=e.context.roles[r.role];if(!n)throw new _e("BAD_REQUEST",{message:O.ROLE_NOT_FOUND});let s=o.user.email===e.body.memberIdOrEmail||r.id===e.body.memberIdOrEmail;if(s&&r.role===(e.context.orgOptions?.creatorRole||"owner"))throw new _e("BAD_REQUEST",{message:O.YOU_CANNOT_LEAVE_THE_ORGANIZATION_AS_THE_ONLY_OWNER});if(!(s||n.authorize({member:["delete"]}).success))throw new _e("UNAUTHORIZED",{message:O.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_MEMBER});let A=null;if(e.body.memberIdOrEmail.includes("@")?A=await i.findMemberByEmail({email:e.body.memberIdOrEmail,organizationId:t}):A=await i.findMemberById(e.body.memberIdOrEmail),A?.organizationId!==t)throw new _e("BAD_REQUEST",{message:O.MEMBER_NOT_FOUND});return await i.deleteMember(A.id),o.user.id===A.userId&&o.session.activeOrganizationId===A.organizationId&&await i.setActiveOrganization(o.session.token,null),e.json({member:A})}),dt=e=>u("/organization/update-member-role",{method:"POST",body:Ae.object({role:Ae.string(),memberId:Ae.string(),organizationId:Ae.string().optional()}),use:[Q,J],metadata:{openapi:{description:"Update the role of a member in an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{member:{type:"object",properties:{id:{type:"string"},userId:{type:"string"},organizationId:{type:"string"},role:{type:"string"}},required:["id","userId","organizationId","role"]}},required:["member"]}}}}}}}},async o=>{let t=o.context.session,i=o.body.organizationId||t.session.activeOrganizationId;if(!i)return o.json(null,{status:400,body:{message:O.NO_ACTIVE_ORGANIZATION}});let r=H(o.context,o.context.orgOptions),n=await r.findMemberByOrgId({userId:t.user.id,organizationId:i});if(!n)return o.json(null,{status:400,body:{message:O.MEMBER_NOT_FOUND}});let s=o.context.roles[n.role];if(!s)return o.json(null,{status:400,body:{message:O.ROLE_NOT_FOUND}});if(s.authorize({member:["update"]}).error||o.body.role==="owner"&&n.role!=="owner")return o.json(null,{body:{message:"You are not allowed to update this member"},status:403});let d=await r.updateMember(o.body.memberId,o.body.role);return d?o.json(d):o.json(null,{status:400,body:{message:O.MEMBER_NOT_FOUND}})}),At=u("/organization/get-active-member",{method:"GET",use:[Q,J],metadata:{openapi:{description:"Get the active member in the organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{id:{type:"string"},userId:{type:"string"},organizationId:{type:"string"},role:{type:"string"}},required:["id","userId","organizationId","role"]}}}}}}}},async e=>{let o=e.context.session,t=o.session.activeOrganizationId;if(!t)return e.json(null,{status:400,body:{message:O.NO_ACTIVE_ORGANIZATION}});let r=await H(e.context,e.context.orgOptions).findMemberByOrgId({userId:o.user.id,organizationId:t});return r?e.json(r):e.json(null,{status:400,body:{message:O.MEMBER_NOT_FOUND}})});import{z as k}from"zod";import{APIError as ge}from"better-call";var ct=u("/organization/create",{method:"POST",body:k.object({name:k.string({description:"The name of the organization"}),slug:k.string({description:"The slug of the organization"}),userId:k.string({description:"The user id of the organization creator. If not provided, the current user will be used. Should only be used by admins or when called by the server."}).optional(),logo:k.string({description:"The logo of the organization"}).optional(),metadata:k.record(k.string(),k.any(),{description:"The metadata of the organization"}).optional()}),use:[Q],metadata:{openapi:{description:"Create an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The organization that was created",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let o=await v(e);if(!o&&(e.request||e.headers))throw new ge("UNAUTHORIZED");let t=o?.user||null;if(!t){if(!e.body.userId)throw new ge("UNAUTHORIZED");t=await e.context.internalAdapter.findUserById(e.body.userId)}if(!t)return e.json(null,{status:401});let i=e.context.orgOptions;if(!(typeof i?.allowUserToCreateOrganization=="function"?await i.allowUserToCreateOrganization(t):i?.allowUserToCreateOrganization===void 0?!0:i.allowUserToCreateOrganization))throw new ge("FORBIDDEN",{message:O.YOU_ARE_NOT_ALLOWED_TO_CREATE_A_NEW_ORGANIZATION});let n=H(e.context,i),s=await n.listOrganizations(t.id);if(typeof i.organizationLimit=="number"?s.length>=i.organizationLimit:typeof i.organizationLimit=="function"?await i.organizationLimit(t):!1)throw new ge("FORBIDDEN",{message:O.YOU_HAVE_REACHED_THE_MAXIMUM_NUMBER_OF_ORGANIZATIONS});if(await n.findOrganizationBySlug(e.body.slug))throw new ge("BAD_REQUEST",{message:O.ORGANIZATION_ALREADY_EXISTS});let A=await n.createOrganization({organization:{id:ee(),slug:e.body.slug,name:e.body.name,logo:e.body.logo,createdAt:new Date,metadata:e.body.metadata},user:t});return e.context.session&&await n.setActiveOrganization(e.context.session.session.token,A.id),e.json(A)}),ut=u("/organization/update",{method:"POST",body:k.object({data:k.object({name:k.string({description:"The name of the organization"}).optional(),slug:k.string({description:"The slug of the organization"}).optional(),logo:k.string({description:"The logo of the organization"}).optional(),metadata:k.record(k.string(),k.any(),{description:"The metadata of the organization"}).optional()}).partial(),organizationId:k.string().optional()}),requireHeaders:!0,use:[Q],metadata:{openapi:{description:"Update an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The updated organization",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let o=await e.context.getSession(e);if(!o)throw new ge("UNAUTHORIZED",{message:"User not found"});let t=e.body.organizationId||o.session.activeOrganizationId;if(!t)return e.json(null,{status:400,body:{message:O.ORGANIZATION_NOT_FOUND}});let i=H(e.context,e.context.orgOptions),r=await i.findMemberByOrgId({userId:o.user.id,organizationId:t});if(!r)return e.json(null,{status:400,body:{message:O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION}});let n=e.context.roles[r.role];if(!n)return e.json(null,{status:400,body:{message:"Role not found!"}});if(n.authorize({organization:["update"]}).error)return e.json(null,{body:{message:O.YOU_ARE_NOT_ALLOWED_TO_UPDATE_THIS_ORGANIZATION},status:403});let a=await i.updateOrganization(t,e.body.data);return e.json(a)}),lt=u("/organization/delete",{method:"POST",body:k.object({organizationId:k.string({description:"The organization id to delete"})}),requireHeaders:!0,use:[Q],metadata:{openapi:{description:"Delete an organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"string",description:"The organization id that was deleted"}}}}}}}},async e=>{let o=await e.context.getSession(e);if(!o)return e.json(null,{status:401});let t=e.body.organizationId;if(!t)return e.json(null,{status:400,body:{message:O.ORGANIZATION_NOT_FOUND}});let i=H(e.context,e.context.orgOptions),r=await i.findMemberByOrgId({userId:o.user.id,organizationId:t});if(!r)return e.json(null,{status:400,body:{message:O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION}});let n=e.context.roles[r.role];if(!n)return e.json(null,{status:400,body:{message:"Role not found!"}});if(n.authorize({organization:["delete"]}).error)throw new ge("FORBIDDEN",{message:O.YOU_ARE_NOT_ALLOWED_TO_DELETE_THIS_ORGANIZATION});return t===o.session.activeOrganizationId&&await i.setActiveOrganization(o.session.token,null),await i.deleteOrganization(t),e.json(t)}),pt=u("/organization/get-full-organization",{method:"GET",query:k.optional(k.object({organizationId:k.string({description:"The organization id to get"}).optional(),organizationSlug:k.string({description:"The organization slug to get"}).optional()})),requireHeaders:!0,use:[Q,J],metadata:{openapi:{description:"Get the full organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The organization",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let o=e.context.session,t=e.query?.organizationSlug||e.query?.organizationId||o.session.activeOrganizationId;if(!t)return e.json(null,{status:200});let r=await H(e.context,e.context.orgOptions).findFullOrganization({organizationId:t,isSlug:!!e.query?.organizationSlug});if(!r)throw new ge("BAD_REQUEST",{message:O.ORGANIZATION_NOT_FOUND});return e.json(r)}),Kt=u("/organization/set-active",{method:"POST",body:k.object({organizationId:k.string({description:"The organization id to set as active. It can be null to unset the active organization"}).nullable().optional(),organizationSlug:k.string({description:"The organization slug to set as active. It can be null to unset the active organization if organizationId is not provided"}).optional()}),use:[J,Q],metadata:{openapi:{description:"Set the active organization",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",description:"The organization",$ref:"#/components/schemas/Organization"}}}}}}}},async e=>{let o=H(e.context,e.context.orgOptions),t=e.context.session,i=e.body.organizationSlug||e.body.organizationId;if(i===null){if(!t.session.activeOrganizationId)return e.json(null);let d=await o.setActiveOrganization(t.session.token,null);return await b(e,{session:d,user:t.user}),e.json(null)}if(!i){let a=t.session.activeOrganizationId;if(!a)return e.json(null);i=a}let r=await o.findFullOrganization({organizationId:i,isSlug:!!e.body.organizationSlug});if(!r?.members.find(a=>a.userId===t.user.id))throw await o.setActiveOrganization(t.session.token,null),new ge("FORBIDDEN",{message:O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION});if(!r)throw new ge("BAD_REQUEST",{message:O.ORGANIZATION_NOT_FOUND});let s=await o.setActiveOrganization(t.session.token,r.id);return await b(e,{session:s,user:t.user}),e.json(r)}),mt=u("/organization/list",{method:"GET",use:[Q,J],metadata:{openapi:{description:"List all organizations",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Organization"}}}}}}}}},async e=>{let t=await H(e.context,e.context.orgOptions).listOrganizations(e.context.session.user.id);return e.json(t)});var mn=co({name:["action"]}),Ml=mn.newRole({name:["action"]}),Vl=e=>{let o={createOrganization:ct,updateOrganization:ut,deleteOrganization:lt,setActiveOrganization:Kt,getFullOrganization:pt,listOrganizations:mt,createInvitation:ot(e),cancelInvitation:rt,acceptInvitation:it,getInvitation:nt,rejectInvitation:tt,addMember:st(),removeMember:at,updateMemberRole:dt(e),getActiveMember:At},t={...Ji,...e?.roles};return{id:"organization",endpoints:{...Wi(o,{orgOptions:e||{},roles:t,getSession:async r=>await v(r)}),hasPermission:u("/organization/has-permission",{method:"POST",requireHeaders:!0,body:Le.object({organizationId:Le.string().optional(),permission:Le.record(Le.string(),Le.array(Le.string()))}),use:[J],metadata:{openapi:{description:"Check if the user has permission",requestBody:{content:{"application/json":{schema:{type:"object",properties:{permission:{type:"object",description:"The permission to check"}},required:["permission"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{error:{type:"string"},success:{type:"boolean"}},required:["success"]}}}}}}}},async r=>{let n=r.body.organizationId||r.context.session.session.activeOrganizationId;if(!n)throw new gt("BAD_REQUEST",{message:O.NO_ACTIVE_ORGANIZATION});let a=await H(r.context).findMemberByOrgId({userId:r.context.session.user.id,organizationId:n});if(!a)throw new gt("UNAUTHORIZED",{message:O.USER_IS_NOT_A_MEMBER_OF_THE_ORGANIZATION});let A=t[a.role].authorize(r.body.permission);return A.error?r.json({error:A.error,success:!1},{status:403}):r.json({error:null,success:!0})})},schema:{session:{fields:{activeOrganizationId:{type:"string",required:!1,fieldName:e?.schema?.session?.fields?.activeOrganizationId}}},organization:{modelName:e?.schema?.organization?.modelName,fields:{name:{type:"string",required:!0,fieldName:e?.schema?.organization?.fields?.name},slug:{type:"string",unique:!0,fieldName:e?.schema?.organization?.fields?.slug},logo:{type:"string",required:!1,fieldName:e?.schema?.organization?.fields?.logo},createdAt:{type:"date",required:!0,fieldName:e?.schema?.organization?.fields?.createdAt},metadata:{type:"string",required:!1,fieldName:e?.schema?.organization?.fields?.metadata}}},member:{modelName:e?.schema?.member?.modelName,fields:{organizationId:{type:"string",required:!0,references:{model:"organization",field:"id"},fieldName:e?.schema?.member?.fields?.organizationId},userId:{type:"string",required:!0,fieldName:e?.schema?.member?.fields?.userId,references:{model:"user",field:"id"}},role:{type:"string",required:!0,defaultValue:"member",fieldName:e?.schema?.member?.fields?.role},createdAt:{type:"date",required:!0,fieldName:e?.schema?.member?.fields?.createdAt}}},invitation:{modelName:e?.schema?.invitation?.modelName,fields:{organizationId:{type:"string",required:!0,references:{model:"organization",field:"id"},fieldName:e?.schema?.invitation?.fields?.organizationId},email:{type:"string",required:!0,fieldName:e?.schema?.invitation?.fields?.email},role:{type:"string",required:!1,fieldName:e?.schema?.invitation?.fields?.role},status:{type:"string",required:!0,defaultValue:"pending",fieldName:e?.schema?.invitation?.fields?.status},expiresAt:{type:"date",required:!0,fieldName:e?.schema?.invitation?.fields?.expiresAt},inviterId:{type:"string",references:{model:"user",field:"id"},fieldName:e?.schema?.invitation?.fields?.inviterId,required:!0}}}},$Infer:{Organization:{},Invitation:{},Member:{},ActiveOrganization:{}},$ERROR_CODES:O}};import{z as Ko}from"zod";import{z as be}from"zod";import{APIError as Qe}from"better-call";var uo="two_factor";var lo="trust_device";import{z as ft}from"zod";import{createHMAC as gn}from"@better-auth/utils/hmac";import"@better-auth/utils/base64";var ve=N({body:ft.object({trustDevice:ft.boolean().optional()})},async e=>{let o=await v(e);if(!o){let t=e.context.createAuthCookie(uo),i=await e.getSignedCookie(t.name,e.context.secret);if(!i)throw new Qe("UNAUTHORIZED",{message:"invalid two factor cookie"});let r=await e.context.internalAdapter.findUserById(i);if(!r)throw new Qe("UNAUTHORIZED",{message:"invalid two factor cookie"});let n=await e.context.internalAdapter.createSession(i,e.request);if(!n)throw new Qe("INTERNAL_SERVER_ERROR",{message:"failed to create session"});return{valid:async()=>{if(await b(e,{session:n,user:r}),e.body.trustDevice){let s=e.context.createAuthCookie(lo,{maxAge:2592e3}),a=await gn("SHA-256","base64urlnopad").sign(e.context.secret,`${r.id}!${n.token}`);await e.setSignedCookie(s.name,`${a}!${n.token}`,e.context.secret,s.attributes)}return e.json({token:n.token})},invalid:async()=>{throw new Qe("UNAUTHORIZED",{message:"invalid two factor authentication"})},session:{session:n,user:r}}}return{valid:async()=>e.json({token:o.session.token}),invalid:async()=>{throw new Qe("UNAUTHORIZED",{message:"invalid two factor authentication"})},session:o}});import{APIError as We}from"better-call";var X={OTP_NOT_ENABLED:"OTP not enabled",OTP_HAS_EXPIRED:"OTP has expired",TOTP_NOT_ENABLED:"TOTP not enabled",TWO_FACTOR_NOT_ENABLED:"Two factor isn't enabled",BACKUP_CODES_NOT_ENABLED:"Backup codes aren't enabled",INVALID_BACKUP_CODE:"Invalid backup code"};function fn(e){return Array.from({length:e?.amount??10}).fill(null).map(()=>_(e?.length??10,"a-z","0-9","A-Z")).map(o=>`${o.slice(0,5)}-${o.slice(5)}`)}async function No(e,o){let t=e,i=o?.customBackupCodesGenerate?o.customBackupCodesGenerate():fn(),r=await le({data:JSON.stringify(i),key:t});return{backupCodes:i,encryptedBackupCodes:r}}async function hn(e,o){let t=await ht(e.backupCodes,o);return t?{status:t.includes(e.code),updated:t.filter(i=>i!==e.code)}:{status:!1,updated:null}}async function ht(e,o){let t=Buffer.from(await he({key:o,data:e})).toString("utf-8"),i=JSON.parse(t),r=be.array(be.string()).safeParse(i);return r.success?r.data:null}var yt=e=>{let o="twoFactor";return{id:"backup_code",endpoints:{verifyBackupCode:u("/two-factor/verify-backup-code",{method:"POST",body:be.object({code:be.string(),disableSession:be.boolean().optional()}),use:[ve]},async t=>{let i=t.context.session.user,r=await t.context.adapter.findOne({model:o,where:[{field:"userId",value:i.id}]});if(!r)throw new We("BAD_REQUEST",{message:X.BACKUP_CODES_NOT_ENABLED});let n=await hn({backupCodes:r.backupCodes,code:t.body.code},t.context.secret);if(!n.status)throw new We("UNAUTHORIZED",{message:X.INVALID_BACKUP_CODE});let s=await le({key:t.context.secret,data:JSON.stringify(n.updated)});return await t.context.adapter.updateMany({model:o,update:{backupCodes:s},where:[{field:"userId",value:i.id}]}),t.body.disableSession||await b(t,{session:t.context.session.session,user:i}),t.json({user:i,session:t.context.session})}),generateBackupCodes:u("/two-factor/generate-backup-codes",{method:"POST",body:be.object({password:be.string()}),use:[I]},async t=>{let i=t.context.session.user;if(!i.twoFactorEnabled)throw new We("BAD_REQUEST",{message:X.TWO_FACTOR_NOT_ENABLED});await t.context.password.checkPassword(i.id,t);let r=await No(t.context.secret,e);return await t.context.adapter.update({model:o,update:{backupCodes:r.encryptedBackupCodes},where:[{field:"userId",value:t.context.session.user.id}]}),t.json({status:!0,backupCodes:r.backupCodes})}),viewBackupCodes:u("/two-factor/view-backup-codes",{method:"GET",body:be.object({userId:be.string()}),metadata:{SERVER_ONLY:!0}},async t=>{let i=await t.context.adapter.findOne({model:o,where:[{field:"userId",value:t.body.userId}]});if(!i)throw new We("BAD_REQUEST",{message:"Backup codes aren't enabled"});let r=await ht(i.backupCodes,t.context.secret);if(!r)throw new We("BAD_REQUEST",{message:X.BACKUP_CODES_NOT_ENABLED});return t.json({status:!0,backupCodes:r})})}}};import{APIError as Je}from"better-call";import{z as wt}from"zod";var Ct=e=>{let o={...e,digits:e?.digits||6,period:(e?.period||3)*60*1e3},t="twoFactor",i=u("/two-factor/send-otp",{method:"POST",use:[ve],metadata:{openapi:{summary:"Send two factor OTP",description:"Send two factor OTP to the user",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async n=>{if(!e||!e.sendOTP)throw n.context.logger.error("send otp isn't configured. Please configure the send otp function on otp options."),new Je("BAD_REQUEST",{message:"otp isn't configured"});let s=n.context.session.user;if(!await n.context.adapter.findOne({model:t,where:[{field:"userId",value:s.id}]}))throw new Je("BAD_REQUEST",{message:X.OTP_NOT_ENABLED});let d=_(o.digits,"0-9");return await n.context.internalAdapter.createVerificationValue({value:d,identifier:`2fa-otp-${s.id}`,expiresAt:new Date(Date.now()+o.period)}),await e.sendOTP({user:s,otp:d},n.request),n.json({status:!0})}),r=u("/two-factor/verify-otp",{method:"POST",body:wt.object({code:wt.string({description:"The otp code to verify"})}),use:[ve],metadata:{openapi:{summary:"Verify two factor OTP",description:"Verify two factor OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async n=>{let s=n.context.session.user;if(!s.twoFactorEnabled)throw new Je("BAD_REQUEST",{message:"two factor isn't enabled"});if(!await n.context.adapter.findOne({model:t,where:[{field:"userId",value:s.id}]}))throw new Je("BAD_REQUEST",{message:X.OTP_NOT_ENABLED});let d=await n.context.internalAdapter.findVerificationValue(`2fa-otp-${s.id}`);if(!d||d.expiresAt<new Date)throw new Je("BAD_REQUEST",{message:X.OTP_HAS_EXPIRED});return d.value===n.body.code?n.context.valid():n.context.invalid()});return{id:"otp",endpoints:{sendTwoFactorOTP:i,verifyTwoFactorOTP:r}}};import{APIError as xe}from"better-call";import{z as po}from"zod";import{createOTP as Lo}from"@better-auth/utils/otp";var bt=e=>{let o={...e,digits:e?.digits||6,period:e?.period||30},t="twoFactor",i=u("/totp/generate",{method:"POST",use:[I],metadata:{openapi:{summary:"Generate TOTP code",description:"Use this endpoint to generate a TOTP code",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{code:{type:"string"}}}}}}}}}},async s=>{if(e?.disable)throw s.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"),new xe("BAD_REQUEST",{message:"totp isn't configured"});let a=s.context.session.user,d=await s.context.adapter.findOne({model:t,where:[{field:"userId",value:a.id}]});if(!d)throw new xe("BAD_REQUEST",{message:X.TOTP_NOT_ENABLED});return{code:await Lo(d.secret,{period:o.period,digits:o.digits}).totp()}}),r=u("/two-factor/get-totp-uri",{method:"POST",use:[I],body:po.object({password:po.string({description:"User password"})}),metadata:{openapi:{summary:"Get TOTP URI",description:"Use this endpoint to get the TOTP URI",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{totpURI:{type:"string"}}}}}}}}}},async s=>{if(e?.disable)throw s.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"),new xe("BAD_REQUEST",{message:"totp isn't configured"});let a=s.context.session.user,d=await s.context.adapter.findOne({model:t,where:[{field:"userId",value:a.id}]});if(!d||!a.twoFactorEnabled)throw new xe("BAD_REQUEST",{message:X.TOTP_NOT_ENABLED});let A=await he({key:s.context.secret,data:d.secret});return await s.context.password.checkPassword(a.id,s),{totpURI:Lo(A,{digits:o.digits,period:o.period}).url(e?.issuer||s.context.appName,a.email)}}),n=u("/two-factor/verify-totp",{method:"POST",body:po.object({code:po.string({description:"The otp code to verify"})}),use:[ve],metadata:{openapi:{summary:"Verify two factor TOTP",description:"Verify two factor TOTP",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async s=>{if(e?.disable)throw s.context.logger.error("totp isn't configured. please pass totp option on two factor plugin to enable totp"),new xe("BAD_REQUEST",{message:"totp isn't configured"});let a=s.context.session.user,d=await s.context.adapter.findOne({model:t,where:[{field:"userId",value:a.id}]});if(!d)throw new xe("BAD_REQUEST",{message:X.TOTP_NOT_ENABLED});let A=await he({key:s.context.secret,data:d.secret});if(!await Lo(A,{period:o.period,digits:o.digits}).verify(s.body.code))return s.context.invalid();if(!a.twoFactorEnabled){let p=await s.context.internalAdapter.updateUser(a.id,{twoFactorEnabled:!0}),l=await s.context.internalAdapter.createSession(a.id,s.request,!1,s.context.session.session).catch(K=>{throw K});await s.context.internalAdapter.deleteSession(s.context.session.session.token),await b(s,{session:l,user:p})}return s.context.valid()});return{id:"totp",endpoints:{generateTOTP:i,getTOTPURI:r,verifyTOTP:n}}};import{APIError as Pp}from"better-call";async function xo(e,o){let i=(await e.context.internalAdapter.findAccounts(o.userId))?.find(s=>s.providerId==="credential"),r=i?.password;return!i||!r?!1:await e.context.password.verify({hash:r,password:o.password})}import{APIError as Tt}from"better-call";var Ot={user:{fields:{twoFactorEnabled:{type:"boolean",required:!1,defaultValue:!1,input:!1}}},twoFactor:{fields:{secret:{type:"string",required:!0,returned:!1},backupCodes:{type:"string",required:!0,returned:!1},userId:{type:"string",required:!0,returned:!1,references:{model:"user",field:"id"}}}}};import{createOTP as yn}from"@better-auth/utils/otp";import{createHMAC as Et}from"@better-auth/utils/hmac";var Lp=e=>({id:"two-factor",$InferServerPlugin:{},atomListeners:[{matcher:o=>o.startsWith("/two-factor/"),signal:"$sessionSignal"}],pathMethods:{"/two-factor/disable":"POST","/two-factor/enable":"POST","/two-factor/send-otp":"POST","/two-factor/generate-backup-codes":"POST"},fetchPlugins:[{id:"two-factor",name:"two-factor",hooks:{async onSuccess(o){o.data?.twoFactorRedirect&&e?.onTwoFactorRedirect&&await e.onTwoFactorRedirect()}}}]});var oK=e=>{let o={twoFactorTable:"twoFactor"},t=bt(e?.totpOptions),i=yt(e?.backupCodeOptions),r=Ct(e?.otpOptions);return{id:"two-factor",endpoints:{...t.endpoints,...r.endpoints,...i.endpoints,enableTwoFactor:u("/two-factor/enable",{method:"POST",body:Ko.object({password:Ko.string({description:"User password"}).min(8)}),use:[I],metadata:{openapi:{summary:"Enable two factor authentication",description:"Use this endpoint to enable two factor authentication. This will generate a TOTP URI and backup codes. Once the user verifies the TOTP URI, the two factor authentication will be enabled.",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{totpURI:{type:"string",description:"TOTP URI"},backupCodes:{type:"array",items:{type:"string"},description:"Backup codes"}}}}}}}}}},async n=>{let s=n.context.session.user,{password:a}=n.body;if(!await xo(n,{password:a,userId:s.id}))throw new Tt("BAD_REQUEST",{message:f.INVALID_PASSWORD});let A=_(32),c=await le({key:n.context.secret,data:A}),p=await No(n.context.secret,e?.backupCodeOptions);if(e?.skipVerificationOnEnable){let K=await n.context.internalAdapter.updateUser(s.id,{twoFactorEnabled:!0}),y=await n.context.internalAdapter.createSession(K.id,n.request,!1,n.context.session.session);await b(n,{session:y,user:s}),await n.context.internalAdapter.deleteSession(n.context.session.session.token)}await n.context.adapter.deleteMany({model:o.twoFactorTable,where:[{field:"userId",value:s.id}]}),await n.context.adapter.create({model:o.twoFactorTable,data:{secret:c,backupCodes:p.encryptedBackupCodes,userId:s.id}});let l=yn(A,{digits:e?.totpOptions?.digits||6,period:e?.totpOptions?.period}).url(e?.issuer||n.context.appName,s.email);return n.json({totpURI:l,backupCodes:p.backupCodes})}),disableTwoFactor:u("/two-factor/disable",{method:"POST",body:Ko.object({password:Ko.string({description:"User password"}).min(8)}),use:[I],metadata:{openapi:{summary:"Disable two factor authentication",description:"Use this endpoint to disable two factor authentication.",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async n=>{let s=n.context.session.user,{password:a}=n.body;if(!await xo(n,{password:a,userId:s.id}))throw new Tt("BAD_REQUEST",{message:"Invalid password"});await n.context.internalAdapter.updateUser(s.id,{twoFactorEnabled:!1}),await n.context.adapter.delete({model:o.twoFactorTable,where:[{field:"userId",value:s.id}]});let A=await n.context.internalAdapter.createSession(s.id,n.request,!1,n.context.session.session);return await b(n,{session:A,user:s}),await n.context.internalAdapter.deleteSession(n.context.session.session.token),n.json({status:!0})})},options:e,hooks:{after:[{matcher(n){return n.path==="/sign-in/email"||n.path==="/sign-in/username"||n.path==="/sign-in/phone-number"},handler:N(async n=>{let s=n.context.newSession;if(!s||!s?.user.twoFactorEnabled)return;let a=n.context.createAuthCookie(lo),d=await n.getSignedCookie(a.name,n.context.secret);if(d){let[c,p]=d.split("!"),l=await Et("SHA-256","base64urlnopad").sign(n.context.secret,`${s.user.id}!${p}`);if(c===l){let K=await Et("SHA-256","base64urlnopad").sign(n.context.secret,`${s.user.id}!${p}`);await n.setSignedCookie(a.name,`${K}!${s.session.token}`,n.context.secret,a.attributes);return}}G(n),await n.context.internalAdapter.deleteSession(s.session.token);let A=n.context.createAuthCookie(uo,{maxAge:60*10});return await n.setSignedCookie(A.name,s.user.id,n.context.secret,A.attributes),n.json({twoFactorRedirect:!0})})}]},schema:me(Ot,e?.schema),rateLimit:[{pathMatcher(n){return n.startsWith("/two-factor/")},window:10,max:3}]}};import{z as mo}from"zod";import{APIError as je}from"better-call";var Rt=()=>{let e={INVALID_USERNAME_OR_PASSWORD:"invalid username or password",EMAIL_NOT_VERIFIED:"email not verified",UNEXPECTED_ERROR:"unexpected error",USERNAME_IS_ALREADY_TAKEN:"username is already taken. please try another."};return{id:"username",endpoints:{signInUsername:u("/sign-in/username",{method:"POST",body:mo.object({username:mo.string({description:"The username of the user"}),password:mo.string({description:"The password of the user"}),rememberMe:mo.boolean({description:"Remember the user session"}).optional()}),metadata:{openapi:{summary:"Sign in with username",description:"Sign in with username",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}}}}}},async o=>{let t=await o.context.adapter.findOne({model:"user",where:[{field:"username",value:o.body.username.toLowerCase()}]});if(!t)throw await o.context.password.hash(o.body.password),o.context.logger.error("User not found",{username:Rt}),new je("UNAUTHORIZED",{message:e.INVALID_USERNAME_OR_PASSWORD});if(!t.emailVerified&&o.context.options.emailAndPassword?.requireEmailVerification)throw await vo(o,t),new je("UNAUTHORIZED",{message:e.INVALID_USERNAME_OR_PASSWORD});let i=await o.context.adapter.findOne({model:"account",where:[{field:"userId",value:t.id},{field:"providerId",value:"credential"}]});if(!i)throw new je("UNAUTHORIZED",{message:e.INVALID_USERNAME_OR_PASSWORD});let r=i?.password;if(!r)throw o.context.logger.error("Password not found",{username:Rt}),new je("UNAUTHORIZED",{message:e.INVALID_USERNAME_OR_PASSWORD});if(!await o.context.password.verify({hash:r,password:o.body.password}))throw o.context.logger.error("Invalid password"),new je("UNAUTHORIZED",{message:e.INVALID_USERNAME_OR_PASSWORD});let s=await o.context.internalAdapter.createSession(t.id,o.request,o.body.rememberMe===!1);return s?(await b(o,{session:s,user:t},o.body.rememberMe===!1),o.json({token:s.token})):o.json(null,{status:500,body:{message:f.FAILED_TO_CREATE_SESSION,status:500}})})},schema:{user:{fields:{username:{type:"string",required:!1,unique:!0,returned:!0,transform:{input(o){return o?.toString().toLowerCase()}}}}}},hooks:{before:[{matcher(o){return o.path==="/sign-up/email"},async handler(o){let t=o.body.username;if(t&&await o.context.adapter.findOne({model:"user",where:[{field:"username",value:t.toLowerCase()}]}))throw new je("UNPROCESSABLE_ENTITY",{message:e.USERNAME_IS_ALREADY_TAKEN})}}]},$ERROR_CODES:X}};import{serializeSigned as wn}from"better-call";import{createHMAC as Cn}from"@better-auth/utils/hmac";var fK=e=>({id:"bearer",hooks:{before:[{matcher(o){return!!(o.request?.headers.get("authorization")||o.headers?.get("authorization"))},handler:async o=>{let t=o.request?.headers.get("authorization")?.replace("Bearer ","")||o.headers?.get("authorization")?.replace("Bearer ","");if(!t)return;let i="";if(t.includes("."))i=t.replace("=","");else{if(e?.requireSignature)return;i=(await wn("",t,o.context.secret)).replace("=","")}try{let r=decodeURIComponent(i);if(!await Cn("SHA-256","base64urlnopad").verify(o.context.secret,r.split(".")[0],r.split(".")[1]))return}catch{return}return o.request&&o.request.headers.append("cookie",`${o.context.authCookies.sessionToken.name}=${i}`),o.headers&&o.headers.append("cookie",`${o.context.authCookies.sessionToken.name}=${i}`),{context:o}}}],after:[{matcher(o){return!!o.responseHeader.get("set-cookie")},handler:N(async o=>{let t=o.responseHeader.get("set-cookie");if(!t)return;let i=Oe(t),r=o.context.authCookies.sessionToken.name,n=i.get(r);if(!n||!n.value||n["max-age"]===0)return;let s=n.value;return o.responseHeader.set("set-auth-token",s),{responseHeader:o.responseHeader}})}]}});import{z as ze}from"zod";import{APIError as bn}from"better-call";var EK=e=>({id:"magic-link",endpoints:{signInMagicLink:u("/sign-in/magic-link",{method:"POST",requireHeaders:!0,body:ze.object({email:ze.string({description:"Email address to send the magic link"}).email(),callbackURL:ze.string({description:"URL to redirect after magic link verification"}).optional()}),metadata:{openapi:{description:"Sign in with magic link",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async o=>{let{email:t}=o.body;if(e.disableSignUp&&!await o.context.internalAdapter.findUserByEmail(t))throw new bn("BAD_REQUEST",{message:f.USER_NOT_FOUND});let i=_(32,"a-z","A-Z");await o.context.internalAdapter.createVerificationValue({identifier:i,value:t,expiresAt:new Date(Date.now()+(e.expiresIn||60*5)*1e3)});let r=`${o.context.baseURL}/magic-link/verify?token=${i}&callbackURL=${o.body.callbackURL||"/"}`;return await e.sendMagicLink({email:t,url:r,token:i},o.request),o.json({status:!0})}),magicLinkVerify:u("/magic-link/verify",{method:"GET",query:ze.object({token:ze.string({description:"Verification token"}),callbackURL:ze.string({description:"URL to redirect after magic link verification, if not provided will return session"}).optional()}),requireHeaders:!0,metadata:{openapi:{description:"Verify magic link",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},async o=>{let{token:t,callbackURL:i}=o.query,r=i?.startsWith("http")?i:i?`${o.context.options.baseURL}${i}`:o.context.options.baseURL,n=await o.context.internalAdapter.findVerificationValue(t);if(!n)throw o.redirect(`${r}?error=INVALID_TOKEN`);if(n.expiresAt<new Date)throw await o.context.internalAdapter.deleteVerificationValue(n.id),o.redirect(`${r}?error=EXPIRED_TOKEN`);await o.context.internalAdapter.deleteVerificationValue(n.id);let s=n.value,a=await o.context.internalAdapter.findUserByEmail(s).then(A=>A?.user);if(!a){if(e.disableSignUp)throw o.redirect(`${r}?error=failed_to_create_user`);if(a=await o.context.internalAdapter.createUser({email:s,emailVerified:!0,name:s}),!a)throw o.redirect(`${r}?error=failed_to_create_user`)}a.emailVerified||await o.context.internalAdapter.updateUser(a.id,{emailVerified:!0});let d=await o.context.internalAdapter.createSession(a.id,o.headers);if(!d)throw o.redirect(`${r}?error=failed_to_create_session`);if(await b(o,{session:d,user:a}),!i)return o.json({token:d.token});throw o.redirect(i)})},rateLimit:[{pathMatcher(o){return o.startsWith("/sign-in/magic-link")||o.startsWith("/magic-link/verify")},window:e.rateLimit?.window||60,max:e.rateLimit?.max||5}]});import{z as ce}from"zod";import{APIError as Y}from"better-call";function On(e){return _(e,"0-9")}var LK=e=>{let o={expiresIn:e?.expiresIn||300,otpLength:e?.otpLength||6,...e,phoneNumber:"phoneNumber",phoneNumberVerified:"phoneNumberVerified",code:"code",createdAt:"createdAt"},t={INVALID_PHONE_NUMBER:"Invalid phone number",INVALID_PHONE_NUMBER_OR_PASSWORD:"Invalid phone number or password",UNEXPECTED_ERROR:"Unexpected error",OTP_NOT_FOUND:"OTP not found"};return{id:"phone-number",endpoints:{signInPhoneNumber:u("/sign-in/phone-number",{method:"POST",body:ce.object({phoneNumber:ce.string({description:"Phone number to sign in"}),password:ce.string({description:"Password to use for sign in"}),rememberMe:ce.boolean({description:"Remember the session"}).optional()}),metadata:{openapi:{summary:"Sign in with phone number",description:"Use this endpoint to sign in with phone number",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}},400:{description:"Invalid phone number or password"}}}}},async i=>{let{password:r,phoneNumber:n}=i.body;if(o.phoneNumberValidator&&!await o.phoneNumberValidator(i.body.phoneNumber))throw new Y("BAD_REQUEST",{message:t.INVALID_PHONE_NUMBER});let s=await i.context.adapter.findOne({model:"user",where:[{field:"phoneNumber",value:n}]});if(!s)throw new Y("UNAUTHORIZED",{message:t.INVALID_PHONE_NUMBER_OR_PASSWORD});let d=(await i.context.internalAdapter.findAccountByUserId(s.id)).find(l=>l.providerId==="credential");if(!d)throw i.context.logger.error("Credential account not found",{phoneNumber:n}),new Y("UNAUTHORIZED",{message:t.INVALID_PHONE_NUMBER_OR_PASSWORD});let A=d?.password;if(!A)throw i.context.logger.error("Password not found",{phoneNumber:n}),new Y("UNAUTHORIZED",{message:t.UNEXPECTED_ERROR});if(!await i.context.password.verify({hash:A,password:r}))throw i.context.logger.error("Invalid password"),new Y("UNAUTHORIZED",{message:t.INVALID_PHONE_NUMBER_OR_PASSWORD});let p=await i.context.internalAdapter.createSession(s.id,i.headers,i.body.rememberMe===!1);if(!p)throw i.context.logger.error("Failed to create session"),new Y("UNAUTHORIZED",{message:f.FAILED_TO_CREATE_SESSION});return await b(i,{session:p,user:s},i.body.rememberMe===!1),i.json({token:p.token})}),sendPhoneNumberOTP:u("/phone-number/send-otp",{method:"POST",body:ce.object({phoneNumber:ce.string({description:"Phone number to send OTP"})}),metadata:{openapi:{summary:"Send OTP to phone number",description:"Use this endpoint to send OTP to phone number",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async i=>{if(!e?.sendOTP)throw i.context.logger.warn("sendOTP not implemented"),new Y("NOT_IMPLEMENTED",{message:"sendOTP not implemented"});if(o.phoneNumberValidator&&!await o.phoneNumberValidator(i.body.phoneNumber))throw new Y("BAD_REQUEST",{message:t.INVALID_PHONE_NUMBER});let r=On(o.otpLength);return await i.context.internalAdapter.createVerificationValue({value:r,identifier:i.body.phoneNumber,expiresAt:L(o.expiresIn,"sec")}),await e.sendOTP({phoneNumber:i.body.phoneNumber,code:r},i.request),i.json({code:r},{body:{message:"Code sent"}})}),verifyPhoneNumber:u("/phone-number/verify",{method:"POST",body:ce.object({phoneNumber:ce.string({description:"Phone number to verify"}),code:ce.string({description:"OTP code"}),disableSession:ce.boolean({description:"Disable session creation after verification"}).optional(),updatePhoneNumber:ce.boolean({description:"Check if there is a session and update the phone number"}).optional()}),metadata:{openapi:{summary:"Verify phone number",description:"Use this endpoint to verify phone number",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}},400:{description:"Invalid OTP"}}}}},async i=>{let r=await i.context.internalAdapter.findVerificationValue(i.body.phoneNumber);if(!r||r.expiresAt<new Date)throw r&&r.expiresAt<new Date?(await i.context.internalAdapter.deleteVerificationValue(r.id),new Y("BAD_REQUEST",{message:"OTP expired"})):new Y("BAD_REQUEST",{message:t.OTP_NOT_FOUND});if(r.value!==i.body.code)throw new Y("BAD_REQUEST",{message:"Invalid OTP"});if(await i.context.internalAdapter.deleteVerificationValue(r.id),i.body.updatePhoneNumber){let s=await v(i);if(!s)throw new Y("UNAUTHORIZED",{message:f.USER_NOT_FOUND});return await i.context.internalAdapter.updateUser(s.user.id,{[o.phoneNumber]:i.body.phoneNumber,[o.phoneNumberVerified]:!0}),i.json({token:s.session.token,status:!0})}let n=await i.context.adapter.findOne({model:"user",where:[{value:i.body.phoneNumber,field:o.phoneNumber}]});if(await e?.callbackOnVerification?.({phoneNumber:i.body.phoneNumber,user:n},i.request),n)n=await i.context.internalAdapter.updateUser(n.id,{[o.phoneNumberVerified]:!0});else if(e?.signUpOnVerification){if(n=await i.context.internalAdapter.createUser({email:e.signUpOnVerification.getTempEmail(i.body.phoneNumber),name:e.signUpOnVerification.getTempName?e.signUpOnVerification.getTempName(i.body.phoneNumber):i.body.phoneNumber,[o.phoneNumber]:i.body.phoneNumber,[o.phoneNumberVerified]:!0}),!n)throw new Y("INTERNAL_SERVER_ERROR",{message:f.FAILED_TO_CREATE_USER})}else return i.json(null);if(!n)throw new Y("INTERNAL_SERVER_ERROR",{message:f.FAILED_TO_UPDATE_USER});if(!i.body.disableSession){let s=await i.context.internalAdapter.createSession(n.id,i.request);if(!s)throw new Y("INTERNAL_SERVER_ERROR",{message:f.FAILED_TO_CREATE_SESSION});return await b(i,{session:s,user:n}),i.json({token:s.token,status:!0})}return i.json({token:null,status:!0})})},schema:me(Tn,e?.schema),$ERROR_CODES:t}},Tn={user:{fields:{phoneNumber:{type:"string",required:!1,unique:!0,returned:!0},phoneNumberVerified:{type:"boolean",required:!1,returned:!0,input:!1}}}};var En={user:{fields:{isAnonymous:{type:"boolean",required:!1}}}},MK=e=>{let o={FAILED_TO_CREATE_USER:"Failed to create user",COULD_NOT_CREATE_SESSION:"Could not create session",ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY:"Anonymous users cannot sign in again anonymously"};return{id:"anonymous",endpoints:{signInAnonymous:u("/sign-in/anonymous",{method:"POST",metadata:{openapi:{description:"Sign in anonymously",responses:{200:{description:"Sign in anonymously",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}}}}}},async t=>{let{emailDomainName:i=Ue(t.context.baseURL)}=e||{},r=t.context.generateId({model:"user"}),n=`temp-${r}@${i}`,s=await t.context.internalAdapter.createUser({id:r,email:n,emailVerified:!1,isAnonymous:!0,name:"Anonymous",createdAt:new Date,updatedAt:new Date});if(!s)return t.json(null,{status:500,body:{message:o.FAILED_TO_CREATE_USER,status:500}});let a=await t.context.internalAdapter.createSession(s.id,t.request);return a?(await b(t,{session:a,user:s}),t.json({token:a.token})):t.json(null,{status:400,body:{message:o.COULD_NOT_CREATE_SESSION}})})},hooks:{after:[{matcher(t){return!!t.responseHeader.get("set-cookie")?.includes(t.context.authCookies.sessionToken.name)},handler:N(async t=>{let r=t.responseHeader.get("set-cookie"),n=t.context.authCookies.sessionToken.name;if(!Oe(r||"").get(n)?.value.split(".")[0])return;let a=await v(t,{disableRefresh:!0});if(!a||!a.user.isAnonymous)return;if(t.path==="/sign-in/anonymous")throw new m("BAD_REQUEST",{message:o.ANONYMOUS_USERS_CANNOT_SIGN_IN_AGAIN_ANONYMOUSLY});let d=t.context.newSession;d&&(e?.onLinkAccount&&await e?.onLinkAccount?.({anonymousUser:a,newUser:d}),e?.disableDeleteAnonymousUser||await t.context.internalAdapter.deleteUser(a.user.id))})}]},schema:me(En,e?.schema),$ERROR_CODES:o}};import{z as T}from"zod";import{APIError as Rn}from"better-call";var It=async e=>{let o=e.context.returned;return o?o instanceof Response?o.status!==200?null:await o.clone().json():o instanceof Rn?null:o:null};var im=e=>{let o={defaultRole:"user",adminRole:"admin",...e},t={FAILED_TO_CREATE_USER:"Failed to create user",USER_ALREADY_EXISTS:"User already exists",USER_NOT_FOUND:"User not found",YOU_CANNOT_BAN_YOURSELF:"You cannot ban yourself",ONLY_ADMINS_CAN_ACCESS_THIS_ENDPOINT:"Only admins can access this endpoint"},i=N(async r=>{let n=await v(r);if(!n?.session)throw new m("UNAUTHORIZED");let s=n.user;if(!s.role||(Array.isArray(o.adminRole)?!o.adminRole.includes(s.role):s.role!==o.adminRole))throw new m("FORBIDDEN",{message:"Only admins can access this endpoint"});return{session:{user:s,session:n.session}}});return{id:"admin",init(r){return{options:{databaseHooks:{user:{create:{async before(n){if(e?.defaultRole!==!1)return{data:{role:e?.defaultRole??"user",...n}}}}},session:{create:{async before(n){let s=await r.internalAdapter.findUserById(n.userId);if(s.banned){if(s.banExpires&&s.banExpires.getTime()<Date.now()){await r.internalAdapter.updateUser(n.userId,{banned:!1,banReason:null,banExpires:null});return}return!1}}}}}}}},hooks:{after:[{matcher(r){return r.path==="/list-sessions"},handler:N(async r=>{let n=await It(r);if(!n)return;let s=n.filter(a=>!a.impersonatedBy);return r.json(s)})}]},endpoints:{setRole:u("/admin/set-role",{method:"POST",body:T.object({userId:T.string({description:"The user id"}),role:T.string({description:"The role to set. `admin` or `user` by default"})}),use:[i],metadata:{openapi:{operationId:"setRole",summary:"Set the role of a user",description:"Set the role of a user",responses:{200:{description:"User role updated",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async r=>{let n=await r.context.internalAdapter.updateUser(r.body.userId,{role:r.body.role});return r.json({user:n})}),createUser:u("/admin/create-user",{method:"POST",body:T.object({email:T.string({description:"The email of the user"}),password:T.string({description:"The password of the user"}),name:T.string({description:"The name of the user"}),role:T.string({description:"The role of the user"}),data:T.optional(T.record(T.any(),{description:"Extra fields for the user. Including custom additional fields."}))}),use:[i],metadata:{openapi:{operationId:"createUser",summary:"Create a new user",description:"Create a new user",responses:{200:{description:"User created",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async r=>{if(await r.context.internalAdapter.findUserByEmail(r.body.email))throw new m("BAD_REQUEST",{message:t.USER_ALREADY_EXISTS});let s=await r.context.internalAdapter.createUser({email:r.body.email,name:r.body.name,role:r.body.role,...r.body.data});if(!s)throw new m("INTERNAL_SERVER_ERROR",{message:t.FAILED_TO_CREATE_USER});let a=await r.context.password.hash(r.body.password);return await r.context.internalAdapter.linkAccount({accountId:s.id,providerId:"credential",password:a,userId:s.id}),r.json({user:s})}),listUsers:u("/admin/list-users",{method:"GET",use:[i],query:T.object({searchValue:T.string({description:"The value to search for"}).optional(),searchField:T.enum(["email","name"],{description:"The field to search in, defaults to email. Can be `email` or `name`"}).optional(),searchOperator:T.enum(["contains","starts_with","ends_with"],{description:"The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`"}).optional(),limit:T.string({description:"The number of users to return"}).or(T.number()).optional(),offset:T.string({description:"The offset to start from"}).or(T.number()).optional(),sortBy:T.string({description:"The field to sort by"}).optional(),sortDirection:T.enum(["asc","desc"],{description:"The direction to sort by"}).optional(),filterField:T.string({description:"The field to filter by"}).optional(),filterValue:T.string({description:"The value to filter by"}).or(T.number()).or(T.boolean()).optional(),filterOperator:T.enum(["eq","ne","lt","lte","gt","gte"],{description:"The operator to use for the filter"}).optional()}),metadata:{openapi:{operationId:"listUsers",summary:"List users",description:"List users",responses:{200:{description:"List of users",content:{"application/json":{schema:{type:"object",properties:{users:{type:"array",items:{$ref:"#/components/schemas/User"}}}}}}}}}}},async r=>{let n=[];r.query?.searchValue&&n.push({field:r.query.searchField||"email",operator:r.query.searchOperator||"contains",value:r.query.searchValue}),r.query?.filterValue&&n.push({field:r.query.filterField||"email",operator:r.query.filterOperator||"eq",value:r.query.filterValue});try{let s=await r.context.internalAdapter.listUsers(Number(r.query?.limit)||void 0,Number(r.query?.offset)||void 0,r.query?.sortBy?{field:r.query.sortBy,direction:r.query.sortDirection||"asc"}:void 0,n.length?n:void 0),a=await r.context.internalAdapter.listTotalUsers();return r.json({users:s,total:a,limit:Number(r.query?.limit)||void 0,offset:Number(r.query?.offset)||void 0})}catch(s){return console.log(s),r.json({users:[],total:0})}}),listUserSessions:u("/admin/list-user-sessions",{method:"POST",use:[i],body:T.object({userId:T.string({description:"The user id"})}),metadata:{openapi:{operationId:"listUserSessions",summary:"List user sessions",description:"List user sessions",responses:{200:{description:"List of user sessions",content:{"application/json":{schema:{type:"object",properties:{sessions:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}}}},async r=>({sessions:await r.context.internalAdapter.listSessions(r.body.userId)})),unbanUser:u("/admin/unban-user",{method:"POST",body:T.object({userId:T.string({description:"The user id"})}),use:[i],metadata:{openapi:{operationId:"unbanUser",summary:"Unban a user",description:"Unban a user",responses:{200:{description:"User unbanned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async r=>{let n=await r.context.internalAdapter.updateUser(r.body.userId,{banned:!1});return r.json({user:n})}),banUser:u("/admin/ban-user",{method:"POST",body:T.object({userId:T.string({description:"The user id"}),banReason:T.string({description:"The reason for the ban"}).optional(),banExpiresIn:T.number({description:"The number of seconds until the ban expires"}).optional()}),use:[i],metadata:{openapi:{operationId:"banUser",summary:"Ban a user",description:"Ban a user",responses:{200:{description:"User banned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async r=>{if(r.body.userId===r.context.session.user.id)throw new m("BAD_REQUEST",{message:t.YOU_CANNOT_BAN_YOURSELF});let n=await r.context.internalAdapter.updateUser(r.body.userId,{banned:!0,banReason:r.body.banReason||e?.defaultBanReason||"No reason",banExpires:r.body.banExpiresIn?L(r.body.banExpiresIn,"sec"):e?.defaultBanExpiresIn?L(e.defaultBanExpiresIn,"sec"):void 0});return await r.context.internalAdapter.deleteSessions(r.body.userId),r.json({user:n})}),impersonateUser:u("/admin/impersonate-user",{method:"POST",body:T.object({userId:T.string({description:"The user id"})}),use:[i],metadata:{openapi:{operationId:"impersonateUser",summary:"Impersonate a user",description:"Impersonate a user",responses:{200:{description:"Impersonation session created",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},async r=>{let n=await r.context.internalAdapter.findUserById(r.body.userId);if(!n)throw new m("NOT_FOUND",{message:"User not found"});let s=await r.context.internalAdapter.createSession(n.id,void 0,!0,{impersonatedBy:r.context.session.user.id,expiresAt:e?.impersonationSessionDuration?L(e.impersonationSessionDuration,"sec"):L(60*60,"sec")});if(!s)throw new m("INTERNAL_SERVER_ERROR",{message:t.FAILED_TO_CREATE_USER});let a=r.context.authCookies;return G(r),await r.setSignedCookie("admin_session",r.context.session.session.token,r.context.secret,a.sessionToken.options),await b(r,{session:s,user:n},!0),r.json({session:s,user:n})}),stopImpersonating:u("/admin/stop-impersonating",{method:"POST"},async r=>{let n=await v(r);if(!n)throw new m("UNAUTHORIZED");if(!n.session.impersonatedBy)throw new m("BAD_REQUEST",{message:"You are not impersonating anyone"});let s=await r.context.internalAdapter.findUserById(n.session.impersonatedBy);if(!s)throw new m("INTERNAL_SERVER_ERROR",{message:"Failed to find user"});let a=await r.getSignedCookie("admin_session",r.context.secret);if(!a)throw new m("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});let d=await r.context.internalAdapter.findSession(a);if(!d||d.session.userId!==s.id)throw new m("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});return await b(r,d),r.json(d)}),revokeUserSession:u("/admin/revoke-user-session",{method:"POST",body:T.object({sessionToken:T.string({description:"The session token"})}),use:[i],metadata:{openapi:{operationId:"revokeUserSession",summary:"Revoke a user session",description:"Revoke a user session",responses:{200:{description:"Session revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async r=>(await r.context.internalAdapter.deleteSession(r.body.sessionToken),r.json({success:!0}))),revokeUserSessions:u("/admin/revoke-user-sessions",{method:"POST",body:T.object({userId:T.string({description:"The user id"})}),use:[i],metadata:{openapi:{operationId:"revokeUserSessions",summary:"Revoke all user sessions",description:"Revoke all user sessions",responses:{200:{description:"Sessions revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async r=>(await r.context.internalAdapter.deleteSessions(r.body.userId),r.json({success:!0}))),removeUser:u("/admin/remove-user",{method:"POST",body:T.object({userId:T.string({description:"The user id"})}),use:[i],metadata:{openapi:{operationId:"removeUser",summary:"Remove a user",description:"Delete a user and all their sessions and accounts. Cannot be undone.",responses:{200:{description:"User removed",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async r=>(await r.context.internalAdapter.deleteUser(r.body.userId),r.json({success:!0})))},$ERROR_CODES:t,schema:me(In,o.schema)}},In={user:{fields:{role:{type:"string",required:!1,input:!1},banned:{type:"boolean",defaultValue:!1,required:!1,input:!1},banReason:{type:"string",required:!1,input:!1},banExpires:{type:"date",required:!1,input:!1}}},session:{fields:{impersonatedBy:{type:"string",required:!1}}}};import{APIError as Be}from"better-call";import{z as ue}from"zod";import{decodeJwt as _n}from"jose";async function _t(e,o){if(e.idToken){let i=_n(e.idToken);if(i&&i.sub&&i.email)return{id:i.sub,emailVerified:i.email_verified,image:i.picture,...i}}if(!o)return null;let t=await R(o,{method:"GET",headers:{Authorization:`Bearer ${e.accessToken}`}});return{id:t.data?.sub,emailVerified:t.data?.email_verified,email:t.data?.email,image:t.data?.picture,name:t.data?.name,...t.data}}var pm=e=>{let o={INVALID_OAUTH_CONFIGURATION:"Invalid OAuth configuration"};return{id:"generic-oauth",init:t=>({context:{socialProviders:e.config.map(r=>{let n=r.userInfoUrl;return{id:r.providerId,name:r.providerId,createAuthorizationURL(s){return D({id:r.providerId,options:{clientId:r.clientId,clientSecret:r.clientSecret,redirectURI:r.redirectURI},authorizationEndpoint:r.authorizationUrl,state:s.state,codeVerifier:r.pkce?s.codeVerifier:void 0,scopes:r.scopes||[],redirectURI:`${t.baseURL}/oauth2/callback/${r.providerId}`})},async validateAuthorizationCode(s){let a=r.tokenUrl;if(r.discoveryUrl){let d=await R(r.discoveryUrl,{method:"GET"});d.data&&(a=d.data.token_endpoint,n=d.data.userinfo_endpoint)}if(!a)throw new Be("BAD_REQUEST",{message:"Invalid OAuth configuration. Token URL not found."});return U({code:s.code,codeVerifier:s.codeVerifier,redirectURI:s.redirectURI,options:{clientId:r.clientId,clientSecret:r.clientSecret},tokenEndpoint:a})},async getUserInfo(s){if(!n)return null;let a=r.getUserInfo?await r.getUserInfo(s):await _t(s,n);return a?{user:{id:a?.id,email:a?.email,emailVerified:a?.emailVerified,image:a?.image,name:a?.name,...r.mapProfileToUser?.(a)},data:a}:null}}}).concat(t.socialProviders)}}),endpoints:{signInWithOAuth2:u("/sign-in/oauth2",{method:"POST",query:ue.object({currentURL:ue.string({description:"Redirect to the current URL after sign in"}).optional()}).optional(),body:ue.object({providerId:ue.string({description:"The provider ID for the OAuth provider"}),callbackURL:ue.string({description:"The URL to redirect to after sign in"}).optional(),errorCallbackURL:ue.string({description:"The URL to redirect to if an error occurs"}).optional(),disableRedirect:ue.boolean({description:"Disable redirect"}).optional()}),metadata:{openapi:{description:"Sign in with OAuth2",responses:{200:{description:"Sign in with OAuth2",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string"},redirect:{type:"boolean"}}}}}}}}}},async t=>{let{providerId:i}=t.body,r=e.config.find(S=>S.providerId===i);if(!r)throw new Be("BAD_REQUEST",{message:`No config found for provider ${i}`});let{discoveryUrl:n,authorizationUrl:s,tokenUrl:a,clientId:d,clientSecret:A,scopes:c,redirectURI:p,responseType:l,pkce:K,prompt:y,accessType:h}=r,x=s,j=a;if(n){let S=await R(n,{onError(C){t.context.logger.error(C.error.message,C.error,{discoveryUrl:n})}});S.data&&(x=S.data.authorization_endpoint,j=S.data.token_endpoint)}if(!x||!j)throw new Be("BAD_REQUEST",{message:o.INVALID_OAUTH_CONFIGURATION});let{state:z,codeVerifier:g}=await Se(t),w=await D({id:i,options:{clientId:d,clientSecret:A,redirectURI:p},authorizationEndpoint:x,state:z,codeVerifier:K?g:void 0,scopes:c||[],redirectURI:`${t.context.baseURL}/oauth2/callback/${i}`});return l&&l!=="code"&&w.searchParams.set("response_type",l),y&&w.searchParams.set("prompt",y),h&&w.searchParams.set("access_type",h),t.json({url:w.toString(),redirect:!t.body.disableRedirect})}),oAuth2Callback:u("/oauth2/callback/:providerId",{method:"GET",query:ue.object({code:ue.string({description:"The OAuth2 code"}).optional(),error:ue.string({description:"The error message, if any"}).optional(),state:ue.string({description:"The state parameter from the OAuth2 request"}).optional()}),metadata:{openapi:{description:"OAuth2 callback",responses:{200:{description:"OAuth2 callback",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string"}}}}}}}}}},async t=>{if(t.query.error||!t.query.code)throw t.redirect(`${t.context.options.baseURL}?error=${t.query.error||"oAuth_code_missing"}`);let i=e.config.find(g=>g.providerId===t.params.providerId);if(!i)throw new Be("BAD_REQUEST",{message:`No config found for provider ${t.params.providerId}`});let r,n=await so(t),{callbackURL:s,codeVerifier:a,errorURL:d}=n,A=t.query.code,c=i.tokenUrl,p=i.userInfoUrl;if(i.discoveryUrl){let g=await R(i.discoveryUrl,{method:"GET"});g.data&&(c=g.data.token_endpoint,p=g.data.userinfo_endpoint)}try{if(!c)throw new Be("BAD_REQUEST",{message:"Invalid OAuth configuration."});r=await U({code:A,codeVerifier:a,redirectURI:`${t.context.baseURL}/oauth2/callback/${i.providerId}`,options:{clientId:i.clientId,clientSecret:i.clientSecret},tokenEndpoint:c})}catch(g){throw t.context.logger.error(g&&typeof g=="object"&&"name"in g?g.name:"",g),t.redirect(`${d}?error=oauth_code_verification_failed`)}if(!r)throw new Be("BAD_REQUEST",{message:"Invalid OAuth configuration."});let l=i.getUserInfo?await i.getUserInfo(r):await _t(r,p);if(!l?.email)throw t.context.logger.error("Unable to get user info",l),t.redirect(`${t.context.baseURL}/error?error=email_is_missing`);let K=i.mapProfileToUser?await i.mapProfileToUser(l):null,y=await Ne(t,{userInfo:{...l,...K},account:{providerId:i.providerId,accountId:l.id,...r,scope:r.scopes?.join(",")}});function h(g){throw t.redirect(`${d||s||`${t.context.baseURL}/error`}?error=${g}`)}if(y.error)return h(y.error.split(" ").join("_"));let{session:x,user:j}=y.data;await b(t,{session:x,user:j});let z;try{z=new URL(s).toString()}catch{z=s}throw t.redirect(z)})},$ERROR_CODES:o}};import{z as Xe}from"zod";var vt={jwks:{fields:{publicKey:{type:"string",required:!0},privateKey:{type:"string",required:!0},createdAt:{type:"date",required:!0}}}},gm=Xe.object({id:Xe.string(),publicKey:Xe.string(),privateKey:Xe.string(),createdAt:Xe.date()});var jo=e=>({getAllKeys:async()=>await e.findMany({model:"jwks"}),getLatestKey:async()=>(await e.findMany({model:"jwks",sortBy:{field:"createdAt",direction:"desc"},limit:1}))[0],createJwk:async o=>await e.create({model:"jwks",data:{...o,createdAt:new Date}})});import{exportJWK as go,generateKeyPair as Ut,importJWK as vn,SignJWT as Un}from"jose";var Em=e=>({id:"jwt",endpoints:{getJwks:u("/jwks",{method:"GET",metadata:{openapi:{description:"Get the JSON Web Key Set",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{keys:{type:"array",items:{type:"object",properties:{kid:{type:"string"},kty:{type:"string"},use:{type:"string"},alg:{type:"string"},n:{type:"string"},e:{type:"string"}}}}}}}}}}}}},async o=>{let t=jo(o.context.adapter),i=await t.getAllKeys();if(i.length===0){let{publicKey:r,privateKey:n}=await Ut(e?.jwks?.keyPairConfig?.alg??"EdDSA",e?.jwks?.keyPairConfig??{crv:"Ed25519",extractable:!0}),s=await go(r),a=await go(n),d=JSON.stringify(a),A=!e?.jwks?.disablePrivateKeyEncryption,c={id:o.context.generateId({model:"jwks"}),publicKey:JSON.stringify(s),privateKey:A?JSON.stringify(await le({key:o.context.options.secret,data:d})):d,createdAt:new Date};return await t.createJwk(c),o.json({keys:[{...s,kid:c.id}]})}return o.json({keys:i.map(r=>({...JSON.parse(r.publicKey),kid:r.id}))})}),getToken:u("/token",{method:"GET",requireHeaders:!0,use:[I],metadata:{openapi:{description:"Get a JWT token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async o=>{let t=jo(o.context.adapter),i=await t.getLatestKey(),r=!e?.jwks?.disablePrivateKeyEncryption;if(i===void 0){let{publicKey:A,privateKey:c}=await Ut(e?.jwks?.keyPairConfig?.alg??"EdDSA",e?.jwks?.keyPairConfig??{crv:"Ed25519",extractable:!0}),p=await go(A),l=await go(c),K=JSON.stringify(l),y={id:o.context.generateId({model:"jwks"}),publicKey:JSON.stringify(p),privateKey:r?JSON.stringify(await le({key:o.context.options.secret,data:K})):K,createdAt:new Date};i=await t.createJwk(y)}let n=r?await he({key:o.context.options.secret,data:JSON.parse(i.privateKey)}):i.privateKey,s=await vn(JSON.parse(n)),a=e?.jwt?.definePayload?await e?.jwt.definePayload(o.context.session):o.context.session.user,d=await new Un({...a,...o.context.session.session.impersonatedBy?{impersonatedBy:o.context.session.session.impersonatedBy}:{}}).setProtectedHeader({alg:e?.jwks?.keyPairConfig?.alg??"EdDSA",kid:i.id}).setIssuedAt().setIssuer(e?.jwt?.issuer??o.context.options.baseURL).setAudience(e?.jwt?.audience??o.context.options.baseURL).setExpirationTime(e?.jwt?.expirationTime??"15m").setSubject(o.context.session.user.id).sign(s);return o.json({token:d})})},schema:me(vt,e?.schema)});import{z as fo}from"zod";var Um=e=>{let o={maximumSessions:5,...e},t=r=>r.includes("_multi-"),i={INVALID_SESSION_TOKEN:"Invalid session token"};return{id:"multi-session",endpoints:{listDeviceSessions:u("/multi-session/list-device-sessions",{method:"GET",requireHeaders:!0},async r=>{let n=r.headers?.get("cookie");if(!n)return r.json([]);let s=Object.fromEntries(qe(n)),a=(await Promise.all(Object.entries(s).filter(([c])=>t(c)).map(async([c])=>await r.getSignedCookie(c,r.context.secret)))).filter(c=>c!==void 0);if(!a.length)return r.json([]);let A=(await r.context.internalAdapter.findSessions(a)).filter(c=>c&&c.session.expiresAt>new Date);return r.json(A)}),setActiveSession:u("/multi-session/set-active",{method:"POST",body:fo.object({sessionToken:fo.string({description:"The session token to set as active"})}),requireHeaders:!0,use:[I],metadata:{openapi:{description:"Set the active session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"}}}}}}}}}},async r=>{let n=r.body.sessionToken,s=`${r.context.authCookies.sessionToken.name}_multi-${n}`;if(!await r.getSignedCookie(s,r.context.secret))throw new m("UNAUTHORIZED",{message:i.INVALID_SESSION_TOKEN});let d=await r.context.internalAdapter.findSession(n);if(!d||d.session.expiresAt<new Date)throw r.setCookie(s,"",{...r.context.authCookies.sessionToken.options,maxAge:0}),new m("UNAUTHORIZED",{message:i.INVALID_SESSION_TOKEN});return await b(r,d),r.json(d)}),revokeDeviceSession:u("/multi-session/revoke",{method:"POST",body:fo.object({sessionToken:fo.string({description:"The session token to revoke"})}),requireHeaders:!0,use:[I],metadata:{openapi:{description:"Revoke a device session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async r=>{let n=r.body.sessionToken,s=`${r.context.authCookies.sessionToken.name}_multi-${n}`;if(!await r.getSignedCookie(s,r.context.secret))throw new m("UNAUTHORIZED",{message:i.INVALID_SESSION_TOKEN});if(await r.context.internalAdapter.deleteSession(n),r.setCookie(s,"",{...r.context.authCookies.sessionToken.options,maxAge:0}),!(r.context.session?.session.token===n))return r.json({status:!0});let A=r.headers?.get("cookie");if(A){let c=Object.fromEntries(qe(A)),p=(await Promise.all(Object.entries(c).filter(([K])=>t(K)).map(async([K])=>await r.getSignedCookie(K,r.context.secret)))).filter(K=>K!==void 0),l=r.context.internalAdapter;if(p.length>0){let y=(await l.findSessions(p)).filter(h=>h&&h.session.expiresAt>new Date);if(y.length>0){let h=y[0];await b(r,h)}else G(r)}else G(r)}else G(r);return r.json({status:!0})})},hooks:{after:[{matcher:()=>!0,handler:N(async r=>{let n=r.responseHeader.get("set-cookie");if(!n)return;let s=Oe(n),a=r.context.authCookies.sessionToken,d=s.get(a.name)?.value;if(!d)return;let A=qe(r.headers?.get("cookie")||""),c=d.split(".")[0];if(!c)return;let p=`${a.name}_multi-${c}`;s.get(p)||A.get(p)||Object.keys(Object.fromEntries(A)).filter(t).length+(n.includes("session_token")?1:0)>o.maximumSessions||await r.setSignedCookie(p,c,r.context.secret,a.options)})},{matcher:r=>r.path==="/sign-out",handler:N(async r=>{let n=r.headers?.get("cookie");if(!n)return;let s=Object.fromEntries(qe(n)),a=Object.keys(s).map(d=>t(d)?(r.setCookie(d,"",{maxAge:0}),d.split("_multi-")[1]):null).filter(d=>d!==null);await r.context.internalAdapter.deleteSessions(a)})}]},$ERROR_CODES:i}};import{z as V}from"zod";var zo=["email-verification","sign-in","forget-password"],xm=e=>{let o={expiresIn:300,otpLength:6,...e},t={OTP_EXPIRED:"otp expired",INVALID_OTP:"invalid otp",INVALID_EMAIL:"invalid email",USER_NOT_FOUND:"user not found"};return{id:"email-otp",endpoints:{sendVerificationOTP:u("/email-otp/send-verification-otp",{method:"POST",body:V.object({email:V.string({description:"Email address to send the OTP"}),type:V.enum(zo,{description:"Type of the OTP"})}),metadata:{openapi:{description:"Send verification OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async i=>{if(!e?.sendVerificationOTP)throw i.context.logger.error("send email verification is not implemented"),new m("BAD_REQUEST",{message:"send email verification is not implemented"});let r=i.body.email;if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r))throw new m("BAD_REQUEST",{message:t.INVALID_EMAIL});if(i.body.type==="forget-password"&&!await i.context.internalAdapter.findUserByEmail(r))return i.json({success:!0});let s=_(o.otpLength,"0-9");return await i.context.internalAdapter.createVerificationValue({value:s,identifier:`${i.body.type}-otp-${r}`,expiresAt:L(o.expiresIn,"sec")}).catch(async a=>{await i.context.internalAdapter.deleteVerificationByIdentifier(`${i.body.type}-otp-${r}`),await i.context.internalAdapter.createVerificationValue({value:s,identifier:`${i.body.type}-otp-${r}`,expiresAt:L(o.expiresIn,"sec")})}),await e.sendVerificationOTP({email:r,otp:s,type:i.body.type},i.request),i.json({success:!0})}),createVerificationOTP:u("/email-otp/create-verification-otp",{method:"POST",body:V.object({email:V.string({description:"Email address to send the OTP"}),type:V.enum(zo,{description:"Type of the OTP"})}),metadata:{SERVER_ONLY:!0,openapi:{description:"Create verification OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"string"}}}}}}}},async i=>{let r=i.body.email,n=_(o.otpLength,"0-9");return await i.context.internalAdapter.createVerificationValue({value:n,identifier:`${i.body.type}-otp-${r}`,expiresAt:L(o.expiresIn,"sec")}),n}),getVerificationOTP:u("/email-otp/get-verification-otp",{method:"GET",query:V.object({email:V.string({description:"Email address to get the OTP"}),type:V.enum(zo)}),metadata:{SERVER_ONLY:!0,openapi:{description:"Get verification OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{otp:{type:"string"}}}}}}}}}},async i=>{let r=i.query.email,n=await i.context.internalAdapter.findVerificationValue(`${i.query.type}-otp-${r}`);return!n||n.expiresAt<new Date?i.json({otp:null}):i.json({otp:n.value})}),verifyEmailOTP:u("/email-otp/verify-email",{method:"POST",body:V.object({email:V.string({description:"Email address to verify"}),otp:V.string({description:"OTP to verify"})}),metadata:{openapi:{description:"Verify email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async i=>{let r=i.body.email;if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(r))throw new m("BAD_REQUEST",{message:t.INVALID_EMAIL});let s=await i.context.internalAdapter.findVerificationValue(`email-verification-otp-${r}`);if(!s)throw new m("BAD_REQUEST",{message:t.INVALID_OTP});if(s.expiresAt<new Date)throw await i.context.internalAdapter.deleteVerificationValue(s.id),new m("BAD_REQUEST",{message:t.OTP_EXPIRED});let a=i.body.otp;if(s.value!==a)throw new m("BAD_REQUEST",{message:t.INVALID_OTP});await i.context.internalAdapter.deleteVerificationValue(s.id);let d=await i.context.internalAdapter.findUserByEmail(r);if(!d)throw new m("BAD_REQUEST",{message:t.USER_NOT_FOUND});let A=await i.context.internalAdapter.updateUser(d.user.id,{email:r,emailVerified:!0});if(i.context.options.emailVerification?.autoSignInAfterVerification){let c=await i.context.internalAdapter.createSession(A.id,i.request);return await b(i,{session:c,user:A}),i.json({token:c.token,status:!0})}return i.json({status:!0,token:null})}),signInEmailOTP:u("/sign-in/email-otp",{method:"POST",body:V.object({email:V.string({description:"Email address to sign in"}),otp:V.string({description:"OTP sent to the email"})}),metadata:{openapi:{description:"Sign in with email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}}}}}},async i=>{let r=i.body.email,n=await i.context.internalAdapter.findVerificationValue(`sign-in-otp-${r}`);if(!n)throw new m("BAD_REQUEST",{message:t.INVALID_OTP});if(n.expiresAt<new Date)throw await i.context.internalAdapter.deleteVerificationValue(n.id),new m("BAD_REQUEST",{message:t.OTP_EXPIRED});let s=i.body.otp;if(n.value!==s)throw new m("BAD_REQUEST",{message:t.INVALID_OTP});await i.context.internalAdapter.deleteVerificationValue(n.id);let a=await i.context.internalAdapter.findUserByEmail(r);if(!a){if(o.disableSignUp)throw new m("BAD_REQUEST",{message:t.USER_NOT_FOUND});let A=await i.context.internalAdapter.createUser({email:r,emailVerified:!0,name:r}),c=await i.context.internalAdapter.createSession(A.id,i.request);return await b(i,{session:c,user:A}),i.json({token:c.token})}a.user.emailVerified||await i.context.internalAdapter.updateUser(a.user.id,{emailVerified:!0});let d=await i.context.internalAdapter.createSession(a.user.id,i.request);return await b(i,{session:d,user:a.user}),i.json({token:d.token})}),forgetPasswordEmailOTP:u("/forget-password/email-otp",{method:"POST",body:V.object({email:V.string({description:"Email address to send the OTP"})}),metadata:{openapi:{description:"Forget password with email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async i=>{let r=i.body.email;if(!await i.context.internalAdapter.findUserByEmail(r))throw new m("BAD_REQUEST",{message:t.USER_NOT_FOUND});let s=_(o.otpLength,"0-9");return await i.context.internalAdapter.createVerificationValue({value:s,identifier:`forget-password-otp-${r}`,expiresAt:L(o.expiresIn,"sec")}),await e.sendVerificationOTP({email:r,otp:s,type:"forget-password"},i.request),i.json({success:!0})}),resetPasswordEmailOTP:u("/email-otp/reset-password",{method:"POST",body:V.object({email:V.string({description:"Email address to reset the password"}),otp:V.string({description:"OTP sent to the email"}),password:V.string({description:"New password"})}),metadata:{openapi:{description:"Reset password with email OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async i=>{let r=i.body.email,n=await i.context.internalAdapter.findUserByEmail(r,{includeAccounts:!0});if(!n)throw new m("BAD_REQUEST",{message:t.USER_NOT_FOUND});let s=await i.context.internalAdapter.findVerificationValue(`forget-password-otp-${r}`);if(!s)throw new m("BAD_REQUEST",{message:t.INVALID_OTP});if(s.expiresAt<new Date)throw await i.context.internalAdapter.deleteVerificationValue(s.id),new m("BAD_REQUEST",{message:t.OTP_EXPIRED});let a=i.body.otp;if(s.value!==a)throw new m("BAD_REQUEST",{message:t.INVALID_OTP});await i.context.internalAdapter.deleteVerificationValue(s.id);let d=await i.context.password.hash(i.body.password);return n.accounts.find(c=>c.providerId==="credential")?await i.context.internalAdapter.updatePassword(n.user.id,d):await i.context.internalAdapter.createAccount({userId:n.user.id,providerId:"credential",accountId:n.user.id,password:d}),i.json({success:!0})})},hooks:{after:[{matcher(i){return!!(i.path?.startsWith("/sign-up")&&o.sendVerificationOnSignUp)},async handler(i){let r=i.context.returned;if(r instanceof m)return;let n=r&&"email"in r?r.email:r instanceof Response&&r.status===200?i.body.email:null;if(n){let s=_(o.otpLength,"0-9");await i.context.internalAdapter.createVerificationValue({value:s,identifier:`email-verification-otp-${n}`,expiresAt:L(o.expiresIn,"sec")}),await e.sendVerificationOTP({email:n,otp:s,type:"email-verification"},i.request)}}}]},$ERROR_CODES:t}};import{z as kt}from"zod";function St(e){return e==="true"||e===!0}var Hm=e=>({id:"one-tap",endpoints:{oneTapCallback:u("/one-tap/callback",{method:"POST",body:kt.object({idToken:kt.string({description:"Google ID token, which the client obtains from the One Tap API"})}),metadata:{openapi:{summary:"One tap callback",description:"Use this endpoint to authenticate with Google One Tap",responses:{200:{description:"Successful response",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}},400:{description:"Invalid token"}}}}},async o=>{let{idToken:t}=o.body,{data:i,error:r}=await R("https://oauth2.googleapis.com/tokeninfo?id_token="+t);if(r)return o.json({error:"Invalid token"});let n=await o.context.internalAdapter.findUserByEmail(i.email);if(!n){if(e?.disableSignup)throw new m("BAD_GATEWAY",{message:"User not found"});let a=await o.context.internalAdapter.createOAuthUser({email:i.email,emailVerified:St(i.email_verified),name:i.name,image:i.picture},{providerId:"google",accountId:i.sub});if(!a)throw new m("INTERNAL_SERVER_ERROR",{message:"Could not create user"});let d=await o.context.internalAdapter.createSession(a?.user.id,o.request);return await b(o,{user:a.user,session:d}),o.json({session:d,user:a})}let s=await o.context.internalAdapter.createSession(n.user.id,o.request);return await b(o,{user:n.user,session:s}),o.json({token:s.token})})}});import{z as Bo}from"zod";function Sn(){let e=fe.VERCEL_URL,o=fe.NETLIFY_URL,t=fe.RENDER_URL,i=fe.AWS_LAMBDA_FUNCTION_NAME,r=fe.GOOGLE_CLOUD_FUNCTION_NAME,n=fe.AZURE_FUNCTION_NAME;return e||o||t||i||r||n}var Xm=e=>({id:"oauth-proxy",endpoints:{oAuthProxy:u("/oauth-proxy-callback",{method:"GET",query:Bo.object({callbackURL:Bo.string({description:"The URL to redirect to after the proxy"}),cookies:Bo.string({description:"The cookies to set after the proxy"})}),metadata:{openapi:{description:"OAuth Proxy Callback",parameters:[{in:"query",name:"callbackURL",required:!0,description:"The URL to redirect to after the proxy"},{in:"query",name:"cookies",required:!0,description:"The cookies to set after the proxy"}],responses:{302:{description:"Redirect",headers:{Location:{description:"The URL to redirect to",schema:{type:"string"}}}}}}}},async o=>{let t=o.query.cookies,i=await he({key:o.context.secret,data:t});throw o.setHeader("set-cookie",i),o.redirect(o.query.callbackURL)})},hooks:{after:[{matcher(o){return o.path?.startsWith("/callback")},handler:N(async o=>{let t=o.context.returned,i=t instanceof m?t.headers:null,r=i?.get("location");if(r?.includes("/oauth-proxy-callback?callbackURL")){if(!r.startsWith("http"))return;let n=new URL(r);if(n.origin===Ue(o.context.baseURL)){let c=n.searchParams.get("callbackURL");if(!c)return;o.setHeader("location",c);return}let a=i?.get("set-cookie");if(!a)return;let d=await le({key:o.context.secret,data:a}),A=`${r}&cookies=${encodeURIComponent(d)}`;o.setHeader("location",A)}})}],before:[{matcher(o){return o.path?.startsWith("/sign-in/social")},async handler(o){let t=new URL(e?.currentURL||o.request?.url||Sn()||o.context.baseURL);return o.body.callbackURL=`${t.origin}${o.context.options.basePath||"/api/auth"}/oauth-proxy-callback?callbackURL=${encodeURIComponent(o.body.callbackURL||o.context.baseURL)}`,{context:o}}}]}});import{z as Ye}from"zod";var ig=(e,o)=>({id:"custom-session",endpoints:{getSession:u("/get-session",{method:"GET",metadata:{CUSTOM_SESSION:!0},query:Ye.optional(Ye.object({disableCookieCache:Ye.boolean({description:"Disable cookie cache and fetch session from database"}).or(Ye.string().transform(t=>t==="true")).optional(),disableRefresh:Ye.boolean({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}))},async t=>{let i=await v(t);if(!i)return t.json(null);let r=await e(i);return t.json(r)})}});import{ZodObject as Dt,ZodOptional as Fo,ZodSchema as Nt}from"zod";var Fe=e=>{let o=e.plugins?.reduce((d,A)=>{let c=A.schema;if(!c)return d;for(let[p,l]of Object.entries(c))d[p]={fields:{...d[p]?.fields,...l.fields},modelName:l.modelName||p};return d},{}),t=e.rateLimit?.storage==="database",i={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:r,session:n,account:s,...a}=o||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...r?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...n?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...s?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...a,...t?i:{}}};import{z as yg}from"zod";import{Kysely as bg,MssqlDialect as Og}from"kysely";import{MysqlDialect as Eg,PostgresDialect as Rg,SqliteDialect as Ig}from"kysely";var eo={};function Lt(e){switch(e.constructor.name){case"ZodString":return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array";default:return"string"}}function ho(e){let o=[];return e.metadata?.openapi?.parameters?(o.push(...e.metadata.openapi.parameters),o):(e.query instanceof Dt&&Object.entries(e.query.shape).forEach(([t,i])=>{i instanceof Nt&&o.push({name:t,in:"query",schema:{type:Lt(i),..."minLength"in i&&i.minLength?{minLength:i.minLength}:{},description:i.description}})}),o)}function Pt(e){if(e.metadata?.openapi?.requestBody)return e.metadata.openapi.requestBody;if(e.body&&(e.body instanceof Dt||e.body instanceof Fo)){let o=e.body.shape;if(!o)return;let t={},i=[];return Object.entries(o).forEach(([r,n])=>{n instanceof Nt&&(t[r]={type:Lt(n),description:n.description},n instanceof Fo||i.push(r))}),{required:e.body instanceof Fo?!1:!!e.body,content:{"application/json":{schema:{type:"object",properties:t,required:i}}}}}}function yo(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}async function Mo(e,o){let t=ko(e,{...o,plugins:[]}),i=Fe(o),n={schemas:{...Object.entries(i).reduce((a,[d,A])=>{let c=d.charAt(0).toUpperCase()+d.slice(1);return a[c]={type:"object",properties:Object.entries(A.fields).reduce((p,[l,K])=>(p[l]={type:K.type},p),{})},a},{})}};Object.entries(t.api).forEach(([a,d])=>{let A=d.options;if(!A.metadata?.SERVER_ONLY&&(A.method==="GET"&&(eo[d.path]={get:{tags:["Default",...A.metadata?.openapi?.tags||[]],description:A.metadata?.openapi?.description,operationId:A.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:ho(A),responses:yo(A.metadata?.openapi?.responses)}}),A.method==="POST")){let c=Pt(A);eo[d.path]={post:{tags:["Default",...A.metadata?.openapi?.tags||[]],description:A.metadata?.openapi?.description,operationId:A.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:ho(A),...c?{requestBody:c}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:yo(A.metadata?.openapi?.responses)}}}});for(let a of o.plugins||[]){if(a.id==="open-api")continue;let d=ko(e,{...o,plugins:[a]}),A=Object.keys(d.api).map(c=>t.api[c]===void 0?d.api[c]:null).filter(c=>c!==null);Object.entries(A).forEach(([c,p])=>{let l=p.options;l.metadata?.SERVER_ONLY||(l.method==="GET"&&(eo[p.path]={get:{tags:l.metadata?.openapi?.tags||[a.id.charAt(0).toUpperCase()+a.id.slice(1)],description:l.metadata?.openapi?.description,operationId:l.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:ho(l),responses:yo(l.metadata?.openapi?.responses)}}),l.method==="POST"&&(eo[p.path]={post:{tags:l.metadata?.openapi?.tags||[a.id.charAt(0).toUpperCase()+a.id.slice(1)],description:l.metadata?.openapi?.description,operationId:l.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:ho(l),requestBody:Pt(l),responses:yo(l.metadata?.openapi?.responses)}}))})}return{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance"},components:n,security:[{apiKeyCookie:[]}],servers:[{url:e.baseURL}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:eo}}var xt=`<svg width="75" height="75" viewBox="0 0 75 75" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<rect width="75" height="75" fill="url(#pattern0_21_12)"/>
<defs>
<pattern id="pattern0_21_12" patternContentUnits="objectBoundingBox" width="1" height="1">
<use xlink:href="#image0_21_12" transform="scale(0.00094697)"/>
</pattern>
<image id="image0_21_12" width="1056" height="1056" xlink:href="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAASABIAAD/4QBARXhpZgAATU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAEIKADAAQAAAABAAAEIAAAAAD/7QA4UGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAAA4QklNBCUAAAAAABDUHYzZjwCyBOmACZjs+EJ+/+ICKElDQ19QUk9GSUxFAAEBAAACGGFwcGwEAAAAbW50clJHQiBYWVogB+YAAQABAAAAAAAAYWNzcEFQUEwAAAAAQVBQTAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1hcHBs7P2jjjiFR8NttL1PetoYLwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAKZGVzYwAAAPwAAAAwY3BydAAAASwAAABQd3RwdAAAAXwAAAAUclhZWgAAAZAAAAAUZ1hZWgAAAaQAAAAUYlhZWgAAAbgAAAAUclRSQwAAAcwAAAAgY2hhZAAAAewAAAAsYlRSQwAAAcwAAAAgZ1RSQwAAAcwAAAAgbWx1YwAAAAAAAAABAAAADGVuVVMAAAAUAAAAHABEAGkAcwBwAGwAYQB5ACAAUAAzbWx1YwAAAAAAAAABAAAADGVuVVMAAAA0AAAAHABDAG8AcAB5AHIAaQBnAGgAdAAgAEEAcABwAGwAZQAgAEkAbgBjAC4ALAAgADIAMAAyADJYWVogAAAAAAAA9tUAAQAAAADTLFhZWiAAAAAAAACD3wAAPb////+7WFlaIAAAAAAAAEq/AACxNwAACrlYWVogAAAAAAAAKDgAABELAADIuXBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbc2YzMgAAAAAAAQxCAAAF3v//8yYAAAeTAAD9kP//+6L///2jAAAD3AAAwG7/wAARCAQgBCADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9sAQwACAgICAgIDAgIDBAMDAwQFBAQEBAUHBQUFBQUHCAcHBwcHBwgICAgICAgICgoKCgoKCwsLCwsNDQ0NDQ0NDQ0N/9sAQwECAgIDAwMGAwMGDQkHCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0N/90ABABC/9oADAMBAAIRAxEAPwD9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Ln/gq38a/in8Dvgp4T8R/CfxFdeG9SvvFMdlcXFoELyW5srqQxnzEcY3op4Gciv1Gr8Z/+C2X/JvXgj/sc4v/AE33lAH4z/8ADwv9tD/oq2tf9823/wAZo/4eF/tof9FW1r/vm2/+M18Z0UAfZn/Dwv8AbQ/6KtrX/fNt/wDGaP8Ah4X+2h/0VbWv++bb/wCM18Z0UAfZn/Dwv9tD/oq2tf8AfNt/8Zo/4eF/tof9FW1r/vm2/wDjNfGdFAH2Z/w8L/bQ/wCira1/3zbf/GaP+Hhf7aH/AEVbWv8Avm2/+M18Z0UAfZn/AA8L/bQ/6KtrX/fNt/8AGaP+Hhf7aH/RVta/75tv/jNfGdFAH2Z/w8L/AG0P+ira1/3zbf8Axmj/AIeF/tof9FW1r/vm2/8AjNfGdFAH63/sVftq/tTfEb9qb4deCfG3xF1TVtD1bVGgvbKdYBHPGIJW2ttiVsblB4I6V/UbX8Z//BPT/k9D4U/9hpv/AEmmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+M/wD4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAPsz/h4X+2h/0VbWv++bb/4zR/w8L/bQ/wCira1/3zbf/Ga+M6KAPsz/AIeF/tof9FW1r/vm2/8AjNH/AA8L/bQ/6KtrX/fNt/8AGa+M6KAPsz/h4X+2h/0VbWv++bb/AOM0f8PC/wBtD/oq2tf9823/AMZr4zooA+zP+Hhf7aH/AEVbWv8Avm2/+M0f8PC/20P+ira1/wB823/xmvjOigD7M/4eF/tof9FW1r/vm2/+M0f8PC/20P8Aoq2tf9823/xmvjOigD7M/wCHhf7aH/RVta/75tv/AIzR/wAPC/20P+ira1/3zbf/ABmvjOigD7M/4eF/tof9FW1r/vm2/wDjNH/Dwv8AbQ/6KtrX/fNt/wDGa+M6KAPsz/h4X+2h/wBFW1r/AL5tv/jNH/Dwv9tD/oq2tf8AfNt/8Zr4zooA+zP+Hhf7aH/RVta/75tv/jNH/Dwv9tD/AKKtrX/fNt/8Zr4zooA+zP8Ah4X+2h/0VbWv++bb/wCM0f8ADwv9tD/oq2tf9823/wAZr4zooA+zP+Hhf7aH/RVta/75tv8A4zR/w8L/AG0P+ira1/3zbf8AxmvjOigD7M/4eF/tof8ARVta/wC+bb/4zR/w8L/bQ/6KtrX/AHzbf/Ga+M6KAP6tv+CUnxr+Kfxx+CnizxH8WPEV14k1Kx8UyWVvcXYQPHbiytZBGPLRBje7HkZya/Uavxn/AOCJv/JvXjf/ALHOX/032dfsxQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfwq/BT4r638Dvin4d+LHhy0tb7UvDd0bu3t70ObeRzG0eJBGyPjDnowOa/Ub/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH9MlFfzN/8Psv2hf+hI8Gf9+tQ/8Ak2j/AIfZftC/9CR4M/79ah/8m0Af0yUV/M3/AMPsv2hf+hI8Gf8AfrUP/k2j/h9l+0L/ANCR4M/79ah/8m0Af0yUV/M3/wAPsv2hf+hI8Gf9+tQ/+TaP+H2X7Qv/AEJHgz/v1qH/AMm0Af0yUV/M3/w+y/aF/wChI8Gf9+tQ/wDk2j/h9l+0L/0JHgz/AL9ah/8AJtAH4z0V/TJ/w5N/Z6/6Hfxn/wB/dP8A/kKj/hyb+z1/0O/jP/v7p/8A8hUAfzN0V/TJ/wAOTf2ev+h38Z/9/dP/APkKj/hyb+z1/wBDv4z/AO/un/8AyFQB/M3RX9Mn/Dk39nr/AKHfxn/390//AOQqP+HJv7PX/Q7+M/8Av7p//wAhUAfzN0V/TJ/w5N/Z6/6Hfxn/AN/dP/8AkKj/AIcm/s9f9Dv4z/7+6f8A/IVAH8zdFf0yf8OTf2ev+h38Z/8Af3T/AP5Co/4cm/s9f9Dv4z/7+6f/APIVAH8zdFf0yf8ADk39nr/od/Gf/f3T/wD5Co/4cm/s9f8AQ7+M/wDv7p//AMhUAfzN0V/TJ/w5N/Z6/wCh38Z/9/dP/wDkKvwV/ag+FGifA74++M/hP4cu7q+03w3fi0t7i9KG4kQxRyZkMaomcueigYoA8FooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/AOxzl/8ATfZ1+zFfjP8A8ETf+TevG/8A2Ocv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/v8ooooAKKKKACiiigAooooAKKKKACiiigAr+M//goX/wAnofFb/sNL/wCk0Nf2YV/Gf/wUL/5PQ+K3/YaX/wBJoaAPjOiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP7/KKKKACiiigAooooAKKKKACiiigAooooAK/jP/4KF/8AJ6HxW/7DS/8ApNDX9mFfxn/8FC/+T0Pit/2Gl/8ASaGgD4zooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+/yiiigAooooAKKKKACiiigAooooAKKKKACv4z/+Chf/ACeh8Vv+w0v/AKTQ1/ZhX8Z//BQv/k9D4rf9hpf/AEmhoA+M6KKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD1L4KfCjW/jj8U/Dvwn8OXdrY6l4kujaW9xelxbxuI2kzIY1d8YQ9FJzX6jf8OTf2hf8Aod/Bn/f3UP8A5Cr4z/4J6f8AJ6Hwp/7DTf8ApNNX9mFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH8zf8Aw5N/aF/6HfwZ/wB/dQ/+QqP+HJv7Qv8A0O/gz/v7qH/yFX9MlFAH8zf/AA5N/aF/6HfwZ/391D/5Co/4cm/tC/8AQ7+DP+/uof8AyFX9MlFAH8zf/Dk39oX/AKHfwZ/391D/AOQqP+HJv7Qv/Q7+DP8Av7qH/wAhV/TJRQB/M3/w5N/aF/6HfwZ/391D/wCQqP8Ahyb+0L/0O/gz/v7qH/yFX9MlFAH4z/8AD7L9nr/oSPGf/frT/wD5No/4fZfs9f8AQkeM/wDv1p//AMm1/M3RQB/TJ/w+y/Z6/wChI8Z/9+tP/wDk2j/h9l+z1/0JHjP/AL9af/8AJtfzN0UAf0yf8Psv2ev+hI8Z/wDfrT//AJNo/wCH2X7PX/QkeM/+/Wn/APybX8zdFAH9Mn/D7L9nr/oSPGf/AH60/wD+TaP+H2X7PX/QkeM/+/Wn/wDybX8zdFAH9Mn/AA+y/Z6/6Ejxn/360/8A+TaP+H2X7PX/AEJHjP8A79af/wDJtfzN0UAf0yf8Psv2ev8AoSPGf/frT/8A5No/4fZfs9f9CR4z/wC/Wn//ACbX8zdFAH9Mn/D7L9nr/oSPGf8A360//wCTa/BX9qD4r6J8cfj74z+LHhy0urHTfEl+Lu3t70ILiNBFHHiQRs6Zyh6MRivBaKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/ACb143/7HOX/ANN9nX7MV+M//BE3/k3rxv8A9jnL/wCm+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+M/wDwWy/5N68Ef9jnF/6b7ygD+ZuiiigAooooAKKKKACiiigAooooAKKKKAPsz/gnp/yeh8Kf+w03/pNNX9mFfxn/APBPT/k9D4U/9hpv/Saav7MKACiiigAooooAKKKKACiiigAooooAKKKKAP4A6KKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP6ZP+CJv/JvXjf/ALHOX/032dfsxX4z/wDBE3/k3rxv/wBjnL/6b7Ov2YoAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAr8Z/+C2X/JvXgj/sc4v/AE33lfsxX4z/APBbL/k3rwR/2OcX/pvvKAP5m6KKKACiiigAooooAKKKKACiiigAooooA+zP+Cen/J6Hwp/7DTf+k01f2YV/Gf8A8E9P+T0PhT/2Gm/9Jpq/swoAKKKKACiiigAooooAKKKKACiiigAooooA/gDooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/pk/4Im/8m9eN/8Asc5f/TfZ1+zFfjP/AMETf+TevG//AGOcv/pvs6/ZigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACvxn/4LZf8m9eCP+xzi/8ATfeV+zFfjP8A8Fsv+TevBH/Y5xf+m+8oA/mbooooAKKKKACiiigAooooAKKKKACiiigD7M/4J6f8nofCn/sNN/6TTV/ZhX8Z/wDwT0/5PQ+FP/Yab/0mmr+zCgAooooAKKKKACiiigAooooAKKKKACiiigD+AOiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD+mT/gib/yb143/wCxzl/9N9nX7MV+M/8AwRN/5N68b/8AY5y/+m+zr9mKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/0f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAK/Gf/gtl/yb14I/7HOL/wBN95X7MV+XP/BVv4KfFP44/BTwn4c+E/h268SalY+KY724t7QoHjtxZXUZkPmOgxvdRwc5NAH8pNFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAfGdFfZn/DvT9tD/AKJTrX/fVt/8eo/4d6ftof8ARKda/wC+rb/49QB8Z0V9mf8ADvT9tD/olOtf99W3/wAeo/4d6ftof9Ep1r/vq2/+PUAfGdFfZn/DvT9tD/olOtf99W3/AMeo/wCHen7aH/RKda/76tv/AI9QB8Z0V9mf8O9P20P+iU61/wB9W3/x6j/h3p+2h/0SnWv++rb/AOPUAH/BPT/k9D4U/wDYab/0mmr+zCv5cv2Kv2Kv2pvhz+1N8OvG3jb4dappOh6TqjT3t7O0BjgjMEq7m2ys2NzAcA9a/qNoAKKKKACiiigAooooAKKKKACiiigAooooA/gDor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD4zor7M/4d6ftof9Ep1r/vq2/wDj1H/DvT9tD/olOtf99W3/AMeoA+M6K+zP+Hen7aH/AESnWv8Avq2/+PUf8O9P20P+iU61/wB9W3/x6gD4zor7M/4d6ftof9Ep1r/vq2/+PUf8O9P20P8AolOtf99W3/x6gD4zor7M/wCHen7aH/RKda/76tv/AI9R/wAO9P20P+iU61/31bf/AB6gD9mP+CJv/JvXjf8A7HOX/wBN9nX7MV+XP/BKT4KfFP4HfBTxZ4c+LHh268N6lfeKZL23t7soXktzZWsYkHlu4xvRhyc5FfqNQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAf/9L9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//T/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9X9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//W/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9D9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//R/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9P9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//U/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1f38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9b9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//X/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0P38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9H9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//S/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/0/38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9T9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//V/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/1v38ooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/9f9/KKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//Q/fyiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKAP/2Q=="/>
</defs>
</svg>
`;var Dn=e=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(e)}
    </script>
	 <script>
      var configuration = {
	  	favicon: "data:image/svg+xml;utf8,${encodeURIComponent(xt)}",
	   	theme: "saturn",
        metaData: {
			title: "Better Auth API",
			description: "API Reference for your Better Auth Instance",
		}
      }

      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`,Tf=e=>{let o=e?.path??"/reference";return{id:"open-api",endpoints:{generateOpenAPISchema:u("/open-api/generate-schema",{method:"GET"},async t=>{let i=await Mo(t.context,t.context.options);return t.json(i)}),openAPIReference:u(o,{method:"GET",metadata:{isAction:!1}},async t=>{if(e?.disableDefaultReference)throw new m("NOT_FOUND");let i=await Mo(t.context,t.context.options);return new Response(Dn(i),{headers:{"Content-Type":"text/html"}})})}}};import{SignJWT as Nn}from"jose";import{z as ie}from"zod";import{subtle as Ln}from"@better-auth/utils";var jt={oauthApplication:{modelName:"oauthApplication",fields:{name:{type:"string"},icon:{type:"string",required:!1},metadata:{type:"string",required:!1},clientId:{type:"string",unique:!0},clientSecret:{type:"string"},redirectURLs:{type:"string"},type:{type:"string"},disabled:{type:"boolean",required:!1,defaultValue:!1},userId:{type:"string",required:!1},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthAccessToken:{modelName:"oauthAccessToken",fields:{accessToken:{type:"string",unique:!0},refreshToken:{type:"string",unique:!0},accessTokenExpiresAt:{type:"date"},refreshTokenExpiresAt:{type:"date"},clientId:{type:"string"},userId:{type:"string",required:!1},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"}}},oauthConsent:{modelName:"oauthConsent",fields:{clientId:{type:"string"},userId:{type:"string"},scopes:{type:"string"},createdAt:{type:"date"},updatedAt:{type:"date"},consentGiven:{type:"boolean"}}}};import{APIError as Vo}from"better-call";function oo(e,o,t){return`${e.includes("?")?"&":"?"}error=${o}&error_description=${t}`}async function qo(e,o){let t={codeExpiresIn:600,defaultScope:"openid",...o,scopes:["openid","profile","email","offline_access",...o?.scopes||[]]};if(!e.request)throw new Vo("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});let i=await v(e);if(!i){await e.setSignedCookie("oidc_login_prompt",JSON.stringify(e.query),e.context.secret,{maxAge:600});let h=e.request.url?.split("?")[1];throw e.redirect(`${o.loginPage}?${h}`)}let r=e.query;if(!r.client_id)throw e.redirect(`${e.context.baseURL}/error?error=invalid_client`);if(!r.response_type)throw e.redirect(oo(`${e.context.baseURL}/error`,"invalid_request","response_type is required"));let n=await e.context.adapter.findOne({model:"oauthApplication",where:[{field:"clientId",value:e.query.client_id}]}).then(h=>h?{...h,redirectURLs:h.redirectURLs.split(","),metadata:h.metadata?JSON.parse(h.metadata):{}}:null);if(!n)throw e.redirect(`${e.context.baseURL}/error?error=invalid_client`);let s=n.redirectURLs.find(h=>h===e.query.redirect_uri);if(!s||!r.redirect_uri)throw new Vo("BAD_REQUEST",{message:"Invalid redirect URI"});if(n.disabled)throw e.redirect(`${e.context.baseURL}/error?error=client_disabled`);if(r.response_type!=="code")throw e.redirect(`${e.context.baseURL}/error?error=unsupported_response_type`);let a=r.scope?.split(" ").filter(h=>h)||t.defaultScope.split(" "),d=a.filter(h=>!t.scopes.includes(h)||h==="offline_access"&&r.prompt!=="consent");if(d.length)throw e.redirect(oo(r.redirect_uri,"invalid_scope",`The following scopes are invalid: ${d.join(", ")}`));if((!r.code_challenge||!r.code_challenge_method)&&o.requirePKCE)throw e.redirect(oo(r.redirect_uri,"invalid_request","pkce is required"));if(!["s256",o.allowPlainCodeChallengeMethod?"plain":"s256"].includes(r.code_challenge_method?.toLowerCase()||""))throw e.redirect(oo(r.redirect_uri,"invalid_request","invalid code_challenge method"));let A=_(32,"a-z","A-Z","0-9"),c=t.codeExpiresIn*1e3,p=new Date(Date.now()+c);try{await e.context.internalAdapter.createVerificationValue({value:JSON.stringify({clientId:n.clientId,redirectURI:r.redirect_uri,scope:a,userId:i.user.id,authTime:i.session.createdAt.getTime(),requireConsent:r.prompt==="consent",state:r.prompt==="consent"?r.state:null,codeChallenge:r.code_challenge,codeChallengeMethod:r.code_challenge_method}),identifier:A,expiresAt:p})}catch{throw e.redirect(oo(r.redirect_uri,"server_error","An error occurred while processing the request"))}let l=new URL(s);if(l.searchParams.set("code",A),l.searchParams.set("state",e.query.state),r.prompt!=="consent"||await e.context.adapter.findOne({model:"oauthConsent",where:[{field:"clientId",value:n.clientId},{field:"userId",value:i.user.id}]}).then(h=>!!h?.consentGiven))throw e.redirect(l.toString());if(o?.consentPage){await e.setSignedCookie("oidc_consent_prompt",A,e.context.secret,{maxAge:600});let h=`${o.consentPage}?client_id=${n.clientId}&scope=${a.join(" ")}`;throw e.redirect(h)}let y=o?.getConsentHTML;if(!y)throw new Vo("INTERNAL_SERVER_ERROR",{message:"No consent page provided"});return new Response(y({scopes:a,clientMetadata:n.metadata,clientIcon:n?.icon,clientId:n.clientId,clientName:n.name,code:A}),{headers:{"content-type":"text/html"}})}import{createHash as xn}from"@better-auth/utils/hash";var jn=(e,o)=>{let t=e.context.options.baseURL,i=e.context.baseURL;return{issuer:t,authorization_endpoint:`${i}/oauth2/authorize`,token_endpoint:`${i}/oauth2/token`,userInfo_endpoint:`${i}/oauth2/userinfo`,jwks_uri:`${i}/jwks`,registration_endpoint:`${i}/oauth2/register`,scopes_supported:["openid","profile","email","offline_access"],response_types_supported:["code"],response_modes_supported:["query"],grant_types_supported:["authorization_code"],acr_values_supported:["urn:mace:incommon:iap:silver","urn:mace:incommon:iap:bronze"],subject_types_supported:["public"],id_token_signing_alg_values_supported:["RS256","none"],token_endpoint_auth_methods_supported:["client_secret_basic","client_secret_post"],claims_supported:["sub","iss","aud","exp","nbf","iat","jti","email","email_verified","name"],...o?.metadata}},Vf=e=>{let o={oauthClient:"oauthApplication",oauthAccessToken:"oauthAccessToken",oauthConsent:"oauthConsent"},t={codeExpiresIn:600,defaultScope:"openid",accessTokenExpiresIn:3600,refreshTokenExpiresIn:604800,...e,scopes:["openid","profile","email","offline_access",...e?.scopes||[]]};return{id:"oidc",hooks:{after:[{matcher(){return!0},handler:async i=>{let r=await i.getSignedCookie("oidc_login_prompt",i.context.secret),n=i.context.authCookies.sessionToken.name,s=Oe(i.responseHeader.get("set-cookie")||""),a=s.has(n);if(!r||!a)return;i.setCookie("oidc_login_prompt","",{maxAge:0});let A=s.get(n)?.value?.split(".")[0];if(!A)return;let c=await i.context.internalAdapter.findSession(A);return c?(i.query=JSON.parse(r),i.query.prompt="consent",i.context.session=c,await qo(i,t)):void 0}}]},endpoints:{getOpenIdConfig:u("/.well-known/openid-configuration",{method:"GET"},async i=>jn(i,e)),oAuth2authorize:u("/oauth2/authorize",{method:"GET",query:ie.record(ie.string(),ie.any())},async i=>qo(i,t)),oAuthConsent:u("/oauth2/consent",{method:"POST",body:ie.object({accept:ie.boolean()}),use:[I]},async i=>{let r=await i.getSignedCookie("oidc_consent_prompt",i.context.secret);if(!r)throw new m("UNAUTHORIZED",{error_description:"No consent prompt found",error:"invalid_grant"});let n=await i.context.internalAdapter.findVerificationValue(r);if(!n)throw new m("UNAUTHORIZED",{error_description:"Invalid code",error:"invalid_grant"});if(n.expiresAt<new Date)throw await i.context.internalAdapter.deleteVerificationValue(n.id),new m("UNAUTHORIZED",{error_description:"Code expired",error:"invalid_grant"});let s=JSON.parse(n.value);if(!s.requireConsent||!s.state)throw new m("UNAUTHORIZED",{error_description:"Consent not required",error:"invalid_grant"});if(!i.body.accept)return await i.context.internalAdapter.deleteVerificationValue(n.id),i.json({redirectURI:`${s.redirectURI}?error=access_denied&error_description=User denied access`});let a=_(32,"a-z","A-Z","0-9"),d=t.codeExpiresIn*1e3,A=new Date(Date.now()+d);await i.context.internalAdapter.updateVerificationValue(n.id,{value:JSON.stringify({...s,requireConsent:!1}),identifier:a,expiresAt:A}),await i.context.adapter.create({model:o.oauthConsent,data:{clientId:s.clientId,userId:s.userId,scopes:s.scope.join(" "),consentGiven:!0,createdAt:new Date,updatedAt:new Date}});let c=new URL(s.redirectURI);return c.searchParams.set("code",a),c.searchParams.set("state",s.state),i.json({redirectURI:c.toString()})}),oAuth2token:u("/oauth2/token",{method:"POST",body:ie.any(),metadata:{isAction:!1}},async i=>{let{body:r}=i;if(!r)throw new m("BAD_REQUEST",{error_description:"request body not found",error:"invalid_request"});if(r instanceof FormData&&(r=Object.fromEntries(r.entries())),!(r instanceof Object))throw new m("BAD_REQUEST",{error_description:"request body is not an object",error:"invalid_request"});let{client_id:n,client_secret:s,grant_type:a,code:d,redirect_uri:A,refresh_token:c,code_verifier:p}=r;if(a==="refresh_token"){if(!c)throw new m("BAD_REQUEST",{error_description:"refresh_token is required",error:"invalid_request"});let P=await i.context.adapter.findOne({model:o.oauthAccessToken,where:[{field:"refreshToken",value:c.toString()}]});if(!P)throw new m("UNAUTHORIZED",{error_description:"invalid refresh token",error:"invalid_grant"});if(P.clientId!==n?.toString())throw new m("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(P.refreshTokenExpiresAt<new Date)throw new m("UNAUTHORIZED",{error_description:"refresh token expired",error:"invalid_grant"});let Z=_(32,"a-z","A-Z"),te=_(32,"a-z","A-Z"),se=new Date(Date.now()+t.accessTokenExpiresIn*1e3),Ho=new Date(Date.now()+t.refreshTokenExpiresIn*1e3);return await i.context.adapter.create({model:o.oauthAccessToken,data:{accessToken:Z,refreshToken:te,accessTokenExpiresAt:se,refreshTokenExpiresAt:Ho,clientId:n.toString(),userId:P.userId,scopes:P.scopes,createdAt:new Date,updatedAt:new Date}}),i.json({access_token:Z,token_type:"bearer",expires_in:t.accessTokenExpiresIn,refresh_token:te,scope:P.scopes})}if(!d)throw new m("BAD_REQUEST",{error_description:"code is required",error:"invalid_request"});if(e.requirePKCE&&!p)throw new m("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});let l=await i.context.internalAdapter.findVerificationValue(d.toString());if(!l)throw new m("UNAUTHORIZED",{error_description:"invalid code",error:"invalid_grant"});if(l.expiresAt<new Date)throw await i.context.internalAdapter.deleteVerificationValue(l.id),new m("UNAUTHORIZED",{error_description:"code expired",error:"invalid_grant"});if(await i.context.internalAdapter.deleteVerificationValue(l.id),!n||!s)throw new m("UNAUTHORIZED",{error_description:"client_id and client_secret are required",error:"invalid_client"});if(!a)throw new m("BAD_REQUEST",{error_description:"grant_type is required",error:"invalid_request"});if(a!=="authorization_code")throw new m("BAD_REQUEST",{error_description:"grant_type must be 'authorization_code'",error:"unsupported_grant_type"});if(!A)throw new m("BAD_REQUEST",{error_description:"redirect_uri is required",error:"invalid_request"});let K=await i.context.adapter.findOne({model:o.oauthClient,where:[{field:"clientId",value:n.toString()}]}).then(P=>P?{...P,redirectURLs:P.redirectURLs.split(","),metadata:P.metadata?JSON.parse(P.metadata):{}}:null);if(!K)throw new m("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(K.disabled)throw new m("UNAUTHORIZED",{error_description:"client is disabled",error:"invalid_client"});if(!(K.clientSecret===s.toString()))throw new m("UNAUTHORIZED",{error_description:"invalid client_secret",error:"invalid_client"});let h=JSON.parse(l.value);if(h.clientId!==n.toString())throw new m("UNAUTHORIZED",{error_description:"invalid client_id",error:"invalid_client"});if(h.redirectURI!==A.toString())throw new m("UNAUTHORIZED",{error_description:"invalid redirect_uri",error:"invalid_client"});if(h.codeChallenge&&!p)throw new m("BAD_REQUEST",{error_description:"code verifier is missing",error:"invalid_request"});if((h.codeChallengeMethod==="plain"?p:await xn("SHA-256","base64urlnopad").digest(p))!==h.codeChallenge)throw new m("UNAUTHORIZED",{error_description:"code verification failed",error:"invalid_request"});let j=h.scope;await i.context.internalAdapter.deleteVerificationValue(d.toString());let z=_(32,"a-z","A-Z"),g=_(32,"A-Z","a-z"),w=new Date(Date.now()+t.accessTokenExpiresIn*1e3),S=new Date(Date.now()+t.refreshTokenExpiresIn*1e3);await i.context.adapter.create({model:o.oauthAccessToken,data:{accessToken:z,refreshToken:g,accessTokenExpiresAt:w,refreshTokenExpiresAt:S,clientId:n.toString(),userId:h.userId,scopes:j.join(" "),createdAt:new Date,updatedAt:new Date}});let C=await i.context.internalAdapter.findUserById(h.userId);if(!C)throw new m("UNAUTHORIZED",{error_description:"user not found",error:"invalid_grant"});let Te={alg:"HS256",key:await Ln.generateKey({name:"HMAC",hash:"SHA-256"},!0,["sign","verify"])},wo={given_name:C.name.split(" ")[0],family_name:C.name.split(" ")[1],name:C.name,profile:C.image,updated_at:C.updatedAt.toISOString()},io={email:C.email,email_verified:C.emailVerified},Me={...j.includes("profile")?wo:{},...j.includes("email")?io:{}},Co=await new Nn({sub:C.id,aud:n.toString(),iat:Date.now(),auth_time:i.context.session?.session.createdAt.getTime(),nonce:r.nonce,acr:"urn:mace:incommon:iap:silver",...Me}).setProtectedHeader({alg:Te.alg}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+t.accessTokenExpiresIn).sign(Te.key);return i.json({access_token:z,token_type:"Bearer",expires_in:t.accessTokenExpiresIn,refresh_token:j.includes("offline_access")?g:void 0,scope:j.join(" "),id_token:j.includes("openid")?Co:void 0},{headers:{"Cache-Control":"no-store",Pragma:"no-cache"}})}),oAuth2userInfo:u("/oauth2/userinfo",{method:"GET",metadata:{isAction:!1}},async i=>{if(!i.request)throw new m("UNAUTHORIZED",{error_description:"request not found",error:"invalid_request"});let r=i.request.headers.get("authorization");if(!r)throw new m("UNAUTHORIZED",{error_description:"authorization header not found",error:"invalid_request"});let n=r.replace("Bearer ",""),s=await i.context.adapter.findOne({model:o.oauthAccessToken,where:[{field:"accessToken",value:n}]});if(!s)throw new m("UNAUTHORIZED",{error_description:"invalid access token",error:"invalid_token"});if(s.accessTokenExpiresAt<new Date)throw new m("UNAUTHORIZED",{error_description:"The Access Token expired",error:"invalid_token"});let a=await i.context.internalAdapter.findUserById(s.userId);if(!a)throw new m("UNAUTHORIZED",{error_description:"user not found",error:"invalid_token"});let d=s.scopes.split(" "),A={email:d.includes("email")?a.email:void 0,name:d.includes("profile")?a.name:void 0,picture:d.includes("profile")?a.image:void 0,given_name:d.includes("profile")?a.name.split(" ")[0]:void 0,family_name:d.includes("profile")?a.name.split(" ")[1]:void 0,email_verified:d.includes("email")?a.emailVerified:void 0};return i.json(A)}),registerOAuthApplication:u("/oauth2/register",{method:"POST",body:ie.object({name:ie.string(),icon:ie.string().optional(),metadata:ie.record(ie.any()).optional(),redirectURLs:ie.array(ie.string())})},async i=>{let r=i.body,n=await v(i);if(!n&&!e.allowDynamicClientRegistration)throw new m("UNAUTHORIZED",{message:"Unauthorized"});let s=e.generateClientId?.()||_(32,"a-z","A-Z"),a=e.generateClientSecret?.()||_(32,"a-z","A-Z"),d=await i.context.adapter.create({model:o.oauthClient,data:{name:r.name,icon:r.icon,metadata:r.metadata?JSON.stringify(r.metadata):null,clientId:s,clientSecret:a,redirectURLs:r.redirectURLs.join(","),type:"web",authenticationScheme:"client_secret",disabled:!1,userId:n?.session.userId,createdAt:new Date,updatedAt:new Date}});return i.json({...d,redirectURLs:d.redirectURLs.split(","),metadata:d.metadata?JSON.parse(d.metadata):null})}),getOAuthClient:u("/oauth2/client/:id",{method:"GET",use:[I]},async i=>{let r=await i.context.adapter.findOne({model:o.oauthClient,where:[{field:"clientId",value:i.params.id}]});if(!r)throw new m("NOT_FOUND",{error_description:"client not found",error:"not_found"});return i.json({clientId:r.clientId,name:r.name,icon:r.icon})})},schema:jt}};export{ke as HIDE_METADATA,im as admin,MK as anonymous,fK as bearer,u as createAuthEndpoint,N as createAuthMiddleware,ig as customSession,xm as emailOTP,pm as genericOAuth,Em as jwt,EK as magicLink,Um as multiSession,Xm as oAuthProxy,Vf as oidcProvider,Hm as oneTap,Tf as openAPI,Zo as optionsMiddleware,Vl as organization,LK as phoneNumber,oK as twoFactor,Lp as twoFactorClient,Rt as username};
