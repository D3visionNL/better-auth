"use strict";var z=Object.defineProperty;var Le=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Ee=Object.prototype.hasOwnProperty;var Se=(e,t)=>{for(var r in t)z(e,r,{get:t[r],enumerable:!0})},ze=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ie(t))!Ee.call(e,o)&&o!==r&&z(e,o,{get:()=>t[o],enumerable:!(i=Le(t,o))||i.enumerable});return e};var $e=e=>ze(z({},"__esModule",{value:!0}),e);var Ut={};Se(Ut,{SocialProviderListEnum:()=>Pt,apple:()=>C,discord:()=>B,dropbox:()=>q,facebook:()=>j,getApplePublicKey:()=>me,github:()=>D,gitlab:()=>K,google:()=>N,linkedin:()=>W,microsoft:()=>M,reddit:()=>Q,roblox:()=>X,socialProviderList:()=>_e,socialProviders:()=>ve,spotify:()=>G,twitch:()=>H,twitter:()=>F});module.exports=$e(Ut);var Ce=Object.defineProperty,Be=Object.defineProperties,je=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,De=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable,te=(e,t,r)=>t in e?Ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,U=(e,t)=>{for(var r in t||(t={}))De.call(t,r)&&te(e,r,t[r]);if(ee)for(var r of ee(t))Ve.call(t,r)&&te(e,r,t[r]);return e},R=(e,t)=>Be(e,je(t)),Ne=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},Me=async(e,t)=>{var r,i,o,a,n,c;let l=t||{},s={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:l,hooks:s};for(let p of t?.plugins||[]){if(p.init){let g=await((r=p.init)==null?void 0:r.call(p,e.toString(),t));l=g.options||l,e=g.url}s.onRequest.push((i=p.hooks)==null?void 0:i.onRequest),s.onResponse.push((o=p.hooks)==null?void 0:o.onResponse),s.onSuccess.push((a=p.hooks)==null?void 0:a.onSuccess),s.onError.push((n=p.hooks)==null?void 0:n.onError),s.onRetry.push((c=p.hooks)==null?void 0:c.onRetry)}return{url:e,options:l,hooks:s}},re=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},Ge=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function He(e){if(typeof e=="number")return new re({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new re(e);case"exponential":return new Ge(e);default:throw new Error("Invalid retry strategy")}}var Fe=e=>{let t={},r=i=>typeof i=="function"?i():i;if(e?.auth){if(e.auth.type==="Bearer"){let i=r(e.auth.token);if(!i)return t;t.authorization=`Bearer ${i}`}else if(e.auth.type==="Basic"){let i=r(e.auth.username),o=r(e.auth.password);if(!i||!o)return t;t.authorization=`Basic ${btoa(`${i}:${o}`)}`}else if(e.auth.type==="Custom"){let i=r(e.auth.value);if(!i)return t;t.authorization=`${r(e.auth.prefix)} ${i}`}}return t},ne=["get","post","put","patch","delete"];var qe=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function We(e){let t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";let i=t.split(";").shift()||"";return qe.test(i)?"json":r.has(i)||i.startsWith("text/")?"text":"blob"}function Je(e){try{return JSON.parse(e),!0}catch{return!1}}function ae(e){if(e===void 0)return!1;let t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function ie(e){try{return JSON.parse(e)}catch{return e}}function oe(e){return typeof e=="function"}function Ke(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&oe(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&oe(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}function Qe(e){let t=new Headers(e?.headers),r=Fe(e);for(let[i,o]of Object.entries(r||{}))t.set(i,o);if(!t.has("content-type")){let i=Xe(e?.body);i&&t.set("content-type",i)}return t}function Xe(e){return ae(e)?"application/json":null}function Ze(e){if(!e?.body)return null;let t=new Headers(e?.headers);return ae(e.body)&&!t.has("content-type")?JSON.stringify(e.body):e.body}function Ye(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){let i=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return ne.includes(i)?i.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function et(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}function tt(e,t){let{baseURL:r,params:i,query:o}=t||{query:{},params:{},baseURL:""},a=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r;if(!a)throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);if(e.startsWith("@")){let g=e.toString().split("@")[1].split("/")[0];ne.includes(g)&&(e=e.replace(`@${g}/`,"/"))}a.endsWith("/")||(a+="/");let[n,c]=e.replace(a,"").split("?"),l=new URLSearchParams(c);for(let[g,h]of Object.entries(o||{}))l.set(g,String(h));if(i)if(Array.isArray(i)){let g=n.split("/").filter(h=>h.startsWith(":"));for(let[h,E]of g.entries()){let O=i[h];n=n.replace(E,O)}}else for(let[g,h]of Object.entries(i))n=n.replace(`:${g}`,String(h));n=n.split("/").map(encodeURIComponent).join("/"),n.startsWith("/")&&(n=n.slice(1));let s=l.size>0?`?${l}`.replace(/\+/g,"%20"):"";return new URL(`${n}${s}`,a)}var u=async(e,t)=>{var r,i,o,a,n,c,l,s;let{hooks:p,url:g,options:h}=await Me(e,t),E=Ke(h),O=new AbortController,xe=(r=h.signal)!=null?r:O.signal,we=tt(g,h),Pe=Ze(h),Ue=Qe(h),Re=Ye(g,h),y=R(U({},h),{url:we,headers:Ue,body:Pe,method:Re,signal:xe});for(let v of p.onRequest)if(v){let b=await v(y);b instanceof Object&&(y=b)}("pipeTo"in y&&typeof y.pipeTo=="function"||typeof((i=t?.body)==null?void 0:i.pipe)=="function")&&("duplex"in y||(y.duplex="half"));let{clearTimeout:Ae}=et(h,O),f=await E(y.url,y);Ae();let Z={response:f,request:y};for(let v of p.onResponse)if(v){let b=await v(R(U({},Z),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?f.clone():f}));b instanceof Response?f=b:b instanceof Object&&(f=b.response)}if(f.ok){if(!(y.method!=="HEAD"))return{data:"",error:null};let b=We(f),x={data:"",response:f,request:y};if(b==="json"||b==="text"){let w=await f.text(),Oe=await((a=y.jsonParser)!=null?a:ie)(w);x.data=Oe}else x.data=await f[b]();y?.output&&y.output&&!y.disableValidation&&(x.data=y.output.parse(x.data));for(let w of p.onSuccess)w&&await w(R(U({},x),{response:(n=t?.hookOptions)!=null&&n.cloneResponse?f.clone():f}));return t?.throw?x.data:{data:x.data,error:null}}let Te=(c=t?.jsonParser)!=null?c:ie,Y=await f.text(),S=Je(Y)?await Te(Y):{},ke={response:f,request:y,error:R(U({},S),{status:f.status,statusText:f.statusText})};for(let v of p.onError)v&&await v(R(U({},ke),{response:(l=t?.hookOptions)!=null&&l.cloneResponse?f.clone():f}));if(t?.retry){let v=He(t.retry),b=(s=t.retryAttempt)!=null?s:0;if(await v.shouldAttemptRetry(b,f)){for(let w of p.onRetry)w&&await w(Z);let x=v.getDelay(b);return await new Promise(w=>setTimeout(w,x)),await u(e,R(U({},t),{retryAttempt:b+1}))}}if(t?.throw)throw new Ne(f.status,f.statusText,S);return{data:null,error:R(U({},S),{status:f.status,statusText:f.statusText})}};var fe=require("better-call"),P=require("jose");var se=(e,t="ms")=>new Date(Date.now()+(t==="sec"?e*1e3:e));var ce=require("@better-auth/utils/hash"),le=require("@better-auth/utils/base64");async function ue(e){let t=await(0,ce.createHash)("SHA-256").digest(e);return le.base64Url.encode(new Uint8Array(t),{padding:!1})}function L(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?se(e.expires_in,"sec"):void 0,scopes:e?.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token}}async function m({id:e,options:t,authorizationEndpoint:r,state:i,codeVerifier:o,scopes:a,claims:n,redirectURI:c,duration:l}){let s=new URL(r);if(s.searchParams.set("response_type","code"),s.searchParams.set("client_id",t.clientId),s.searchParams.set("state",i),s.searchParams.set("scope",a.join(" ")),s.searchParams.set("redirect_uri",t.redirectURI||c),o){let p=await ue(o);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",p)}if(n){let p=n.reduce((g,h)=>(g[h]=null,g),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...p}}))}return l&&s.searchParams.set("duration",l),s}var rt=require("jose");async function d({code:e,codeVerifier:t,redirectURI:r,options:i,tokenEndpoint:o,authentication:a}){let n=new URLSearchParams,c={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth"};if(n.set("grant_type","authorization_code"),n.set("code",e),t&&n.set("code_verifier",t),n.set("redirect_uri",r),a==="basic"){let g=btoa(`${i.clientId}:${i.clientSecret}`);c.authorization=`Basic ${g}`}else n.set("client_id",i.clientId),n.set("client_secret",i.clientSecret);let{data:l,error:s}=await u(o,{method:"POST",body:n,headers:c});if(s)throw s;return L(l)}var gt=require("zod"),ht=require("better-call");var I=Object.create(null),k=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?I:globalThis),de=new Proxy(I,{get(e,t){return k()[t]??I[t]},has(e,t){let r=k();return t in r||t in I},set(e,t,r){let i=k(!0);return i[t]=r,!0},deleteProperty(e,t){if(!t)return!1;let r=k(!0);return delete r[t],!0},ownKeys(){let e=k(!0);return Object.keys(e)}});function it(e){return e?e!=="false":!1}var ot=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var Dt=ot==="test"||it(de.TEST);var A=class extends Error{constructor(t,r){super(t),this.name="BetterAuthError",this.message=t,this.cause=r,this.stack=""}};var pt=require("@better-auth/utils/hash"),ft=require("@noble/ciphers/chacha"),$=require("@noble/ciphers/utils"),mt=require("@noble/ciphers/webcrypto");var at=require("@better-auth/utils/hash");var st=require("jose");var ct=require("@noble/hashes/scrypt"),lt=require("uncrypto"),ut=require("@better-auth/utils/hex");var pe=require("@better-auth/utils/random"),dt=(0,pe.createRandomStringGenerator)("a-z","0-9","A-Z","-_");var C=e=>{let t="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",createAuthorizationURL({state:r,scopes:i,redirectURI:o}){let a=i||["email","name"];return e.scope&&a.push(...e.scope),new URL(`https://appleid.apple.com/auth/authorize?client_id=${e.clientId}&response_type=code&redirect_uri=${e.redirectURI||o}&scope=${a.join(" ")}&state=${r}&response_mode=form_post`)},validateAuthorizationCode:async({code:r,codeVerifier:i,redirectURI:o})=>d({code:r,codeVerifier:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:t}),async verifyIdToken(r,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(r,i);let o=(0,P.decodeProtectedHeader)(r),{kid:a,alg:n}=o;if(!a||!n)return!1;let c=await me(a),{payload:l}=await(0,P.jwtVerify)(r,c,{algorithms:[n],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(s=>{l[s]!==void 0&&(l[s]=!!l[s])}),i&&l.nonce!==i?!1:!!l},async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;let i=(0,P.decodeJwt)(r.idToken);if(!i)return null;let o=i.user?`${i.user.name.firstName} ${i.user.name.lastName}`:i.email,a=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:o,emailVerified:!1,email:i.email,...a},data:i}}}},me=async e=>{let t="https://appleid.apple.com",r="/auth/keys",{data:i}=await u(`${t}${r}`);if(!i?.keys)throw new fe.APIError("BAD_REQUEST",{message:"Keys not found"});let o=i.keys.find(a=>a.kid===e);if(!o)throw new Error(`JWK with kid ${e} not found`);return await(0,P.importJWK)(o,o.alg)};var B=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["identify","email"];return e.scope&&o.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||i)}&state=${t}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>d({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(i)return null;if(r.avatar===null){let a=r.discriminator==="0"?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5;r.image_url=`https://cdn.discordapp.com/embed/avatars/${a}.png`}else{let a=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${a}`}let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...o},data:r}}});var j=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["email","public_profile"];return e.scope&&o.push(...e.scope),await m({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:o,state:t,redirectURI:i})},validateAuthorizationCode:async({code:t,redirectURI:r})=>d({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://graph.facebook.com/me?fields=id,name,email,picture",{auth:{type:"Bearer",token:t.accessToken}});if(i)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.email,image:r.picture.data.url,emailVerified:r.email_verified,...o},data:r}}});var D=e=>{let t="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:r,scopes:i,codeVerifier:o,redirectURI:a}){let n=i||["user:email"];return e.scope&&n.push(...e.scope),m({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:n,state:r,redirectURI:a})},validateAuthorizationCode:async({code:r,redirectURI:i})=>d({code:r,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:i,error:o}=await u("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${r.accessToken}`}});if(o)return null;let a=!1,{data:n}=await u("https://api.github.com/user/emails",{headers:{authorization:`Bearer ${r.accessToken}`,"User-Agent":"better-auth"}});n&&(i.email=(n.find(l=>l.primary)??n[0])?.email,a=n.find(l=>l.email===i.email)?.verified??!1);let c=await e.mapProfileToUser?.(i);return{user:{id:i.id.toString(),name:i.name||i.login,email:i.email,image:i.avatar_url,emailVerified:a,...c},data:i}}}};var ge=require("jose");var V=["info","success","warn","error","debug"];function yt(e,t){return V.indexOf(t)<=V.indexOf(e)}var _={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},bt={info:_.fg.blue,success:_.fg.green,warn:_.fg.yellow,error:_.fg.red,debug:_.fg.magenta},vt=(e,t)=>{let r=new Date().toISOString();return`${_.dim}${r}${_.reset} ${bt[e]}${e.toUpperCase()}${_.reset} ${_.bright}[Better Auth]:${_.reset} ${t}`},_t=e=>{let t=e?.disabled!==!0,r=e?.level??"error",i=(o,a,n=[])=>{if(!t||!yt(r,o))return;let c=vt(o,a);if(!e||typeof e.log!="function"){o==="error"?console.error(c,...n):o==="warn"?console.warn(c,...n):console.log(c,...n);return}e.log(o==="success"?"info":o,c,...n)};return Object.fromEntries(V.map(o=>[o,(...[a,...n])=>i(o,a,n)]))},T=_t();var N=e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:r,codeVerifier:i,redirectURI:o}){if(!e.clientId||!e.clientSecret)throw T.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new A("CLIENT_ID_AND_SECRET_REQUIRED");if(!i)throw new A("codeVerifier is required for Google");let a=r||["email","profile","openid"];e.scope&&a.push(...e.scope);let n=await m({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:t,codeVerifier:i,redirectURI:o});return e.accessType&&n.searchParams.set("access_type",e.accessType),e.prompt&&n.searchParams.set("prompt",e.prompt),e.display&&n.searchParams.set("display",e.display),e.hd&&n.searchParams.set("hd",e.hd),n},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>d({code:t,codeVerifier:r,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);let i=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:o}=await u(i);return o?o.aud===e.clientId&&o.iss==="https://accounts.google.com":!1},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let r=(0,ge.decodeJwt)(t.idToken),i=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...i},data:r}}});var he=require("jose"),M=e=>{let t=e.tenantId||"common",r=`https://login.microsoftonline.com/${t}/oauth2/v2.0/authorize`,i=`https://login.microsoftonline.com/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(o){let a=o.scopes||["openid","profile","email","User.Read"];return e.scope&&a.push(...e.scope),m({id:"microsoft",options:e,authorizationEndpoint:r,state:o.state,codeVerifier:o.codeVerifier,scopes:a,redirectURI:o.redirectURI})},validateAuthorizationCode({code:o,codeVerifier:a,redirectURI:n}){return d({code:o,codeVerifier:a,redirectURI:e.redirectURI||n,options:e,tokenEndpoint:i})},async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);if(!o.idToken)return null;let a=(0,he.decodeJwt)(o.idToken),n=e.profilePhotoSize||48;await u(`https://graph.microsoft.com/v1.0/me/photos/${n}x${n}/$value`,{headers:{Authorization:`Bearer ${o.accessToken}`},async onResponse(l){if(!(e.disableProfilePhoto||!l.response.ok))try{let p=await l.response.clone().arrayBuffer(),g=Buffer.from(p).toString("base64");a.picture=`data:image/jpeg;base64, ${g}`}catch(s){T.error(s&&typeof s=="object"&&"name"in s?s.name:"",s)}}});let c=await e.mapProfileToUser?.(a);return{user:{id:a.sub,name:a.name,email:a.email,image:a.picture,emailVerified:!0,...c},data:a}}}};var G=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:i,redirectURI:o}){let a=r||["user-read-email"];return e.scope&&a.push(...e.scope),m({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:a,state:t,codeVerifier:i,redirectURI:o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>d({code:t,codeVerifier:r,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(i)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name,email:r.email,image:r.images[0]?.url,emailVerified:!1,...o},data:r}}});var xt=require("@better-auth/utils/random");var ye=require("jose"),H=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["user:read:email","openid"];return e.scope&&o.push(...e.scope),m({id:"twitch",redirectURI:i,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:o,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>d({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let r=t.idToken;if(!r)return T.error("No idToken found in token"),null;let i=(0,ye.decodeJwt)(r),o=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.preferred_username,email:i.email,image:i.picture,emailVerified:!1,...o},data:i}}});var F=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){let r=t.scopes||["users.read","tweet.read","offline.access"];return e.scope&&r.push(...e.scope),m({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>d({code:t,codeVerifier:r,authentication:"basic",redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(i)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.data.id,name:r.data.name,email:r.data.username||null,image:r.data.profile_image_url,emailVerified:r.data.verified||!1,...o},data:r}}});var q=e=>{let t="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:r,scopes:i,codeVerifier:o,redirectURI:a})=>{let n=i||["account_info.read"];return e.scope&&n.push(...e.scope),await m({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:n,state:r,redirectURI:a,codeVerifier:o})},validateAuthorizationCode:async({code:r,codeVerifier:i,redirectURI:o})=>await d({code:r,codeVerifier:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:t}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:i,error:o}=await u("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${r.accessToken}`}});if(o)return null;let a=await e.mapProfileToUser?.(i);return{user:{id:i.account_id,name:i.name?.display_name,email:i.email,emailVerified:i.email_verified||!1,image:i.profile_photo_url,...a},data:i}}}};var W=e=>{let t="https://www.linkedin.com/oauth/v2/authorization",r="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:i,scopes:o,redirectURI:a})=>{let n=o||["profile","email","openid"];return e.scope&&n.push(...e.scope),await m({id:"linkedin",options:e,authorizationEndpoint:t,scopes:n,state:i,redirectURI:a})},validateAuthorizationCode:async({code:i,redirectURI:o})=>await d({code:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:r}),async getUserInfo(i){let{data:o,error:a}=await u("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${i.accessToken}`}});if(a)return null;let n=await e.mapProfileToUser?.(o);return{user:{id:o.sub,name:o.name,email:o.email,emailVerified:o.email_verified||!1,image:o.picture,...n},data:o}}}};var J=(e="")=>e.split("://").map(t=>t.replace(/\/{2,}/g,"/")).join("://"),wt=e=>{let t=e||"https://gitlab.com";return{authorizationEndpoint:J(`${t}/oauth/authorize`),tokenEndpoint:J(`${t}/oauth/token`),userinfoEndpoint:J(`${t}/api/v4/user`)}},K=e=>{let{authorizationEndpoint:t,tokenEndpoint:r,userinfoEndpoint:i}=wt(e.issuer),o="gitlab";return{id:o,name:"Gitlab",createAuthorizationURL:async({state:n,scopes:c,codeVerifier:l,redirectURI:s})=>{let p=c||["read_user"];return e.scope&&p.push(...e.scope),await m({id:o,options:e,authorizationEndpoint:t,scopes:p,state:n,redirectURI:s,codeVerifier:l})},validateAuthorizationCode:async({code:n,redirectURI:c,codeVerifier:l})=>d({code:n,redirectURI:e.redirectURI||c,options:e,codeVerifier:l,tokenEndpoint:r}),async getUserInfo(n){if(e.getUserInfo)return e.getUserInfo(n);let{data:c,error:l}=await u(i,{headers:{authorization:`Bearer ${n.accessToken}`}});if(l||c.state!=="active"||c.locked)return null;let s=await e.mapProfileToUser?.(c);return{user:{id:c.id.toString(),name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:!0,...s},data:c}}}};var Q=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["identity"];return e.scope&&o.push(...e.scope),m({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:o,state:t,redirectURI:i,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{let i=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),o={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${Buffer.from(`${e.clientId}:${e.clientSecret}`).toString("base64")}`},{data:a,error:n}=await u("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:o,body:i.toString()});if(n)throw n;return L(a)},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(i)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:r.icon_img?.split("?")[0],...o},data:r}}});var X=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:r,redirectURI:i}){let o=r||["openid","profile"];return e.scope&&o.push(...e.scope),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||i)}&state=${t}&prompt=${e.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>d({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:i}=await u("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});return i?null:{user:{id:r.sub,name:r.nickname||r.preferred_username||"",image:r.picture,email:"",emailVerified:!0},data:{...r}}}});var be=require("zod"),ve={apple:C,discord:B,facebook:j,github:D,microsoft:M,google:N,spotify:G,twitch:H,twitter:F,dropbox:q,linkedin:W,gitlab:K,reddit:Q,roblox:X},_e=Object.keys(ve),Pt=be.z.enum(_e,{description:"OAuth2 provider to use"});0&&(module.exports={SocialProviderListEnum,apple,discord,dropbox,facebook,getApplePublicKey,github,gitlab,google,linkedin,microsoft,reddit,roblox,socialProviderList,socialProviders,spotify,twitch,twitter});
