"use strict";var I=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var H=(e,r)=>{for(var f in r)I(e,f,{get:r[f],enumerable:!0})},$=(e,r,f,y)=>{if(r&&typeof r=="object"||typeof r=="function")for(let m of C(r))!j.call(e,m)&&m!==f&&I(e,m,{get:()=>r[m],enumerable:!(y=_(r,m))||y.enumerable});return e};var K=e=>$(I({},"__esModule",{value:!0}),e);var ye={};H(ye,{createKyselyAdapter:()=>N,kyselyAdapter:()=>M});module.exports=K(ye);var v=require("kysely"),b=require("kysely");function B(e){if(!e)return null;if("dialect"in e)return B(e.dialect);if("createDriver"in e){if(e instanceof b.SqliteDialect)return"sqlite";if(e instanceof b.MysqlDialect)return"mysql";if(e instanceof b.PostgresDialect)return"postgres";if(e instanceof v.MssqlDialect)return"mssql"}return"aggregate"in e?"sqlite":"getConnection"in e?"mysql":"connect"in e?"postgres":null}var N=async e=>{let r=e.database;if(!r)return{kysely:null,databaseType:null};if("db"in r)return{kysely:r.db,databaseType:r.type};if("dialect"in r)return{kysely:new v.Kysely({dialect:r.dialect}),databaseType:r.type};let f,y=B(r);return"createDriver"in r&&(f=r),"aggregate"in r&&(f=new b.SqliteDialect({database:r})),"getConnection"in r&&(f=new b.MysqlDialect(r)),"connect"in r&&(f=new b.PostgresDialect({pool:r})),{kysely:f?new v.Kysely({dialect:f}):null,databaseType:y}};var d=require("zod"),W=require("better-call"),xe=d.z.object({id:d.z.string(),providerId:d.z.string(),accountId:d.z.string(),name:d.z.string().nullish(),userId:d.z.string(),accessToken:d.z.string().nullish(),refreshToken:d.z.string().nullish(),idToken:d.z.string().nullish(),accessTokenExpiresAt:d.z.date().nullish(),refreshTokenExpiresAt:d.z.date().nullish(),scope:d.z.string().nullish(),password:d.z.string().nullish(),image:d.z.string().nullish(),createdAt:d.z.date().default(()=>new Date),updatedAt:d.z.date().default(()=>new Date)}),we=d.z.object({id:d.z.string(),email:d.z.string().transform(e=>e.toLowerCase()),emailVerified:d.z.boolean().default(!1),name:d.z.string(),image:d.z.string().nullish(),createdAt:d.z.date().default(()=>new Date),updatedAt:d.z.date().default(()=>new Date)}),be=d.z.object({id:d.z.string(),userId:d.z.string(),expiresAt:d.z.date(),createdAt:d.z.date().default(()=>new Date),updatedAt:d.z.date().default(()=>new Date),token:d.z.string(),ipAddress:d.z.string().nullish(),userAgent:d.z.string().nullish()}),Te=d.z.object({id:d.z.string(),value:d.z.string(),createdAt:d.z.date().default(()=>new Date),updatedAt:d.z.date().default(()=>new Date),expiresAt:d.z.date(),identifier:d.z.string()});var F=Object.create(null),k=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?F:globalThis),L=new Proxy(F,{get(e,r){return k()[r]??F[r]},has(e,r){let f=k();return r in f||r in F},set(e,r,f){let y=k(!0);return y[r]=f,!0},deleteProperty(e,r){if(!r)return!1;let f=k(!0);return delete f[r],!0},ownKeys(){let e=k(!0);return Object.keys(e)}});function J(e){return e?e!=="false":!1}var z=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var G=z==="test"||J(L.TEST);var E=require("@better-auth/utils/random"),O=e=>(0,E.createRandomStringGenerator)("a-z","A-Z","0-9")(e||32);var oe=require("zod"),de=require("better-call");var ie=require("@better-auth/utils/hash"),se=require("@noble/ciphers/chacha"),U=require("@noble/ciphers/utils"),ae=require("@noble/ciphers/webcrypto");var X=require("@better-auth/utils/hash");var Y=require("jose");var ee=require("@noble/hashes/scrypt"),te=require("uncrypto"),re=require("@better-auth/utils/hex");var P=require("@better-auth/utils/random"),ne=(0,P.createRandomStringGenerator)("a-z","0-9","A-Z","-_");var S=["info","success","warn","error","debug"];function ue(e,r){return S.indexOf(r)<=S.indexOf(e)}var w={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},le={info:w.fg.blue,success:w.fg.green,warn:w.fg.yellow,error:w.fg.red,debug:w.fg.magenta},ce=(e,r)=>{let f=new Date().toISOString();return`${w.dim}${f}${w.reset} ${le[e]}${e.toUpperCase()}${w.reset} ${w.bright}[Better Auth]:${w.reset} ${r}`},V=e=>{let r=e?.disabled!==!0,f=e?.level??"error",y=(m,x,A=[])=>{if(!r||!ue(f,m))return;let h=ce(m,x);if(!e||typeof e.log!="function"){m==="error"?console.error(h,...A):m==="warn"?console.warn(h,...A):console.log(h,...A);return}e.log(m==="success"?"info":m,h,...A)};return Object.fromEntries(S.map(m=>[m,(...[x,...A])=>y(m,x,A)]))},fe=V();var R=e=>{let r=e.plugins?.reduce((T,i)=>{let n=i.schema;if(!n)return T;for(let[s,u]of Object.entries(n))T[s]={fields:{...T[s]?.fields,...u.fields},modelName:u.modelName||s};return T},{}),f=e.rateLimit?.storage==="database",y={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:m,session:x,account:A,...h}=r||{};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name"},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email"},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...m?.fields,...e.user?.additionalFields},order:1},session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...x?.fields,...e.session?.additionalFields},order:2},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt"},...A?.fields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...h,...f?y:{}}};var pe=require("zod");function q(e,r,f){return f==="update"?e:e==null&&r.defaultValue?typeof r.defaultValue=="function"?r.defaultValue():r.defaultValue:e}var me=(e,r,f)=>{let y=R(r);function m(i,n){if(n==="id")return n;let s=y[i].fields[n];return s||console.log("Field not found",i,n),s.fieldName||n}function x(i,n,s){let{type:u="sqlite"}=f||{},o=y[n].fields[s];return o.type==="boolean"&&u==="sqlite"&&i!==null&&i!==void 0?i?1:0:o.type==="date"&&i&&i instanceof Date&&u==="sqlite"?i.toISOString():i}function A(i,n,s){let{type:u="sqlite"}=f||{},o=y[n].fields[s];return o.type==="boolean"&&u==="sqlite"&&i!==null?i===1:o.type==="date"&&i?new Date(i):i}function h(i){return y[i].modelName}let T=r?.advanced?.generateId===!1;return{transformInput(i,n,s){let u=T||s==="update"?{}:{id:r.advanced?.generateId?r.advanced.generateId({model:n}):i.id||O()},o=y[n].fields;for(let t in o){let a=i[t];u[o[t].fieldName||t]=q(x(a,n,t),o[t],s)}return u},transformOutput(i,n,s=[]){if(!i)return null;let u=i.id?s.length===0||s.includes("id")?{id:i.id}:{}:{},o=y[n].fields;for(let t in o){if(s.length&&!s.includes(t))continue;let a=o[t];a&&(u[t]=A(i[a.fieldName||t],n,t))}return u},convertWhereClause(i,n){if(!n)return{and:null,or:null};let s={and:[],or:[]};return n.forEach(u=>{let{field:o,value:t,operator:a="=",connector:c="AND"}=u,l=m(i,o),g=p=>a.toLowerCase()==="in"?p(l,"in",Array.isArray(t)?t:[t]):a==="contains"?p(l,"like",`%${t}%`):a==="starts_with"?p(l,"like",`${t}%`):a==="ends_with"?p(l,"like",`%${t}`):a==="eq"?p(l,"=",t):a==="ne"?p(l,"<>",t):a==="gt"?p(l,">",t):a==="gte"?p(l,">=",t):a==="lt"?p(l,"<",t):a==="lte"?p(l,"<=",t):p(l,a,t);c==="OR"?s.or.push(g):s.and.push(g)}),{and:s.and.length?s.and:null,or:s.or.length?s.or:null}},async withReturning(i,n,s,u){let o;if(f?.type!=="mysql")o=await n.returningAll().executeTakeFirst();else{await n.execute();let t=i.id?"id":u[0].field?u[0].field:"id",a=i[t]||u[0].value;o=await e.selectFrom(h(s)).selectAll().where(m(s,t),"=",a).executeTakeFirst()}return o},getModelName:h,getField:m}},M=(e,r)=>f=>{let{transformInput:y,withReturning:m,transformOutput:x,convertWhereClause:A,getModelName:h,getField:T}=me(e,f,r);return{id:"kysely",async create(i){let{model:n,data:s,select:u}=i,o=y(s,n,"create"),t=e.insertInto(h(n)).values(o);return x(await m(o,t,n,[]),n,u)},async findOne(i){let{model:n,where:s,select:u}=i,{and:o,or:t}=A(n,s),a=e.selectFrom(h(n)).selectAll();o&&(a=a.where(l=>l.and(o.map(g=>g(l))))),t&&(a=a.where(l=>l.or(t.map(g=>g(l)))));let c=await a.executeTakeFirst();return c?x(c,n,u):null},async findMany(i){let{model:n,where:s,limit:u,offset:o,sortBy:t}=i,{and:a,or:c}=A(n,s),l=e.selectFrom(h(n));a&&(l=l.where(p=>p.and(a.map(D=>D(p))))),c&&(l=l.where(p=>p.or(c.map(D=>D(p))))),l=l.limit(u||100),o&&(l=l.offset(o)),t&&(l=l.orderBy(T(n,t.field),t.direction));let g=await l.selectAll().execute();return g?g.map(p=>x(p,n)):[]},async update(i){let{model:n,where:s,update:u}=i,{and:o,or:t}=A(n,s),a=y(u,n,"update"),c=e.updateTable(h(n)).set(a);return o&&(c=c.where(g=>g.and(o.map(p=>p(g))))),t&&(c=c.where(g=>g.or(t.map(p=>p(g))))),await x(await m(a,c,n,s),n)},async updateMany(i){let{model:n,where:s,update:u}=i,{and:o,or:t}=A(n,s),a=y(u,n,"update"),c=e.updateTable(h(n)).set(a);return o&&(c=c.where(g=>g.and(o.map(p=>p(g))))),t&&(c=c.where(g=>g.or(t.map(p=>p(g))))),(await c.execute()).length},async count(i){let{model:n,where:s}=i,{and:u,or:o}=A(n,s),t=e.selectFrom(h(n)).selectAll();return u&&(t=t.where(c=>c.and(u.map(l=>l(c))))),o&&(t=t.where(c=>c.or(o.map(l=>l(c))))),(await t.execute()).length},async delete(i){let{model:n,where:s}=i,{and:u,or:o}=A(n,s),t=e.deleteFrom(h(n));u&&(t=t.where(a=>a.and(u.map(c=>c(a))))),o&&(t=t.where(a=>a.or(o.map(c=>c(a))))),await t.execute()},async deleteMany(i){let{model:n,where:s}=i,{and:u,or:o}=A(n,s),t=e.deleteFrom(h(n));return u&&(t=t.where(a=>a.and(u.map(c=>c(a))))),o&&(t=t.where(a=>a.or(o.map(c=>c(a))))),(await t.execute()).length},options:r}};0&&(module.exports={createKyselyAdapter,kyselyAdapter});
