var he=Object.defineProperty,ye=Object.defineProperties,be=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable,j=(e,r,t)=>r in e?he(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,P=(e,r)=>{for(var t in r||(r={}))ve.call(r,t)&&j(e,t,r[t]);if(B)for(var t of B(r))_e.call(r,t)&&j(e,t,r[t]);return e},U=(e,r)=>ye(e,be(r)),xe=class extends Error{constructor(e,r,t){super(r||e.toString(),{cause:t}),this.status=e,this.statusText=r,this.error=t}},we=async(e,r)=>{var t,i,o,a,n,c;let l=r||{},s={onRequest:[r?.onRequest],onResponse:[r?.onResponse],onSuccess:[r?.onSuccess],onError:[r?.onError],onRetry:[r?.onRetry]};if(!r||!r?.plugins)return{url:e,options:l,hooks:s};for(let p of r?.plugins||[]){if(p.init){let g=await((t=p.init)==null?void 0:t.call(p,e.toString(),r));l=g.options||l,e=g.url}s.onRequest.push((i=p.hooks)==null?void 0:i.onRequest),s.onResponse.push((o=p.hooks)==null?void 0:o.onResponse),s.onSuccess.push((a=p.hooks)==null?void 0:a.onSuccess),s.onError.push((n=p.hooks)==null?void 0:n.onError),s.onRetry.push((c=p.hooks)==null?void 0:c.onRetry)}return{url:e,options:l,hooks:s}},D=class{constructor(e){this.options=e}shouldAttemptRetry(e,r){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(r)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},Pe=class{constructor(e){this.options=e}shouldAttemptRetry(e,r){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(r)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function Ue(e){if(typeof e=="number")return new D({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new D(e);case"exponential":return new Pe(e);default:throw new Error("Invalid retry strategy")}}var Re=e=>{let r={},t=i=>typeof i=="function"?i():i;if(e?.auth){if(e.auth.type==="Bearer"){let i=t(e.auth.token);if(!i)return r;r.authorization=`Bearer ${i}`}else if(e.auth.type==="Basic"){let i=t(e.auth.username),o=t(e.auth.password);if(!i||!o)return r;r.authorization=`Basic ${btoa(`${i}:${o}`)}`}else if(e.auth.type==="Custom"){let i=t(e.auth.value);if(!i)return r;r.authorization=`${t(e.auth.prefix)} ${i}`}}return r},M=["get","post","put","patch","delete"];var Ae=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Te(e){let r=e.headers.get("content-type"),t=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!r)return"json";let i=r.split(";").shift()||"";return Ae.test(i)?"json":t.has(i)||i.startsWith("text/")?"text":"blob"}function ke(e){try{return JSON.parse(e),!0}catch{return!1}}function G(e){if(e===void 0)return!1;let r=typeof e;return r==="string"||r==="number"||r==="boolean"||r===null?!0:r!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function V(e){try{return JSON.parse(e)}catch{return e}}function N(e){return typeof e=="function"}function Oe(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&N(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&N(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}function Le(e){let r=new Headers(e?.headers),t=Re(e);for(let[i,o]of Object.entries(t||{}))r.set(i,o);if(!r.has("content-type")){let i=Ie(e?.body);i&&r.set("content-type",i)}return r}function Ie(e){return G(e)?"application/json":null}function Ee(e){if(!e?.body)return null;let r=new Headers(e?.headers);return G(e.body)&&!r.has("content-type")?JSON.stringify(e.body):e.body}function Se(e,r){var t;if(r?.method)return r.method.toUpperCase();if(e.startsWith("@")){let i=(t=e.split("@")[1])==null?void 0:t.split("/")[0];return M.includes(i)?i.toUpperCase():r?.body?"POST":"GET"}return r?.body?"POST":"GET"}function ze(e,r){let t;return!e?.signal&&e?.timeout&&(t=setTimeout(()=>r?.abort(),e?.timeout)),{abortTimeout:t,clearTimeout:()=>{t&&clearTimeout(t)}}}function $e(e,r){let{baseURL:t,params:i,query:o}=r||{query:{},params:{},baseURL:""},a=e.startsWith("http")?e.split("/").slice(0,3).join("/"):t;if(!a)throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);if(e.startsWith("@")){let g=e.toString().split("@")[1].split("/")[0];M.includes(g)&&(e=e.replace(`@${g}/`,"/"))}a.endsWith("/")||(a+="/");let[n,c]=e.replace(a,"").split("?"),l=new URLSearchParams(c);for(let[g,h]of Object.entries(o||{}))l.set(g,String(h));if(i)if(Array.isArray(i)){let g=n.split("/").filter(h=>h.startsWith(":"));for(let[h,I]of g.entries()){let k=i[h];n=n.replace(I,k)}}else for(let[g,h]of Object.entries(i))n=n.replace(`:${g}`,String(h));n=n.split("/").map(encodeURIComponent).join("/"),n.startsWith("/")&&(n=n.slice(1));let s=l.size>0?`?${l}`.replace(/\+/g,"%20"):"";return new URL(`${n}${s}`,a)}var u=async(e,r)=>{var t,i,o,a,n,c,l,s;let{hooks:p,url:g,options:h}=await we(e,r),I=Oe(h),k=new AbortController,se=(t=h.signal)!=null?t:k.signal,ce=$e(g,h),le=Ee(h),ue=Le(h),de=Se(g,h),y=U(P({},h),{url:ce,headers:ue,body:le,method:de,signal:se});for(let v of p.onRequest)if(v){let b=await v(y);b instanceof Object&&(y=b)}("pipeTo"in y&&typeof y.pipeTo=="function"||typeof((i=r?.body)==null?void 0:i.pipe)=="function")&&("duplex"in y||(y.duplex="half"));let{clearTimeout:pe}=ze(h,k),f=await I(y.url,y);pe();let $={response:f,request:y};for(let v of p.onResponse)if(v){let b=await v(U(P({},$),{response:(o=r?.hookOptions)!=null&&o.cloneResponse?f.clone():f}));b instanceof Response?f=b:b instanceof Object&&(f=b.response)}if(f.ok){if(!(y.method!=="HEAD"))return{data:"",error:null};let b=Te(f),x={data:"",response:f,request:y};if(b==="json"||b==="text"){let w=await f.text(),ge=await((a=y.jsonParser)!=null?a:V)(w);x.data=ge}else x.data=await f[b]();y?.output&&y.output&&!y.disableValidation&&(x.data=y.output.parse(x.data));for(let w of p.onSuccess)w&&await w(U(P({},x),{response:(n=r?.hookOptions)!=null&&n.cloneResponse?f.clone():f}));return r?.throw?x.data:{data:x.data,error:null}}let fe=(c=r?.jsonParser)!=null?c:V,C=await f.text(),E=ke(C)?await fe(C):{},me={response:f,request:y,error:U(P({},E),{status:f.status,statusText:f.statusText})};for(let v of p.onError)v&&await v(U(P({},me),{response:(l=r?.hookOptions)!=null&&l.cloneResponse?f.clone():f}));if(r?.retry){let v=Ue(r.retry),b=(s=r.retryAttempt)!=null?s:0;if(await v.shouldAttemptRetry(b,f)){for(let w of p.onRetry)w&&await w($);let x=v.getDelay(b);return await new Promise(w=>setTimeout(w,x)),await u(e,U(P({},r),{retryAttempt:b+1}))}}if(r?.throw)throw new xe(f.status,f.statusText,E);return{data:null,error:U(P({},E),{status:f.status,statusText:f.statusText})}};import{APIError as Ge}from"better-call";import{decodeJwt as He,decodeProtectedHeader as Fe,importJWK as qe,jwtVerify as We}from"jose";var H=(e,r="ms")=>new Date(Date.now()+(r==="sec"?e*1e3:e));import{createHash as Ce}from"@better-auth/utils/hash";import{base64Url as Be}from"@better-auth/utils/base64";async function F(e){let r=await Ce("SHA-256").digest(e);return Be.encode(new Uint8Array(r),{padding:!1})}function O(e){return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?H(e.expires_in,"sec"):void 0,scopes:e?.scope?typeof e.scope=="string"?e.scope.split(" "):e.scope:[],idToken:e.id_token}}async function m({id:e,options:r,authorizationEndpoint:t,state:i,codeVerifier:o,scopes:a,claims:n,redirectURI:c,duration:l}){let s=new URL(t);if(s.searchParams.set("response_type","code"),s.searchParams.set("client_id",r.clientId),s.searchParams.set("state",i),s.searchParams.set("scope",a.join(" ")),s.searchParams.set("redirect_uri",r.redirectURI||c),o){let p=await F(o);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",p)}if(n){let p=n.reduce((g,h)=>(g[h]=null,g),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...p}}))}return l&&s.searchParams.set("duration",l),s}import{jwtVerify as xr}from"jose";async function d({code:e,codeVerifier:r,redirectURI:t,options:i,tokenEndpoint:o,authentication:a}){let n=new URLSearchParams,c={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth"};if(n.set("grant_type","authorization_code"),n.set("code",e),r&&n.set("code_verifier",r),n.set("redirect_uri",t),a==="basic"){let g=btoa(`${i.clientId}:${i.clientSecret}`);c.authorization=`Basic ${g}`}else n.set("client_id",i.clientId),n.set("client_secret",i.clientSecret);let{data:l,error:s}=await u(o,{method:"POST",body:n,headers:c});if(s)throw s;return O(l)}import{z as dt}from"zod";import{APIError as ft}from"better-call";var L=Object.create(null),T=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?L:globalThis),q=new Proxy(L,{get(e,r){return T()[r]??L[r]},has(e,r){let t=T();return r in t||r in L},set(e,r,t){let i=T(!0);return i[r]=t,!0},deleteProperty(e,r){if(!r)return!1;let t=T(!0);return delete t[r],!0},ownKeys(){let e=T(!0);return Object.keys(e)}});function je(e){return e?e!=="false":!1}var De=typeof process<"u"&&process.env&&process.env.NODE_ENV||"";var Pr=De==="test"||je(q.TEST);var R=class extends Error{constructor(r,t){super(r),this.name="BetterAuthError",this.message=r,this.cause=t,this.stack=""}};import{createHash as Jr}from"@better-auth/utils/hash";import{xchacha20poly1305 as Qr}from"@noble/ciphers/chacha";import{bytesToHex as Zr,hexToBytes as Yr,utf8ToBytes as et}from"@noble/ciphers/utils";import{managedNonce as tt}from"@noble/ciphers/webcrypto";import{createHash as Er}from"@better-auth/utils/hash";import{SignJWT as $r}from"jose";import{scryptAsync as Dr}from"@noble/hashes/scrypt";import{getRandomValues as Nr}from"uncrypto";import{hex as Gr}from"@better-auth/utils/hex";import{createRandomStringGenerator as Ne}from"@better-auth/utils/random";var Me=Ne("a-z","0-9","A-Z","-_");var W=e=>{let r="https://appleid.apple.com/auth/token";return{id:"apple",name:"Apple",createAuthorizationURL({state:t,scopes:i,redirectURI:o}){let a=i||["email","name"];return e.scope&&a.push(...e.scope),new URL(`https://appleid.apple.com/auth/authorize?client_id=${e.clientId}&response_type=code&redirect_uri=${e.redirectURI||o}&scope=${a.join(" ")}&state=${t}&response_mode=form_post`)},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:o})=>d({code:t,codeVerifier:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:r}),async verifyIdToken(t,i){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,i);let o=Fe(t),{kid:a,alg:n}=o;if(!a||!n)return!1;let c=await Je(a),{payload:l}=await We(t,c,{algorithms:[n],issuer:"https://appleid.apple.com",audience:e.appBundleIdentifier||e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(s=>{l[s]!==void 0&&(l[s]=!!l[s])}),i&&l.nonce!==i?!1:!!l},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let i=He(t.idToken);if(!i)return null;let o=i.user?`${i.user.name.firstName} ${i.user.name.lastName}`:i.email,a=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:o,emailVerified:!1,email:i.email,...a},data:i}}}},Je=async e=>{let r="https://appleid.apple.com",t="/auth/keys",{data:i}=await u(`${r}${t}`);if(!i?.keys)throw new Ge("BAD_REQUEST",{message:"Keys not found"});let o=i.keys.find(a=>a.kid===e);if(!o)throw new Error(`JWK with kid ${e} not found`);return await qe(o,o.alg)};var J=e=>({id:"discord",name:"Discord",createAuthorizationURL({state:r,scopes:t,redirectURI:i}){let o=t||["identify","email"];return e.scope&&o.push(...e.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||i)}&state=${r}&prompt=${e.prompt||"none"}`)},validateAuthorizationCode:async({code:r,redirectURI:t})=>d({code:r,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:t,error:i}=await u("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${r.accessToken}`}});if(i)return null;if(t.avatar===null){let a=t.discriminator==="0"?Number(BigInt(t.id)>>BigInt(22))%6:parseInt(t.discriminator)%5;t.image_url=`https://cdn.discordapp.com/embed/avatars/${a}.png`}else{let a=t.avatar.startsWith("a_")?"gif":"png";t.image_url=`https://cdn.discordapp.com/avatars/${t.id}/${t.avatar}.${a}`}let o=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.display_name||t.username||"",email:t.email,emailVerified:t.verified,image:t.image_url,...o},data:t}}});var K=e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:r,scopes:t,redirectURI:i}){let o=t||["email","public_profile"];return e.scope&&o.push(...e.scope),await m({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:o,state:r,redirectURI:i})},validateAuthorizationCode:async({code:r,redirectURI:t})=>d({code:r,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:t,error:i}=await u("https://graph.facebook.com/me?fields=id,name,email,picture",{auth:{type:"Bearer",token:r.accessToken}});if(i)return null;let o=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.name,email:t.email,image:t.picture.data.url,emailVerified:t.email_verified,...o},data:t}}});var Q=e=>{let r="https://github.com/login/oauth/access_token";return{id:"github",name:"GitHub",createAuthorizationURL({state:t,scopes:i,codeVerifier:o,redirectURI:a}){let n=i||["user:email"];return e.scope&&n.push(...e.scope),m({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:n,state:t,redirectURI:a})},validateAuthorizationCode:async({code:t,redirectURI:i})=>d({code:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:r}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await u("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${t.accessToken}`}});if(o)return null;let a=!1,{data:n}=await u("https://api.github.com/user/emails",{headers:{authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});n&&(i.email=(n.find(l=>l.primary)??n[0])?.email,a=n.find(l=>l.email===i.email)?.verified??!1);let c=await e.mapProfileToUser?.(i);return{user:{id:i.id.toString(),name:i.name||i.login,email:i.email,image:i.avatar_url,emailVerified:a,...c},data:i}}}};var S=["info","success","warn","error","debug"];function Ke(e,r){return S.indexOf(r)<=S.indexOf(e)}var _={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",underscore:"\x1B[4m",blink:"\x1B[5m",reverse:"\x1B[7m",hidden:"\x1B[8m",fg:{black:"\x1B[30m",red:"\x1B[31m",green:"\x1B[32m",yellow:"\x1B[33m",blue:"\x1B[34m",magenta:"\x1B[35m",cyan:"\x1B[36m",white:"\x1B[37m"},bg:{black:"\x1B[40m",red:"\x1B[41m",green:"\x1B[42m",yellow:"\x1B[43m",blue:"\x1B[44m",magenta:"\x1B[45m",cyan:"\x1B[46m",white:"\x1B[47m"}},Qe={info:_.fg.blue,success:_.fg.green,warn:_.fg.yellow,error:_.fg.red,debug:_.fg.magenta},Xe=(e,r)=>{let t=new Date().toISOString();return`${_.dim}${t}${_.reset} ${Qe[e]}${e.toUpperCase()}${_.reset} ${_.bright}[Better Auth]:${_.reset} ${r}`},Ze=e=>{let r=e?.disabled!==!0,t=e?.level??"error",i=(o,a,n=[])=>{if(!r||!Ke(t,o))return;let c=Xe(o,a);if(!e||typeof e.log!="function"){o==="error"?console.error(c,...n):o==="warn"?console.warn(c,...n):console.log(c,...n);return}e.log(o==="success"?"info":o,c,...n)};return Object.fromEntries(S.map(o=>[o,(...[a,...n])=>i(o,a,n)]))},A=Ze();import{decodeJwt as Ye}from"jose";var X=e=>({id:"google",name:"Google",async createAuthorizationURL({state:r,scopes:t,codeVerifier:i,redirectURI:o}){if(!e.clientId||!e.clientSecret)throw A.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new R("CLIENT_ID_AND_SECRET_REQUIRED");if(!i)throw new R("codeVerifier is required for Google");let a=t||["email","profile","openid"];e.scope&&a.push(...e.scope);let n=await m({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:a,state:r,codeVerifier:i,redirectURI:o});return e.accessType&&n.searchParams.set("access_type",e.accessType),e.prompt&&n.searchParams.set("prompt",e.prompt),n},validateAuthorizationCode:async({code:r,codeVerifier:t,redirectURI:i})=>d({code:r,codeVerifier:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),async verifyIdToken(r,t){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(r,t);let i=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${r}`,{data:o}=await u(i);return o?o.aud===e.clientId&&o.iss==="https://accounts.google.com":!1},async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);if(!r.idToken)return null;let t=Ye(r.idToken),i=await e.mapProfileToUser?.(t);return{user:{id:t.sub,name:t.name,email:t.email,image:t.picture,emailVerified:t.email_verified,...i},data:t}}});import{decodeJwt as er}from"jose";var Z=e=>{let r=e.tenantId||"common",t=`https://login.microsoftonline.com/${r}/oauth2/v2.0/authorize`,i=`https://login.microsoftonline.com/${r}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(o){let a=o.scopes||["openid","profile","email","User.Read"];return e.scope&&a.push(...e.scope),m({id:"microsoft",options:e,authorizationEndpoint:t,state:o.state,codeVerifier:o.codeVerifier,scopes:a,redirectURI:o.redirectURI})},validateAuthorizationCode({code:o,codeVerifier:a,redirectURI:n}){return d({code:o,codeVerifier:a,redirectURI:e.redirectURI||n,options:e,tokenEndpoint:i})},async getUserInfo(o){if(e.getUserInfo)return e.getUserInfo(o);if(!o.idToken)return null;let a=er(o.idToken),n=e.profilePhotoSize||48;await u(`https://graph.microsoft.com/v1.0/me/photos/${n}x${n}/$value`,{headers:{Authorization:`Bearer ${o.accessToken}`},async onResponse(l){if(!(e.disableProfilePhoto||!l.response.ok))try{let p=await l.response.clone().arrayBuffer(),g=Buffer.from(p).toString("base64");a.picture=`data:image/jpeg;base64, ${g}`}catch(s){A.error(s&&typeof s=="object"&&"name"in s?s.name:"",s)}}});let c=await e.mapProfileToUser?.(a);return{user:{id:a.sub,name:a.name,email:a.email,image:a.picture,emailVerified:!0,...c},data:a}}}};var Y=e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:r,scopes:t,codeVerifier:i,redirectURI:o}){let a=t||["user-read-email"];return e.scope&&a.push(...e.scope),m({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:a,state:r,codeVerifier:i,redirectURI:o})},validateAuthorizationCode:async({code:r,codeVerifier:t,redirectURI:i})=>d({code:r,codeVerifier:t,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:t,error:i}=await u("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${r.accessToken}`}});if(i)return null;let o=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.display_name,email:t.email,image:t.images[0]?.url,emailVerified:!1,...o},data:t}}});import{createRandomStringGenerator as ri}from"@better-auth/utils/random";import{decodeJwt as rr}from"jose";var ee=e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:r,scopes:t,redirectURI:i}){let o=t||["user:read:email","openid"];return e.scope&&o.push(...e.scope),m({id:"twitch",redirectURI:i,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:o,state:r,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:r,redirectURI:t})=>d({code:r,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let t=r.idToken;if(!t)return A.error("No idToken found in token"),null;let i=rr(t),o=await e.mapProfileToUser?.(i);return{user:{id:i.sub,name:i.preferred_username,email:i.email,image:i.picture,emailVerified:!1,...o},data:i}}});var re=e=>({id:"twitter",name:"Twitter",createAuthorizationURL(r){let t=r.scopes||["users.read","tweet.read","offline.access"];return e.scope&&t.push(...e.scope),m({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:t,state:r.state,codeVerifier:r.codeVerifier,redirectURI:r.redirectURI})},validateAuthorizationCode:async({code:r,codeVerifier:t,redirectURI:i})=>d({code:r,codeVerifier:t,authentication:"basic",redirectURI:e.redirectURI||i,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:t,error:i}=await u("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${r.accessToken}`}});if(i)return null;let o=await e.mapProfileToUser?.(t);return{user:{id:t.data.id,name:t.data.name,email:t.data.username||null,image:t.data.profile_image_url,emailVerified:t.data.verified||!1,...o},data:t}}});var te=e=>{let r="https://api.dropboxapi.com/oauth2/token";return{id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:t,scopes:i,codeVerifier:o,redirectURI:a})=>{let n=i||["account_info.read"];return e.scope&&n.push(...e.scope),await m({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:n,state:t,redirectURI:a,codeVerifier:o})},validateAuthorizationCode:async({code:t,codeVerifier:i,redirectURI:o})=>await d({code:t,codeVerifier:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:r}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:i,error:o}=await u("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`}});if(o)return null;let a=await e.mapProfileToUser?.(i);return{user:{id:i.account_id,name:i.name?.display_name,email:i.email,emailVerified:i.email_verified||!1,image:i.profile_photo_url,...a},data:i}}}};var ie=e=>{let r="https://www.linkedin.com/oauth/v2/authorization",t="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:i,scopes:o,redirectURI:a})=>{let n=o||["profile","email","openid"];return e.scope&&n.push(...e.scope),await m({id:"linkedin",options:e,authorizationEndpoint:r,scopes:n,state:i,redirectURI:a})},validateAuthorizationCode:async({code:i,redirectURI:o})=>await d({code:i,redirectURI:e.redirectURI||o,options:e,tokenEndpoint:t}),async getUserInfo(i){let{data:o,error:a}=await u("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${i.accessToken}`}});if(a)return null;let n=await e.mapProfileToUser?.(o);return{user:{id:o.sub,name:o.name,email:o.email,emailVerified:o.email_verified||!1,image:o.picture,...n},data:o}}}};var z=(e="")=>e.split("://").map(r=>r.replace(/\/{2,}/g,"/")).join("://"),tr=e=>{let r=e||"https://gitlab.com";return{authorizationEndpoint:z(`${r}/oauth/authorize`),tokenEndpoint:z(`${r}/oauth/token`),userinfoEndpoint:z(`${r}/api/v4/user`)}},oe=e=>{let{authorizationEndpoint:r,tokenEndpoint:t,userinfoEndpoint:i}=tr(e.issuer),o="gitlab";return{id:o,name:"Gitlab",createAuthorizationURL:async({state:n,scopes:c,codeVerifier:l,redirectURI:s})=>{let p=c||["read_user"];return e.scope&&p.push(...e.scope),await m({id:o,options:e,authorizationEndpoint:r,scopes:p,state:n,redirectURI:s,codeVerifier:l})},validateAuthorizationCode:async({code:n,redirectURI:c,codeVerifier:l})=>d({code:n,redirectURI:e.redirectURI||c,options:e,codeVerifier:l,tokenEndpoint:t}),async getUserInfo(n){if(e.getUserInfo)return e.getUserInfo(n);let{data:c,error:l}=await u(i,{headers:{authorization:`Bearer ${n.accessToken}`}});if(l||c.state!=="active"||c.locked)return null;let s=await e.mapProfileToUser?.(c);return{user:{id:c.id.toString(),name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:!0,...s},data:c}}}};var ne=e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:r,scopes:t,redirectURI:i}){let o=t||["identity"];return e.scope&&o.push(...e.scope),m({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:o,state:r,redirectURI:i,duration:e.duration})},validateAuthorizationCode:async({code:r,redirectURI:t})=>{let i=new URLSearchParams({grant_type:"authorization_code",code:r,redirect_uri:e.redirectURI||t}),o={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${Buffer.from(`${e.clientId}:${e.clientSecret}`).toString("base64")}`},{data:a,error:n}=await u("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:o,body:i.toString()});if(n)throw n;return O(a)},async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:t,error:i}=await u("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${r.accessToken}`,"User-Agent":"better-auth"}});if(i)return null;let o=await e.mapProfileToUser?.(t);return{user:{id:t.id,name:t.name,email:t.oauth_client_id,emailVerified:t.has_verified_email,image:t.icon_img?.split("?")[0],...o},data:t}}});var ae=e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:r,scopes:t,redirectURI:i}){let o=t||["openid","profile"];return e.scope&&o.push(...e.scope),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${o.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||i)}&state=${r}&prompt=${e.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:r,redirectURI:t})=>d({code:r,redirectURI:e.redirectURI||t,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(r){if(e.getUserInfo)return e.getUserInfo(r);let{data:t,error:i}=await u("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${r.accessToken}`}});if(i)return null;let o=await e.mapProfileToUser?.(t);return{user:{id:t.sub,name:t.nickname||t.preferred_username||"",image:t.picture,email:"",emailVerified:!0,...o},data:{image:t.picture,...t}}}});import{z as ir}from"zod";var or={apple:W,discord:J,facebook:K,github:Q,microsoft:Z,google:X,spotify:Y,twitch:ee,twitter:re,dropbox:te,linkedin:ie,gitlab:oe,reddit:ne,roblox:ae},nr=Object.keys(or),Ji=ir.enum(nr,{description:"OAuth2 provider to use"});export{Ji as SocialProviderListEnum,W as apple,J as discord,te as dropbox,K as facebook,Je as getApplePublicKey,Q as github,oe as gitlab,X as google,ie as linkedin,Z as microsoft,ne as reddit,ae as roblox,nr as socialProviderList,or as socialProviders,Y as spotify,ee as twitch,re as twitter};
